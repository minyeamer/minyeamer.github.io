<!doctype html><html lang=ko-kr dir=ltr><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><meta name=keywords content="Crawling,Python,Naver,네이버,스마트스토어,스마트스토어센터,로그인,크롤링"><meta name=description content="이번 게시글에서는 스마트스토어센터 페이지에서 데이터를 수집하는 자동화 프로그램을 제작하기 위한 첫 번째 과정으로 네이버 로그인을 구현할 것입니다. …"><meta name=author content="minyeamer"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><link rel=canonical href=https://minyeamer.github.io/blog/smartstore-login-2/><link rel=icon href=https://minyeamer.github.io/images/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://minyeamer.github.io/images/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://minyeamer.github.io/images/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://minyeamer.github.io/images/favicons/apple-touch-icon.png><link rel=mask-icon href=https://minyeamer.github.io/images/favicons/apple-touch-icon.png><meta name=google-site-verification content="u1tWcHmHUZWfFT1cHaku6sqU-bK40N3WLR-C-4VUWN0"><meta name=naver-site-verification content="6eaf8e9da1a6104780f056f1a7797fe5a3a5a0da"><meta property="og:title" content="[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (2)"><meta property="og:description" content="이번 게시글에서는 스마트스토어센터 페이지에서 데이터를 수집하는 자동화 프로그램을 제작하기 위한 첫 번째 과정으로 네이버 로그인을 구현할 것입니다. …"><meta property="og:type" content="article"><meta property="og:url" content="https://minyeamer.github.io/blog/smartstore-login-2/"><meta property="og:image" content="https://minyeamer.github.io/images/profile/opengraph.jpg"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-12-03T16:11:42+09:00"><meta property="article:modified_time" content="2022-12-03T16:11:42+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://minyeamer.github.io/images/profile/opengraph.jpg"><meta name=twitter:title content="[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (2)"><meta name=twitter:description content="이번 게시글에서는 스마트스토어센터 페이지에서 데이터를 수집하는 자동화 프로그램을 제작하기 위한 첫 번째 과정으로 네이버 로그인을 구현할 것입니다. …"><meta name=twitter:site content="@https://x.com/minyeamer"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://minyeamer.github.io/post/"},{"@type":"ListItem","position":2,"name":"[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (2)","item":"https://minyeamer.github.io/blog/smartstore-login-2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (2)","name":"[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (2)","description":"이번 게시글에서는 스마트스토어센터 페이지에서 데이터를 수집하는 자동화 프로그램을 제작하기 위한\n첫 번째 과정으로 네이버 로그인을 구현할 것입니다.\n앞선 게시글에서 데이터를 수집하는 방식에 대해 알아보면서\n로그인이 필요한 페이지에 접근하기 다음과 같은 쿠키 값이 필요함을 확인했습니다.\nCopy python cookies = { \u0026#34;NNB\u0026#34;: \u0026#34;...\u0026#34;, \u0026#34;nid_inf\u0026#34;: \u0026#34;...\u0026#34;, \u0026#34;NID_AUT\u0026#34;: \u0026#34;...\u0026#34;, \u0026#34;NID_SES\u0026#34;: \u0026#34;...\u0026#34;, \u0026#34;NID_JKL\u0026#34;: \u0026#34;...\u0026#34;, \u0026#34;CBI_SES\u0026#34;: \u0026#34;...\u0026#34;, \u0026#34;CBI_CHK\u0026#34;: \u0026#34;...\u0026#34;, \u0026#34;NSI\u0026#34;: \u0026#34;...\u0026#34;, } 위 키값들은 앞으로 로그인 프로세스를 파악하는 과정에서 중요하게 활용됩니다.\n네이버 로그인 이해 # 네이버 스마트스토어센터 로그인 과정에서 진행되는 네이버 로그인은\n일반적인 네이버 로그인과는 다른 과정으로 진행됩니다.\n","keywords":["Crawling","Python","Naver","네이버","스마트스토어","스마트스토어센터","로그인","크롤링"],"articleBody":"이번 게시글에서는 스마트스토어센터 페이지에서 데이터를 수집하는 자동화 프로그램을 제작하기 위한\n첫 번째 과정으로 네이버 로그인을 구현할 것입니다.\n앞선 게시글에서 데이터를 수집하는 방식에 대해 알아보면서\n로그인이 필요한 페이지에 접근하기 다음과 같은 쿠키 값이 필요함을 확인했습니다.\nCopy python cookies = { \"NNB\": \"...\", \"nid_inf\": \"...\", \"NID_AUT\": \"...\", \"NID_SES\": \"...\", \"NID_JKL\": \"...\", \"CBI_SES\": \"...\", \"CBI_CHK\": \"...\", \"NSI\": \"...\", } 위 키값들은 앞으로 로그인 프로세스를 파악하는 과정에서 중요하게 활용됩니다.\n네이버 로그인 이해 # 네이버 스마트스토어센터 로그인 과정에서 진행되는 네이버 로그인은\n일반적인 네이버 로그인과는 다른 과정으로 진행됩니다.\n따라서 우선 일반적인 네이버 로그인 과정을 알아보겠습니다.\n해당 파트는 아래 게시글을 참고해 작성되었습니다.\n파이썬#76 - 파이썬 크롤링 requests 로 네이버 로그인 하기\n네이버 로그인 요청 분석 # 네이버 로그인 과정을 분석하기 위해서는 우선 네이버 로그인을 요청을 시도하여\n전달되는 값을 확인해야 합니다.\n네이버 로그인 페이지에서 로그인을 수행하는 과정에서\n발견할 수 있는 POST 요청을 살펴보면 다음과 같은 데이터가 전달됨을 발견할 수 있습니다.\n암호화된 값을 생략하고 키로 전달되는 내용을 확인하면 다음과 같습니다.\nCopy json { \"localechange\": \"\", \"dynamicKey\": \"...\", \"encpw\": \"...\", \"enctp\": 1, \"svctype\": 1, \"smart_LEVEL\": 1, \"bvsd\": { \"uuid\": \"...\", \"encData\": \"...\" }, \"encnm\": \"...\", \"locale\": \"ko_KR\", \"url\": \"https://www.naver.com\", \"id\": \"\", \"pw\": \"\" } 공백이나 고정된 값을 가진 키를 제외하면 결과적으로\ndynamicKey, encpw, bvsd, encnm를 밝혀내는 것이 중요할 것이라 판단됩니다.\n네이버 로그인 폼 분석 # 키의 명칭만으로는 무엇을 의미하는지 알 수 없기 때문에\n로그인 페이지 소스에서 키명칭을 검색하였고 네이버 로그인 폼에서 하나의 단서를 찾을 수 있었습니다.\ndynamicKey의 경우 로그인 폼에 동적으로 부여되는 값임을 알 수 있습니다.\n하지만 나머지 encpw, bvsd, encnm의 값은 비어있기 때문에\n다른 자바스크립트 응답을 분석해야 합니다.\n네이버 로그인 RSA 암호화 # encpw 값에 대한 단서를 찾기 위해 전체 검색을 수행했을 때\ncommon_202201.js 내부에서 RSA 암호화 처리를 통해 값을 생성함을 알 수 있습니다.\n그 중에서 가장 처음 단계로 실행될 것이라 추측되는 것이 아래 confirmSubmit() 함수입니다.\n해당 함수는 아이디와 비밀번호의 여부를 체크하고 encryptIdPw() 함수의 결과를 반환합니다.\n바로 밑에서 확인할 수 있는 encryptIdPw() 함수의 내용은 다음과 같습니다.\nCopy js function encryptIdPw() { var id = $(\"id\"); var pw = $(\"pw\"); var encpw = $(\"encpw\"); var rsa = new RSAKey; if (keySplit(session_keys)) { rsa.setPublic(evalue, nvalue); try{ encpw.value = rsa.encrypt( getLenChar(sessionkey) + sessionkey + getLenChar(id.value) + id.value + getLenChar(pw.value) + pw.value); } catch(e) { return false; } $('enctp').value = 1; id.value = \"\"; pw.value = \"\"; return true; } else { getKeyByRuntimeInclude(); return false; } return false; } 해당 함수는 session_keys라는 값을 처리하고 RSA 암호화한 결과를\nencpw의 값으로 대체하는 것을 알 수 있습니다.\n마찬가지로 해당 명칭을 검색했을 때\nsession_keys는 Ajax 통신의 응답 결과를 받아오는 것을 확인할 수 있습니다.\n하지만 네이버 로그인 페이지에서 svctype=262144를 추가적인 파라미터로 입력할 경우\n접근할 수 있는 모바일 로그인 페이지에서 해당 값을 확인할 수 있었습니다.\n다시 encryptIdPw() 함수로 돌아가서 session_keys를 처리하기 위해\nkeySplit() 함수를 찾아보았습니다.\nCopy js function keySplit(a) { keys = a.split(\",\"); if (!a || !keys[0] || !keys[1] || !keys[2] || !keys[3]) { return false; } sessionkey = keys[0]; keyname = keys[1]; evalue = keys[2]; nvalue = keys[3]; $(\"encnm\").value = keyname; return true } 모바일 페이지에서 볼 수 있는 session_keys 값은 콤마를 기준으로\n4개의 값으로 구분되어 있었는데 해당 함수에서는 각각을\nsessionKey, encnm, evalue, nvalue으로 분리했습니다.\n여기서 encnm 값을 우선적으로 가져올 수 있었고,\n다음으로 encpw 값을 찾기 위해 RSA 암호화 부분을 탐색해봅니다.\nCopy js rsa.setPublic(evalue, nvalue); encpw.value = rsa.encrypt( getLenChar(sessionkey) + sessionkey + getLenChar(id.value) + id.value + getLenChar(pw.value) + pw.value); session_keys에서 분리된 evalue와 nvalue로 RSA 공개키를 생성하고\n마찬가지로 session_keys에 포함된 sessionKey 및 아이디, 비밀번호의 조합을\n암호화한 결과가 encpw임을 확인할 수 있습니다.\n파이썬에서는 공개키 생성을 rsa.PublicKey() 함수로 수행할 수 있으며\nrsa.encrypt() 함수로 RSA 암호화를 진행할 수 있습니다.\n해당 과정은 아래와 같이 구현됩니다.\nCopy python publicKey = rsa.PublicKey(int(nvalue,16), int(evalue,16)) value = ''.join([chr(len(key))+key for key in [sessionKey, id, pw]]) encpw = rsa.encrypt(value.encode(), publicKey).hex() 여기까지의 과정으로 dynamicKey, encpw, encnm의 값을 얻을 수 있습니다.\nbvsd 값 생성하기 # 마지막으로 필요한 bvsd 값에 대한 단서는 응답 문서 내에서\nbvsd.1.3.8.min.js란 명칭으로 알기 쉽게 확인할 수 있지만\n그 내용은 가독성 면에서 쉽게 해석하기 어려웠습니다.\n다른 자료를 참고했을 때 bvsd는 브라우저가 정상적인지 여부를 파악하기 위한 값으로\n해당 값이 없을 경우 로그인 과정에서 캡차를 발생시킨다는 것을 알 수 있었습니다.\nbvsd.1.3.8.min.js에서 주목할 부분은 uuid 및 encData를 생성하는 부분인데\n아래 코드에서 encData는 o라는 값을 인코딩하는 것으로 추측됩니다.\no 값을 코드 내에서 찾아보니 아래와 같이 디바이스의 마우스 상태 등을\n기록한 값임을 확인할 수 있었습니다.\nCopy js o = { a: n, b: \"1.3.8\", c: (0, m[\"default\"])(), d: r, e: this._deviceOrientation.get(), f: this._deviceMotion.get(), g: this._mouse.get(), j: this._fpDuration || y.NOT_YET, h: this._fpHash || \"\", i: this._fpComponent || [] }; 하지만 각각의 값을 해석하고 생성하는 것은 쉽지 않았기에\n이미 완성된 코드를 참고하여 set_bvsd() 메소드를 정의했습니다.\nencData의 인코딩에는 lzstring 모듈의\nLZString.compressToEncodedURIComponent() 함수를 활용했습니다.\nCopy python from lzstring import LZString import uuid ENC_DATA = lambda uuid, userid, passwd: str({ \"a\": f\"{uuid}-4\", \"b\": \"1.3.4\", \"d\": [{ \"i\": \"id\", \"b\": {\"a\": [\"0\", userid]}, \"d\": userid, \"e\": \"false\", \"f\": \"false\" }, { \"i\": passwd, \"e\": \"true\", \"f\": \"false\" }], \"h\": \"1f\", \"i\": {\"a\": \"Mozilla/5.0\"} }).replace('\\'','\\\"') class NaverLogin(LoginSpider): def set_bvsd(self): uuid4 = str(uuid.uuid4()) encData = LZString.compressToEncodedURIComponent(ENC_DATA(uuid4, self.userid, self.passwd)) self.bvsd = str({\"uuid\":uuid4, \"encData\":encData}).replace('\\'','\\\"') 네이버 로그인 구현 # 지금까지의 과정을 통해 네이버 로그인에 필요한\ndynamicKey, encpw, bvsd, encnm 값을 생성하는 법을 파악했습니다.\n이를 NaverLogin 클래스의 메소드로 구현해보겠습니다.\nRSA 암호화 구현 # 먼저 dynamicKey와 함께 encpw, encmn 생성에 필요한\nsession_keys를 가져오기 위한 메소드 fetch_keys()와,\nRSA 암호화를 통해 encpw 값을 구하는 set_encpw() 메소드를 정의합니다.\nCopy python from bs4 import BeautifulSoup import rsa LOGIN_URL = \"https://nid.naver.com/nidlogin.login\" class NaverLogin(LoginSpider): def fetch_keys(self): response = self.get(LOGIN_URL, headers=self.get_headers(host=LOGIN_URL), params={\"svctype\":\"262144\"}) source = BeautifulSoup(response.text, 'lxml') keys = source.find(\"input\", {\"id\":\"session_keys\"}).attrs.get(\"value\") self.sessionKey, self.encnm, n, e = keys.split(\",\") self.dynamicKey = source.find(\"input\", {\"id\":\"dynamicKey\"}).attrs.get(\"value\") self.publicKey = rsa.PublicKey(int(n,16), int(e,16)) session_keys의 경우 모바일 로그인 페이지에서만 가져올 수 있기 때문에\nsvctype=262144를 GET 요청의 파라미터로 전달해 모바일 로그인 페이지를 가져옵니다.\nnvalue와 evalue는 별도의 변수로 저장하지 않고\npublicKey를 생성해 클래스 변수로 저장합니다.\nCopy python class NaverLogin(LoginSpider): def set_encpw(self): value = \"\".join([chr(len(key))+key for key in [self.sessionKey, self.userid, self.passwd]]) self.encpw = rsa.encrypt(value.encode(), self.publicKey).hex() 앞에서 가져온 sessionKey와 함께 미리 초기화된 네이버 아이디 및 비밀번호를\n조합 및 암호화하여 encpw를 생성합니다.\nPOST 요청 구현 # 미리 정의한 set_bvsd() 메소드를 포함해 모든 준비 과정이 마무리되었습니다.\n클래스 변수로 저장된 암호화된 값들을 데이터에 담아 POST 로그인 요청을 보내는\nlogin() 메소드는 다음과 같이 정의할 수 있습니다.\nCopy python NAVER_URL = \"https://www.naver.com\" LOGIN_DATA = lambda dynamicKey, encpw, bvsd, encnm: { \"localechange\": \"\", \"dynamicKey\": dynamicKey, \"encpw\": encpw, \"enctp\": \"1\", \"svctype\": \"1\", \"smart_LEVEL\": \"1\", \"bvsd\": bvsd, \"encnm\": encnm, \"locale\": \"ko_KR\", \"url\": quote_plus(NAVER_URL), \"id\": \"\", \"pw\": \"\", } class NaverLogin(LoginSpider): def login(self): self.fetch_keys() self.set_encpw() self.set_bvsd() data = LOGIN_DATA(self.dynamicKey, self.encpw, self.bvsd, self.encnm) headers = self.get_headers(LOGIN_URL, referer=LOGIN_URL) headers[\"Content-Type\"] = \"application/x-www-form-urlencoded\" headers[\"Upgrade-Insecure-Requests\"] = \"1\" self.post(LOGIN_URL, data=data, headers=headers) POST 요청 시 전달되었던 데이터와 동일한 값을 반환하는 LOGIN_DATA 함수를 생성하고\n암호화된 값을 전달해 최종적인 POST 데이터를 만들었습니다.\n해당 데이터로 요청을 보낼 경우 정상적인 응답을 받게 되고\nNaverLogin 세션 객체의 쿠키 값을 확인하면 아래와 같은 결과를 확인할 수 있습니다.\nCopy python naver = NaverLogin(\"userid\", \"passwd\") naver.login() naver.get_cookies() ====================================== 'NID_AUT=...; NID_JKL=...; NID_SES=...; nid_inf=1228467713' 또한 해당 결과는 개발자 도구에서도 응답 헤더의 set-cookie 값에서 찾아볼 수 있습니다.\n지금까지의 과정으로 네이버 로그인 과정을 거쳤을 때,\n게시글의 서두에서 언급한 쿠키 값의 목록 중에서 일부 값을 획득할 수 있습니다.\nCopy python cookies = { \"NNB\": \"...\", \"nid_inf\": \"...\", \"NID_AUT\": \"...\", \"NID_SES\": \"...\", \"NID_JKL\": \"...\", \"CBI_SES\": \"...\", \"CBI_CHK\": \"...\", \"NSI\": \"...\", } 이 중에서 NNB의 경우 네이버 페이지 접속 시 기본적으로 부여되는 값이기 때문에 무시하고\nNID_AUT, NID_JKL, NID_SES가 채워졌습니다.\n나머지 값들은 스마트스토어센터 로그인 과정에서 얻을 수 있기 때문에\n다음 게시글에서 다뤄보도록 하겠습니다.\n","wordCount":"1184","inLanguage":"en","datePublished":"2022-12-03T16:11:42+09:00","dateModified":"2022-12-03T16:11:42+09:00","author":{"@type":"Person","name":"minyeamer"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://minyeamer.github.io/blog/smartstore-login-2/"},"publisher":{"@type":"Person","name":"Minystory","logo":{"@type":"ImageObject","url":"https://minyeamer.github.io/images/favicons/favicon.ico"}}}</script><title>[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (2) | Minystory</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://minyeamer.github.io/blog/smartstore-login-2/><link rel=stylesheet href=/book.min.62dc4b2346a11e9a13be7a0d196670bb5af67df65ab7af97fca989a18278bf57.css integrity="sha256-YtxLI0ahHpoTvnoNGWZwu1r2ffZat6+X/KmJoYJ4v1c=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/search-input.min.d96703ecea94876541f8c7c2a377937aabc453dbf25b191ec06ed05c8eb76dbe.js integrity="sha256-2WcD7OqUh2VB+MfCo3eTeqvEU9vyWxkewG7QXI63bb4=" crossorigin=anonymous></script><link rel=preload href=/search-data.min.d8230bedff175a96b9214f4b0be4b94c0a75563fb182ddc9fe65cdc891987514.json as=fetch crossorigin><script>window.SEARCH_DATA_URL="/search-data.min.d8230bedff175a96b9214f4b0be4b94c0a75563fb182ddc9fe65cdc891987514.json"</script><script defer src=/search.min.f30f9834d4764fd9751da64098c954d01085f648ba9ca421a3c97582f8c47253.js integrity="sha256-8w+YNNR2T9l1HaZAmMlU0BCF9ki6nKQho8l1gvjEclM=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-BJ8Z9RMBPJ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BJ8Z9RMBPJ")</script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css crossorigin=anonymous><script defer src=/scroll-progress.min.841ade7e507a5f6d59c4e7bf2fe2b2ca034070677ff7957eec55610a024dd776.js integrity="sha256-hBreflB6X21ZxOe/L+KyygNAcGd/95V+7FVhCgJN13Y=" crossorigin=anonymous></script><script defer src=/dark-mode.min.e41c6440ffd9967d6f6a419ff3ce09b862009fe1646ab265f5cb2817d2a508e3.js integrity="sha256-5BxkQP/Zln1vakGf884JuGIAn+FkarJl9csoF9KlCOM=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.9.0/highlightjs-line-numbers.min.js></script><script defer src=/copy-code.min.aaeef965f0b4992e55f976edaecb34a89d414e1791caa18c3f4f4376c6d8b5a8.js integrity="sha256-qu75ZfC0mS5V+Xbtrss0qJ1BTheRyqGMP09DdsbYtag=" crossorigin=anonymous></script><script defer src=/toc-highlightjs.093016f0ef312174ad862fdcf5792e88ab5442bd39beecc38d15643f71ab5c31.min integrity="sha256-CTAW8O8xIXSthi/c9XkuiKtUQr05vuzDjRVkP3GrXDE=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-post book-layout-post"><div class=scroll-progress><div class=scroll-progress-bar></div></div><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><div class=sidebar-profile><div class=profile-img-wrap><a href=https://minyeamer.github.io/><img src=/images/profile/menu.jpg alt=Profile class=profile-img></a></div><div class=sidebar-social><a href=https://github.com/minyeamer target=_blank title=GitHub><i class="fa-brands fa-github"></i>
</a><a href=/categories/ title=Categories><i class="fa-solid fa-folder"></i>
</a><a href=/tags/ title=Tags><i class="fa-solid fa-tags"></i>
</a><button id=dark-mode-toggle class=dark-mode-toggle aria-label="Toggle dark mode">
<i class="fa-solid fa-circle-half-stroke"></i></button></div></div><h2 class=book-brand><a class="flex align-center" href=/><span>Minystory</span></a></h2><div class="book-search hidden"><div class=search-input-container><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/ onkeydown='event.key==="Enter"&&goToSearchPage()'>
<button type=button id=book-search-button class=book-search-btn onclick=goToSearchPage()>
<i class="fa-solid fa-magnifying-glass"></i></button></div><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden");function goToSearchPage(){const t=document.getElementById("book-search-input"),e=t.value.trim();e&&(window.location.href="/search/?q="+encodeURIComponent(e))}</script><div class=book-categories><input type=checkbox class="hidden toggle" id=categories-control checked>
<label for=categories-control class="categories-toggle categories-link"><a href=/categories/><i class="fa-solid fa-folder"></i>
<span>전체</span>
<span class=category-count>(9)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul class=categories-menu id=categories-menu><li><input type=checkbox class="hidden toggle" id=cat-data-engineering>
<label for=cat-data-engineering class="categories-toggle categories-link"><a href=/categories/data-engineering/><i class="fa-solid fa-folder"></i>
Data Engineering
<span class=category-count>(4)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/data-engineering/crawling/><i class="fa-solid fa-file"></i>
Crawling
<span class=category-count>(4)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-frontend>
<label for=cat-frontend class="categories-toggle categories-link"><a href=/categories/frontend/><i class="fa-solid fa-folder"></i>
Frontend
<span class=category-count>(4)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/frontend/blog/><i class="fa-solid fa-file"></i>
Blog
<span class=category-count>(4)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-project>
<label for=cat-project class="categories-toggle categories-link"><a href=/categories/project/><i class="fa-solid fa-folder"></i>
Project
<span class=category-count>(1)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/project/open-source/><i class="fa-solid fa-file"></i>
Open Source
<span class=category-count>(1)</span></a></li></ul></li></ul></div><div class=recent-posts><div class=recent-posts-header><i class="fa-solid fa-clock"></i>
<span>최신글</span></div><ul class=recent-posts-list><li class=recent-post-item><a href=/blog/openup-handson/ title="[OSSCA] 2025 오픈소스 컨트리뷰션 아카데미 - PyTorch 문서 한글화 참여 후기"><div class=recent-post-title>[OSSCA] 2025 오픈소스 컨트리뷰션 아카데미 - PyTorch 문서 한글화 참여 후기</div><div class=recent-post-date><time datetime=2025-10-28>2025.10.28</time></div></a></li><li class=recent-post-item><a href=/blog/10000-recipe/ title="[Python] 만개의 레시피 데이터 수집"><div class=recent-post-title>[Python] 만개의 레시피 데이터 수집</div><div class=recent-post-date><time datetime=2023-03-26>2023.03.26</time></div></a></li><li class=recent-post-item><a href=/blog/smartstore-login-3/ title="[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (3)"><div class=recent-post-title>[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (3)</div><div class=recent-post-date><time datetime=2022-12-04>2022.12.04</time></div></a></li><li class=recent-post-item><a href=/blog/smartstore-login-2/ title="[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (2)"><div class=recent-post-title>[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (2)</div><div class=recent-post-date><time datetime=2022-12-03>2022.12.03</time></div></a></li><li class=recent-post-item><a href=/blog/smartstore-login-1/ title="[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (1)"><div class=recent-post-title>[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (1)</div><div class=recent-post-date><time datetime=2022-12-03>2022.12.03</time></div></a></li></ul></div></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><i class="fa-solid fa-bars book-icon" id=menu-icon></i></label><h3><a href=https://minyeamer.github.io/ class=site-title>Minystory</a></h3><label for=toc-control><i class="fa-solid fa-list book-icon" id=toc-icon></i></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#네이버-로그인-이해>네이버 로그인 이해</a><ul><li><a href=#네이버-로그인-요청-분석>네이버 로그인 요청 분석</a></li><li><a href=#네이버-로그인-폼-분석>네이버 로그인 폼 분석</a></li><li><a href=#네이버-로그인-rsa-암호화>네이버 로그인 RSA 암호화</a></li><li><a href=#bvsd-값-생성하기>bvsd 값 생성하기</a></li></ul></li><li><a href=#네이버-로그인-구현>네이버 로그인 구현</a><ul><li><a href=#rsa-암호화-구현>RSA 암호화 구현</a></li><li><a href=#post-요청-구현>POST 요청 구현</a></li></ul></li></ul></nav><div class=book-nav><button class=book-nav-btn3 onclick='window.scrollTo({top:0,behavior:"smooth"})' title="Go to top">
<i class="fa fa-chevron-up"></i>
</button>
<button class=book-nav-btn3 onclick='window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})' title="Go to bottom">
<i class="fa fa-chevron-down"></i>
<button class=book-nav-btn3 onclick=history.back() title="Go back">
<i class="fa-solid fa-arrow-left"></i></button></div></aside></header><article class="markdown book-article"><header class=post-header><div class=post-header-category><a href=/categories/data-engineering/crawling/ class=post-header-category-link>Data Engineering/Crawling</a></div><h1 class=post-header-title>[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (2)</h1><div class=post-header-date><time datetime=2022-12-03T16:11:42+09:00>2022. 12. 3. 16:11</time></div></header><p>이번 게시글에서는 스마트스토어센터 페이지에서 데이터를 수집하는 자동화 프로그램을 제작하기 위한<br>첫 번째 과정으로 네이버 로그인을 구현할 것입니다.</p><p>앞선 게시글에서 데이터를 수집하는 방식에 대해 알아보면서<br>로그인이 필요한 페이지에 접근하기 다음과 같은 쿠키 값이 필요함을 확인했습니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>cookies</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;NNB&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;nid_inf&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;NID_AUT&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;NID_SES&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;NID_JKL&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;CBI_SES&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;CBI_CHK&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;NSI&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>위 키값들은 앞으로 로그인 프로세스를 파악하는 과정에서 중요하게 활용됩니다.</p><hr><h2 id=네이버-로그인-이해>네이버 로그인 이해
<a class=anchor href=#%eb%84%a4%ec%9d%b4%eb%b2%84-%eb%a1%9c%ea%b7%b8%ec%9d%b8-%ec%9d%b4%ed%95%b4>#</a></h2><p>네이버 스마트스토어센터 로그인 과정에서 진행되는 네이버 로그인은<br>일반적인 네이버 로그인과는 다른 과정으로 진행됩니다.</p><p>따라서 우선 일반적인 네이버 로그인 과정을 알아보겠습니다.</p><p>해당 파트는 아래 게시글을 참고해 작성되었습니다.</p><blockquote class=book-hint><p><a href="https://blog.naver.com/PostView.naver?blogId=nkj2001&amp;logNo=222722322802" target=_blank rel="noopener noreferrer">파이썬#76 - 파이썬 크롤링 requests 로 네이버 로그인 하기</a></p></blockquote><h3 id=네이버-로그인-요청-분석>네이버 로그인 요청 분석
<a class=anchor href=#%eb%84%a4%ec%9d%b4%eb%b2%84-%eb%a1%9c%ea%b7%b8%ec%9d%b8-%ec%9a%94%ec%b2%ad-%eb%b6%84%ec%84%9d>#</a></h3><p>네이버 로그인 과정을 분석하기 위해서는 우선 네이버 로그인을 요청을 시도하여<br>전달되는 값을 확인해야 합니다.</p><p>네이버 로그인 페이지에서 로그인을 수행하는 과정에서<br>발견할 수 있는 POST 요청을 살펴보면 다음과 같은 데이터가 전달됨을 발견할 수 있습니다.</p><p><img src="https://github.com/minyeamer/til/blob/main/.media/data/crawling/smartstore-login/nid-login.png?raw=true" alt=nid-login></p><p>암호화된 값을 생략하고 키로 전달되는 내용을 확인하면 다음과 같습니다.</p><div class=book-codeblock data-lang=json><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">json</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;localechange&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;dynamicKey&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;encpw&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;enctp&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;svctype&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;smart_LEVEL&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;bvsd&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;uuid&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;encData&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;encnm&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;locale&#34;</span><span class=p>:</span> <span class=s2>&#34;ko_KR&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;url&#34;</span><span class=p>:</span> <span class=s2>&#34;https://www.naver.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;pw&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>공백이나 고정된 값을 가진 키를 제외하면 결과적으로<br><code>dynamicKey</code>, <code>encpw</code>, <code>bvsd</code>, <code>encnm</code>를 밝혀내는 것이 중요할 것이라 판단됩니다.</p><h3 id=네이버-로그인-폼-분석>네이버 로그인 폼 분석
<a class=anchor href=#%eb%84%a4%ec%9d%b4%eb%b2%84-%eb%a1%9c%ea%b7%b8%ec%9d%b8-%ed%8f%bc-%eb%b6%84%ec%84%9d>#</a></h3><p>키의 명칭만으로는 무엇을 의미하는지 알 수 없기 때문에<br>로그인 페이지 소스에서 키명칭을 검색하였고 네이버 로그인 폼에서 하나의 단서를 찾을 수 있었습니다.</p><p><img src="https://github.com/minyeamer/til/blob/main/.media/data/crawling/smartstore-login/nid-form.png?raw=true" alt=nid-form></p><p><code>dynamicKey</code>의 경우 로그인 폼에 동적으로 부여되는 값임을 알 수 있습니다.<br>하지만 나머지 <code>encpw</code>, <code>bvsd</code>, <code>encnm</code>의 값은 비어있기 때문에<br>다른 자바스크립트 응답을 분석해야 합니다.</p><h3 id=네이버-로그인-rsa-암호화>네이버 로그인 RSA 암호화
<a class=anchor href=#%eb%84%a4%ec%9d%b4%eb%b2%84-%eb%a1%9c%ea%b7%b8%ec%9d%b8-rsa-%ec%95%94%ed%98%b8%ed%99%94>#</a></h3><p><code>encpw</code> 값에 대한 단서를 찾기 위해 전체 검색을 수행했을 때<br><code>common_202201.js</code> 내부에서 RSA 암호화 처리를 통해 값을 생성함을 알 수 있습니다.<br>그 중에서 가장 처음 단계로 실행될 것이라 추측되는 것이 아래 <code>confirmSubmit()</code> 함수입니다.</p><p><img src="https://github.com/minyeamer/til/blob/main/.media/data/crawling/smartstore-login/encpw.png?raw=true" alt=encpw></p><p>해당 함수는 아이디와 비밀번호의 여부를 체크하고 <code>encryptIdPw()</code> 함수의 결과를 반환합니다.<br>바로 밑에서 확인할 수 있는 <code>encryptIdPw()</code> 함수의 내용은 다음과 같습니다.</p><div class=book-codeblock data-lang=js><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">js</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>encryptIdPw</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>id</span> <span class=o>=</span> <span class=nx>$</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>pw</span> <span class=o>=</span> <span class=nx>$</span><span class=p>(</span><span class=s2>&#34;pw&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>encpw</span> <span class=o>=</span> <span class=nx>$</span><span class=p>(</span><span class=s2>&#34;encpw&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=kd>var</span> <span class=nx>rsa</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>RSAKey</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=nx>keySplit</span><span class=p>(</span><span class=nx>session_keys</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>rsa</span><span class=p>.</span><span class=nx>setPublic</span><span class=p>(</span><span class=nx>evalue</span><span class=p>,</span> <span class=nx>nvalue</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=k>try</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>encpw</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>rsa</span><span class=p>.</span><span class=nx>encrypt</span><span class=p>(</span>
</span></span><span class=line><span class=cl>				<span class=nx>getLenChar</span><span class=p>(</span><span class=nx>sessionkey</span><span class=p>)</span> <span class=o>+</span> <span class=nx>sessionkey</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>				<span class=nx>getLenChar</span><span class=p>(</span><span class=nx>id</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=o>+</span> <span class=nx>id</span><span class=p>.</span><span class=nx>value</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>				<span class=nx>getLenChar</span><span class=p>(</span><span class=nx>pw</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=o>+</span> <span class=nx>pw</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span> <span class=k>catch</span><span class=p>(</span><span class=nx>e</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>$</span><span class=p>(</span><span class=s1>&#39;enctp&#39;</span><span class=p>).</span><span class=nx>value</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nx>id</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nx>pw</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>else</span>
</span></span><span class=line><span class=cl>	<span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>getKeyByRuntimeInclude</span><span class=p>();</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>해당 함수는 <code>session_keys</code>라는 값을 처리하고 RSA 암호화한 결과를<br><code>encpw</code>의 값으로 대체하는 것을 알 수 있습니다.</p><p>마찬가지로 해당 명칭을 검색했을 때<br><code>session_keys</code>는 Ajax 통신의 응답 결과를 받아오는 것을 확인할 수 있습니다.</p><p><img src="https://github.com/minyeamer/til/blob/main/.media/data/crawling/smartstore-login/session-keys.png?raw=true" alt=session-keys></p><p>하지만 네이버 로그인 페이지에서 <code>svctype=262144</code>를 추가적인 파라미터로 입력할 경우<br>접근할 수 있는 모바일 로그인 페이지에서 해당 값을 확인할 수 있었습니다.</p><p><img src="https://github.com/minyeamer/til/blob/main/.media/data/crawling/smartstore-login/nid-mlogin.png?raw=true" alt=nid-mlogin></p><p>다시 <code>encryptIdPw()</code> 함수로 돌아가서 <code>session_keys</code>를 처리하기 위해<br><code>keySplit()</code> 함수를 찾아보았습니다.</p><div class=book-codeblock data-lang=js><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">js</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>keySplit</span><span class=p>(</span><span class=nx>a</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>keys</span> <span class=o>=</span> <span class=nx>a</span><span class=p>.</span><span class=nx>split</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>a</span> <span class=o>||</span> <span class=o>!</span><span class=nx>keys</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>||</span> <span class=o>!</span><span class=nx>keys</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>||</span> <span class=o>!</span><span class=nx>keys</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>||</span> <span class=o>!</span><span class=nx>keys</span><span class=p>[</span><span class=mi>3</span><span class=p>])</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>sessionkey</span> <span class=o>=</span> <span class=nx>keys</span><span class=p>[</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=nx>keyname</span> <span class=o>=</span> <span class=nx>keys</span><span class=p>[</span><span class=mi>1</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=nx>evalue</span> <span class=o>=</span> <span class=nx>keys</span><span class=p>[</span><span class=mi>2</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=nx>nvalue</span> <span class=o>=</span> <span class=nx>keys</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span>
</span></span><span class=line><span class=cl>	<span class=nx>$</span><span class=p>(</span><span class=s2>&#34;encnm&#34;</span><span class=p>).</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>keyname</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>모바일 페이지에서 볼 수 있는 <code>session_keys</code> 값은 콤마를 기준으로<br>4개의 값으로 구분되어 있었는데 해당 함수에서는 각각을<br><code>sessionKey</code>, <code>encnm</code>, <code>evalue</code>, <code>nvalue</code>으로 분리했습니다.</p><p>여기서 <code>encnm</code> 값을 우선적으로 가져올 수 있었고,<br>다음으로 <code>encpw</code> 값을 찾기 위해 RSA 암호화 부분을 탐색해봅니다.</p><div class=book-codeblock data-lang=js><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">js</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>rsa</span><span class=p>.</span><span class=nx>setPublic</span><span class=p>(</span><span class=nx>evalue</span><span class=p>,</span> <span class=nx>nvalue</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nx>encpw</span><span class=p>.</span><span class=nx>value</span> <span class=o>=</span> <span class=nx>rsa</span><span class=p>.</span><span class=nx>encrypt</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=nx>getLenChar</span><span class=p>(</span><span class=nx>sessionkey</span><span class=p>)</span> <span class=o>+</span> <span class=nx>sessionkey</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>    <span class=nx>getLenChar</span><span class=p>(</span><span class=nx>id</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=o>+</span> <span class=nx>id</span><span class=p>.</span><span class=nx>value</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>    <span class=nx>getLenChar</span><span class=p>(</span><span class=nx>pw</span><span class=p>.</span><span class=nx>value</span><span class=p>)</span> <span class=o>+</span> <span class=nx>pw</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span></span></span></code></pre></div></div><p><code>session_keys</code>에서 분리된 <code>evalue</code>와 <code>nvalue</code>로 RSA 공개키를 생성하고<br>마찬가지로 <code>session_keys</code>에 포함된 <code>sessionKey</code> 및 아이디, 비밀번호의 조합을<br>암호화한 결과가 <code>encpw</code>임을 확인할 수 있습니다.</p><p>파이썬에서는 공개키 생성을 <code>rsa.PublicKey()</code> 함수로 수행할 수 있으며<br><code>rsa.encrypt()</code> 함수로 RSA 암호화를 진행할 수 있습니다.<br>해당 과정은 아래와 같이 구현됩니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>publicKey</span> <span class=o>=</span> <span class=n>rsa</span><span class=o>.</span><span class=n>PublicKey</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>nvalue</span><span class=p>,</span><span class=mi>16</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>evalue</span><span class=p>,</span><span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>value</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>))</span><span class=o>+</span><span class=n>key</span> <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=p>[</span><span class=n>sessionKey</span><span class=p>,</span> <span class=nb>id</span><span class=p>,</span> <span class=n>pw</span><span class=p>]])</span>
</span></span><span class=line><span class=cl><span class=n>encpw</span> <span class=o>=</span> <span class=n>rsa</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>value</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=n>publicKey</span><span class=p>)</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span></span></span></code></pre></div></div><p>여기까지의 과정으로 <code>dynamicKey</code>, <code>encpw</code>, <code>encnm</code>의 값을 얻을 수 있습니다.</p><h3 id=bvsd-값-생성하기>bvsd 값 생성하기
<a class=anchor href=#bvsd-%ea%b0%92-%ec%83%9d%ec%84%b1%ed%95%98%ea%b8%b0>#</a></h3><p>마지막으로 필요한 <code>bvsd</code> 값에 대한 단서는 응답 문서 내에서<br><code>bvsd.1.3.8.min.js</code>란 명칭으로 알기 쉽게 확인할 수 있지만<br>그 내용은 가독성 면에서 쉽게 해석하기 어려웠습니다.</p><p>다른 자료를 참고했을 때 <code>bvsd</code>는 브라우저가 정상적인지 여부를 파악하기 위한 값으로<br>해당 값이 없을 경우 로그인 과정에서 캡차를 발생시킨다는 것을 알 수 있었습니다.</p><p><code>bvsd.1.3.8.min.js</code>에서 주목할 부분은 <code>uuid</code> 및 <code>encData</code>를 생성하는 부분인데<br>아래 코드에서 <code>encData</code>는 <code>o</code>라는 값을 인코딩하는 것으로 추측됩니다.</p><p><img src="https://github.com/minyeamer/til/blob/main/.media/data/crawling/smartstore-login/bvsd.png?raw=true" alt=bvsd></p><p><code>o</code> 값을 코드 내에서 찾아보니 아래와 같이 디바이스의 마우스 상태 등을<br>기록한 값임을 확인할 수 있었습니다.</p><div class=book-codeblock data-lang=js><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">js</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=nx>o</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>a</span><span class=o>:</span> <span class=nx>n</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>b</span><span class=o>:</span> <span class=s2>&#34;1.3.8&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span><span class=o>:</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nx>m</span><span class=p>[</span><span class=s2>&#34;default&#34;</span><span class=p>])(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>d</span><span class=o>:</span> <span class=nx>r</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>e</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>_deviceOrientation</span><span class=p>.</span><span class=nx>get</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>f</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>_deviceMotion</span><span class=p>.</span><span class=nx>get</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>g</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>_mouse</span><span class=p>.</span><span class=nx>get</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>    <span class=nx>j</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>_fpDuration</span> <span class=o>||</span> <span class=nx>y</span><span class=p>.</span><span class=nx>NOT_YET</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>h</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>_fpHash</span> <span class=o>||</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>i</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>_fpComponent</span> <span class=o>||</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=p>};</span></span></span></code></pre></div></div><p>하지만 각각의 값을 해석하고 생성하는 것은 쉽지 않았기에<br>이미 완성된 코드를 참고하여 <code>set_bvsd()</code> 메소드를 정의했습니다.</p><p><code>encData</code>의 인코딩에는 <code>lzstring</code> 모듈의<br><code>LZString.compressToEncodedURIComponent()</code> 함수를 활용했습니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>lzstring</span> <span class=kn>import</span> <span class=n>LZString</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>uuid</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>ENC_DATA</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>uuid</span><span class=p>,</span> <span class=n>userid</span><span class=p>,</span> <span class=n>passwd</span><span class=p>:</span> <span class=nb>str</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;a&#34;</span><span class=p>:</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>uuid</span><span class=si>}</span><span class=s2>-4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;b&#34;</span><span class=p>:</span> <span class=s2>&#34;1.3.4&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;d&#34;</span><span class=p>:</span> <span class=p>[{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;i&#34;</span><span class=p>:</span> <span class=s2>&#34;id&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;b&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;a&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;0&#34;</span><span class=p>,</span> <span class=n>userid</span><span class=p>]},</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;d&#34;</span><span class=p>:</span> <span class=n>userid</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;e&#34;</span><span class=p>:</span> <span class=s2>&#34;false&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;f&#34;</span><span class=p>:</span> <span class=s2>&#34;false&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;i&#34;</span><span class=p>:</span> <span class=n>passwd</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;e&#34;</span><span class=p>:</span> <span class=s2>&#34;true&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;f&#34;</span><span class=p>:</span> <span class=s2>&#34;false&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}],</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;h&#34;</span><span class=p>:</span> <span class=s2>&#34;1f&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;i&#34;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;a&#34;</span><span class=p>:</span> <span class=s2>&#34;Mozilla/5.0&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>})</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\&#39;</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;</span><span class=se>\&#34;</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>NaverLogin</span><span class=p>(</span><span class=n>LoginSpider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>set_bvsd</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>uuid4</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>uuid</span><span class=o>.</span><span class=n>uuid4</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>encData</span> <span class=o>=</span> <span class=n>LZString</span><span class=o>.</span><span class=n>compressToEncodedURIComponent</span><span class=p>(</span><span class=n>ENC_DATA</span><span class=p>(</span><span class=n>uuid4</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>userid</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>passwd</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>bvsd</span> <span class=o>=</span> <span class=nb>str</span><span class=p>({</span><span class=s2>&#34;uuid&#34;</span><span class=p>:</span><span class=n>uuid4</span><span class=p>,</span> <span class=s2>&#34;encData&#34;</span><span class=p>:</span><span class=n>encData</span><span class=p>})</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39;</span><span class=se>\&#39;</span><span class=s1>&#39;</span><span class=p>,</span><span class=s1>&#39;</span><span class=se>\&#34;</span><span class=s1>&#39;</span><span class=p>)</span></span></span></code></pre></div></div><hr><h2 id=네이버-로그인-구현>네이버 로그인 구현
<a class=anchor href=#%eb%84%a4%ec%9d%b4%eb%b2%84-%eb%a1%9c%ea%b7%b8%ec%9d%b8-%ea%b5%ac%ed%98%84>#</a></h2><p>지금까지의 과정을 통해 네이버 로그인에 필요한<br><code>dynamicKey</code>, <code>encpw</code>, <code>bvsd</code>, <code>encnm</code> 값을 생성하는 법을 파악했습니다.</p><p>이를 <code>NaverLogin</code> 클래스의 메소드로 구현해보겠습니다.</p><h3 id=rsa-암호화-구현>RSA 암호화 구현
<a class=anchor href=#rsa-%ec%95%94%ed%98%b8%ed%99%94-%ea%b5%ac%ed%98%84>#</a></h3><p>먼저 <code>dynamicKey</code>와 함께 <code>encpw</code>, <code>encmn</code> 생성에 필요한<br><code>session_keys</code>를 가져오기 위한 메소드 <code>fetch_keys()</code>와,<br>RSA 암호화를 통해 encpw 값을 구하는 <code>set_encpw()</code> 메소드를 정의합니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>bs4</span> <span class=kn>import</span> <span class=n>BeautifulSoup</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>rsa</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>LOGIN_URL</span> <span class=o>=</span> <span class=s2>&#34;https://nid.naver.com/nidlogin.login&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>NaverLogin</span><span class=p>(</span><span class=n>LoginSpider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>fetch_keys</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>response</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>LOGIN_URL</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>get_headers</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=n>LOGIN_URL</span><span class=p>),</span> <span class=n>params</span><span class=o>=</span><span class=p>{</span><span class=s2>&#34;svctype&#34;</span><span class=p>:</span><span class=s2>&#34;262144&#34;</span><span class=p>})</span>
</span></span><span class=line><span class=cl>        <span class=n>source</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=s1>&#39;lxml&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>keys</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;input&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;session_keys&#34;</span><span class=p>})</span><span class=o>.</span><span class=n>attrs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;value&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>sessionKey</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>encnm</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>e</span> <span class=o>=</span> <span class=n>keys</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>dynamicKey</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>find</span><span class=p>(</span><span class=s2>&#34;input&#34;</span><span class=p>,</span> <span class=p>{</span><span class=s2>&#34;id&#34;</span><span class=p>:</span><span class=s2>&#34;dynamicKey&#34;</span><span class=p>})</span><span class=o>.</span><span class=n>attrs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;value&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>publicKey</span> <span class=o>=</span> <span class=n>rsa</span><span class=o>.</span><span class=n>PublicKey</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>n</span><span class=p>,</span><span class=mi>16</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>e</span><span class=p>,</span><span class=mi>16</span><span class=p>))</span></span></span></code></pre></div></div><p><code>session_keys</code>의 경우 모바일 로그인 페이지에서만 가져올 수 있기 때문에<br><code>svctype=262144</code>를 GET 요청의 파라미터로 전달해 모바일 로그인 페이지를 가져옵니다.</p><p><code>nvalue</code>와 <code>evalue</code>는 별도의 변수로 저장하지 않고<br><code>publicKey</code>를 생성해 클래스 변수로 저장합니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>NaverLogin</span><span class=p>(</span><span class=n>LoginSpider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>set_encpw</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>value</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>key</span><span class=p>))</span><span class=o>+</span><span class=n>key</span> <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>sessionKey</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>userid</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>passwd</span><span class=p>]])</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>encpw</span> <span class=o>=</span> <span class=n>rsa</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>value</span><span class=o>.</span><span class=n>encode</span><span class=p>(),</span> <span class=bp>self</span><span class=o>.</span><span class=n>publicKey</span><span class=p>)</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span></span></span></code></pre></div></div><p>앞에서 가져온 <code>sessionKey</code>와 함께 미리 초기화된 네이버 아이디 및 비밀번호를<br>조합 및 암호화하여 <code>encpw</code>를 생성합니다.</p><h3 id=post-요청-구현>POST 요청 구현
<a class=anchor href=#post-%ec%9a%94%ec%b2%ad-%ea%b5%ac%ed%98%84>#</a></h3><p>미리 정의한 <code>set_bvsd()</code> 메소드를 포함해 모든 준비 과정이 마무리되었습니다.</p><p>클래스 변수로 저장된 암호화된 값들을 데이터에 담아 POST 로그인 요청을 보내는<br><code>login()</code> 메소드는 다음과 같이 정의할 수 있습니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>NAVER_URL</span> <span class=o>=</span> <span class=s2>&#34;https://www.naver.com&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>LOGIN_DATA</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>dynamicKey</span><span class=p>,</span> <span class=n>encpw</span><span class=p>,</span> <span class=n>bvsd</span><span class=p>,</span> <span class=n>encnm</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;localechange&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;dynamicKey&#34;</span><span class=p>:</span> <span class=n>dynamicKey</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;encpw&#34;</span><span class=p>:</span> <span class=n>encpw</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;enctp&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;svctype&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;smart_LEVEL&#34;</span><span class=p>:</span> <span class=s2>&#34;1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;bvsd&#34;</span><span class=p>:</span> <span class=n>bvsd</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;encnm&#34;</span><span class=p>:</span> <span class=n>encnm</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;locale&#34;</span><span class=p>:</span> <span class=s2>&#34;ko_KR&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;url&#34;</span><span class=p>:</span> <span class=n>quote_plus</span><span class=p>(</span><span class=n>NAVER_URL</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;pw&#34;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>NaverLogin</span><span class=p>(</span><span class=n>LoginSpider</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>login</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fetch_keys</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>set_encpw</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>set_bvsd</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span> <span class=o>=</span> <span class=n>LOGIN_DATA</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>dynamicKey</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>encpw</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>bvsd</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>encnm</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>headers</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>get_headers</span><span class=p>(</span><span class=n>LOGIN_URL</span><span class=p>,</span> <span class=n>referer</span><span class=o>=</span><span class=n>LOGIN_URL</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>headers</span><span class=p>[</span><span class=s2>&#34;Content-Type&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;application/x-www-form-urlencoded&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>headers</span><span class=p>[</span><span class=s2>&#34;Upgrade-Insecure-Requests&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;1&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>LOGIN_URL</span><span class=p>,</span> <span class=n>data</span><span class=o>=</span><span class=n>data</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span></span></span></code></pre></div></div><p>POST 요청 시 전달되었던 데이터와 동일한 값을 반환하는 <code>LOGIN_DATA</code> 함수를 생성하고<br>암호화된 값을 전달해 최종적인 POST 데이터를 만들었습니다.</p><p>해당 데이터로 요청을 보낼 경우 정상적인 응답을 받게 되고<br><code>NaverLogin</code> 세션 객체의 쿠키 값을 확인하면 아래와 같은 결과를 확인할 수 있습니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>naver</span> <span class=o>=</span> <span class=n>NaverLogin</span><span class=p>(</span><span class=s2>&#34;userid&#34;</span><span class=p>,</span> <span class=s2>&#34;passwd&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>naver</span><span class=o>.</span><span class=n>login</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>naver</span><span class=o>.</span><span class=n>get_cookies</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=o>======================================</span>
</span></span><span class=line><span class=cl><span class=s1>&#39;NID_AUT=...; NID_JKL=...; NID_SES=...; nid_inf=1228467713&#39;</span></span></span></code></pre></div></div><p>또한 해당 결과는 개발자 도구에서도 응답 헤더의 <code>set-cookie</code> 값에서 찾아볼 수 있습니다.</p><p><img src="https://github.com/minyeamer/til/blob/main/.media/data/crawling/smartstore-login/nid-cookies.png?raw=true" alt=nid-cookies></p><p>지금까지의 과정으로 네이버 로그인 과정을 거쳤을 때,<br>게시글의 서두에서 언급한 쿠키 값의 목록 중에서 일부 값을 획득할 수 있습니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>cookies</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;NNB&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;nid_inf&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;NID_AUT&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;NID_SES&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;NID_JKL&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;CBI_SES&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;CBI_CHK&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;NSI&#34;</span><span class=p>:</span> <span class=s2>&#34;...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>이 중에서 <code>NNB</code>의 경우 네이버 페이지 접속 시 기본적으로 부여되는 값이기 때문에 무시하고<br><code>NID_AUT</code>, <code>NID_JKL</code>, <code>NID_SES</code>가 채워졌습니다.</p><p>나머지 값들은 스마트스토어센터 로그인 과정에서 얻을 수 있기 때문에<br>다음 게시글에서 다뤄보도록 하겠습니다.</p></article><div class=book-mobile-nav><button class=book-nav-btn3 onclick='window.scrollTo({top:0,behavior:"smooth"})' title="Go to top">
<i class="fa fa-chevron-up"></i>
</button>
<button class=book-nav-btn3 onclick='window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})' title="Go to bottom">
<i class="fa fa-chevron-down"></i>
<button class=book-nav-btn3 onclick=history.back() title="Go back">
<i class="fa-solid fa-arrow-left"></i></button></div><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class=post-tags><a href=/tags/crawling/ class=tag>#Crawling</a>
<a href=/tags/python/ class=tag>#Python</a>
<a href=/tags/naver/ class=tag>#Naver</a>
<a href=/tags/%EB%84%A4%EC%9D%B4%EB%B2%84/ class=tag>#네이버</a>
<a href=/tags/%EC%8A%A4%EB%A7%88%ED%8A%B8%EC%8A%A4%ED%86%A0%EC%96%B4/ class=tag>#스마트스토어</a></div><div class=post-navigation><a href=/blog/smartstore-login-3/ class="post-nav-link post-nav-prev"><span class=post-nav-direction><i class="fa-solid fa-backward"></i> PREV</span>
<span class=post-nav-title>[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (3)</span>
</a><a href=/blog/smartstore-login-1/ class="post-nav-link post-nav-next"><span class=post-nav-direction>NEXT <i class="fa-solid fa-forward"></i></span>
<span class=post-nav-title>[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (1)</span></a></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script><div class=book-comments><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://minyeamer.github.io/blog/smartstore-login-2/",this.page.identifier="https://minyeamer.github.io/blog/smartstore-login-2/"};(function(){var e=document,t=e.createElement("script");t.src="https://minyeamer.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})();function reloadDisqus(){window.DISQUS&&DISQUS.reset({reload:!0,config:function(){this.page.url="https://minyeamer.github.io/blog/smartstore-login-2/",this.page.identifier="https://minyeamer.github.io/blog/smartstore-login-2/"}})}</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#네이버-로그인-이해>네이버 로그인 이해</a><ul><li><a href=#네이버-로그인-요청-분석>네이버 로그인 요청 분석</a></li><li><a href=#네이버-로그인-폼-분석>네이버 로그인 폼 분석</a></li><li><a href=#네이버-로그인-rsa-암호화>네이버 로그인 RSA 암호화</a></li><li><a href=#bvsd-값-생성하기>bvsd 값 생성하기</a></li></ul></li><li><a href=#네이버-로그인-구현>네이버 로그인 구현</a><ul><li><a href=#rsa-암호화-구현>RSA 암호화 구현</a></li><li><a href=#post-요청-구현>POST 요청 구현</a></li></ul></li></ul></nav><div class=book-nav><button class=book-nav-btn3 onclick='window.scrollTo({top:0,behavior:"smooth"})' title="Go to top">
<i class="fa fa-chevron-up"></i>
</button>
<button class=book-nav-btn3 onclick='window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})' title="Go to bottom">
<i class="fa fa-chevron-down"></i>
<button class=book-nav-btn3 onclick=history.back() title="Go back">
<i class="fa-solid fa-arrow-left"></i></button></div></div></aside></main></body></html>