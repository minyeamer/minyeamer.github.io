<!doctype html><html lang=ko-kr dir=ltr><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><meta name=keywords content="Apache Airflow,Jinja 템플릿,XCom,Variable,템플릿 변수,BashOperator,PythonOperator,데이터 엔지니어링,에어플로우,Python,Study"><meta name=description content="Apache Airflow의 Jinja 템플릿과 XCom을 소개하고, 템플릿 변수 활용과 Task 간 데이터 공유 방법을 단계별로 안내합니다. Variable 사용법과 …"><meta name=author content="minyeamer"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><link rel=canonical href=https://minyeamer.github.io/blog/airflow-study-3/><link rel=icon href=https://minyeamer.github.io/images/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://minyeamer.github.io/images/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://minyeamer.github.io/images/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://minyeamer.github.io/images/favicons/apple-touch-icon.png><link rel=mask-icon href=https://minyeamer.github.io/images/favicons/apple-touch-icon.png><meta name=google-site-verification content="u1tWcHmHUZWfFT1cHaku6sqU-bK40N3WLR-C-4VUWN0"><meta name=naver-site-verification content="6eaf8e9da1a6104780f056f1a7797fe5a3a5a0da"><meta property="og:title" content="Apache Airflow - 데이터 전달과 템플릿 활용 (Jinja, XCom, Variable)"><meta property="og:description" content="Apache Airflow의 Jinja 템플릿과 XCom을 소개하고, 템플릿 변수 활용과 Task 간 데이터 공유 방법을 단계별로 안내합니다. Variable 사용법과 …"><meta property="og:type" content="article"><meta property="og:url" content="https://minyeamer.github.io/blog/airflow-study-3/"><meta property="og:image" content="https://dl.dropboxusercontent.com/scl/fi/8oxi6rw0kesl9l3egs78s/airflow-00-cover.webp?rlkey=6abx67jiweasmlwehj4o4gdle&amp;st=n484uuow&amp;dl=0"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-01T23:46:09+09:00"><meta property="article:modified_time" content="2025-06-01T23:46:09+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dl.dropboxusercontent.com/scl/fi/8oxi6rw0kesl9l3egs78s/airflow-00-cover.webp?rlkey=6abx67jiweasmlwehj4o4gdle&amp;st=n484uuow&amp;dl=0"><meta name=twitter:title content="Apache Airflow - 데이터 전달과 템플릿 활용 (Jinja, XCom, Variable)"><meta name=twitter:description content="Apache Airflow의 Jinja 템플릿과 XCom을 소개하고, 템플릿 변수 활용과 Task 간 데이터 공유 방법을 단계별로 안내합니다. Variable 사용법과 …"><meta name=twitter:site content="@https://x.com/minyeamer"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://minyeamer.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Apache Airflow - 데이터 전달과 템플릿 활용 (Jinja, XCom, Variable)","item":"https://minyeamer.github.io/blog/airflow-study-3/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Apache Airflow - 데이터 전달과 템플릿 활용 (Jinja, XCom, Variable)","name":"Apache Airflow - 데이터 전달과 템플릿 활용 (Jinja, XCom, Variable)","description":"Apache Airflow의 Jinja 템플릿과 XCom을 소개하고, 템플릿 변수 활용과 Task 간 데이터 공유 방법을 단계별로 안내합니다. Variable 사용법과 Airflow 3.0 업데이트 내용까지 다룹니다.\n","keywords":["Apache Airflow","Jinja 템플릿","XCom","Variable","템플릿 변수","BashOperator","PythonOperator","데이터 엔지니어링","에어플로우","Python","Study"],"articleBody":"Jinja 템플릿 # Templates reference — Airflow 3.1.3 Documentationairflow.apache.org 파이썬 기반 웹 프레임워크 Flask, Django에서 주로 사용 HTML 템플릿을 만들고 화면에 보여질 때 값을 렌더링해서 출력 Airflow에서는 파라미터 입력 시 중괄호 2개 {{ }} 를 이용해 변수를 치환된 값으로 입력 변수 목록 (중괄호 생략) # data_interval_start : 스케줄의 시작 날짜이며,pendulum.DateTime 타입 data_interval_end : 스케줄의 종료 날짜(= 배치일)이며,pendulum.DateTime 타입 logical_date : DAG가 실행 중인 시점의 날짜이며,pendulum.DateTime 타입 ds : logical_date 를 YYYY-MM-DD 형태의 문자열로 변환한 값 ds 에서 - 을 제거한 YYYYMMDD 형태의 문자열 ds_nodash 변수도 제공 ts : logical_date 를 2018-01-01T00:00:00+00:00 형태의 문자열로 변환한 값 ts_nodash_with_tz 또는 ts_nodash 등의 변형된 변수도 지원 ds 또는 ts 등은 {{ logical_date | ds }} 의 형태로도 표현 가능 적용 대상 # BashOperator에서는 bash_command, env 파라미터에 템플릿 적용 가능 PythonOperator에서는 templates_dict, op_args, op_kwargs 파라미터에 템플릿 적용 가능 Airflow의 각 Operator 문서에서 Templating 부분 참고 Jinja 템플릿 변수 활용 # BashOperator # Jinja 템플릿 변수를 그대로 출력하는 명령어를 실행하는 DAG 구성 첫 번째 Task는 변수를 그대로 출력하고, 두 번째 Task는 env로 파라미터를 전달해서 출력 Copy python # dags/bash_template.py from airflow.sdk import DAG from airflow.providers.standard.operators.bash import BashOperator import pendulum with DAG( dag_id=\"bash_template\", schedule=\"0 0 * * *\", start_date=pendulum.datetime(2025, 1, 1, tz=\"Asia/Seoul\"), catchup=False, tags=[\"example\", \"template\"], ) as dag: bash_task1 = BashOperator( task_id=\"bash_task1\", bash_command=\"echo \\\"End date is {{ data_interval_end }}\\\"\", ) bash_task2 = BashOperator( task_id=\"bash_task2\", env={ \"START_DATE\": \"{{ data_interval_start | ds }}\", \"END_DATE\": \"{{ data_interval_end | ds }}\" }, bash_command=\"echo \\\"Start date is $START_DATE \\\" \u0026\u0026 echo \\\"End date is $END_DATE\\\"\", ) bash_task1 \u003e\u003e bash_task2 DAG 실행 후 bash_task1 의 실행 로그에서 data_interval_end 가 시간대를 포함하여 전체 출력된 것을 확인 bash_task2 의 실행 로그에서는 data_interval_start 와 data_interval_end 이 YYYY-MM-DD 형태의 문자열로 출력된 것을 확인 Copy bash # bash_task1 [2025-06-01, 19:59:27] INFO - DAG bundles loaded: dags-folder: source=\"airflow.dag_processing.bundles.manager.DagBundlesManager\" [2025-06-01, 19:59:27] INFO - Filling up the DagBag from /opt/airflow/dags/bash_template.py: source=\"airflow.models.dagbag.DagBag\" [2025-06-01, 19:59:27] INFO - Running command: ['/usr/bin/bash', '-c', 'echo \"End date is 2025-05-31 15:00:00+00:00\"']: source=\"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook\" [2025-06-01, 19:59:27] INFO - Output:: source=\"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook\" [2025-06-01, 19:59:27] INFO - End date is 2025-05-31 15:00:00+00:00: source=\"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook\" [2025-06-01, 19:59:27] INFO - Command exited with return code 0: source=\"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook\" [2025-06-01, 19:59:27] INFO - Pushing Copy bash [2025-06-01, 19:59:28] INFO - DAG bundles loaded: dags-folder: source=\"airflow.dag_processing.bundles.manager.DagBundlesManager\" [2025-06-01, 19:59:28] INFO - Filling up the DagBag from /opt/airflow/dags/bash_template.py: source=\"airflow.models.dagbag.DagBag\" [2025-06-01, 19:59:28] INFO - Running command: ['/usr/bin/bash', '-c', 'echo \"Start date is $START_DATE \" \u0026\u0026 echo \"End date is $END_DATE\"']: source=\"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook\" [2025-06-01, 19:59:28] INFO - Output:: source=\"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook\" [2025-06-01, 19:59:28] INFO - Start date is 2025-05-31: source=\"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook\" [2025-06-01, 19:59:28] INFO - End date is 2025-05-31: source=\"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook\" [2025-06-01, 19:59:28] INFO - Command exited with return code 0: source=\"airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook\" [2025-06-01, 19:59:28] INFO - Pushing PythonOperator (1) # keyword argument로 전달되는 Jinja 템플릿 변수를 출력하는 명령어를 실행하는 DAG 구성 이전에 한번 **kwargs 내용을 출력한적이 있었는데, 직접 전달하지 않았음에도 출력되었던 값들이 바로 Jinja 템플릿 변수에 해당 Copy python # dags/python_template1.py from airflow.sdk import DAG, task import pendulum with DAG( dag_id=\"python_template1\", schedule=\"0 0 * * *\", start_date=pendulum.datetime(2025, 1, 1, tz=\"Asia/Seoul\"), catchup=False, tags=[\"example\", \"template\"], ) as dag: @task(task_id=\"python_task\") def show_templates(**kwargs): from pprint import pprint pprint(kwargs) show_templates() DAG 실행 후 python_task 의 실행 로그에서 data_interval_end, data_interval_start 등 Jinja 템플릿 변수가 출력된 것을 확인 Copy bash [2025-06-01, 20:18:19] INFO - DAG bundles loaded: dags-folder: source=\"airflow.dag_processing.bundles.manager.DagBundlesManager\" [2025-06-01, 20:18:19] INFO - Filling up the DagBag from /opt/airflow/dags/python_template.py: source=\"airflow.models.dagbag.DagBag\" [2025-06-01, 20:18:19] INFO - {'conn': ","wordCount":"2985","inLanguage":"en","image":"https:\/\/dl.dropboxusercontent.com\/scl\/fi\/8oxi6rw0kesl9l3egs78s\/airflow-00-cover.webp?rlkey=6abx67jiweasmlwehj4o4gdle\u0026st=n484uuow\u0026dl=0","datePublished":"2025-06-01T23:46:09+09:00","dateModified":"2025-06-01T23:46:09+09:00","author":{"@type":"Person","name":"minyeamer"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://minyeamer.github.io/blog/airflow-study-3/"},"publisher":{"@type":"Person","name":"Minystory","logo":{"@type":"ImageObject","url":"https://minyeamer.github.io/images/favicons/favicon.ico"}}}</script><title>Apache Airflow - 데이터 전달과 템플릿 활용 (Jinja, XCom, Variable) | Minystory</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://minyeamer.github.io/blog/airflow-study-3/><link rel=stylesheet href=/book.min.da9f864e1bccfac13510edef0c8dbe217c58d1ba58855d698051f162d9101fc5.css integrity="sha256-2p+GThvM+sE1EO3vDI2+IXxY0bpYhV1pgFHxYtkQH8U=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/search-input.min.655b3dbc7fa5dba7448e54cadfe1f2f0e2130ce28ac55de3dd121fb6836de1c2.js integrity="sha256-ZVs9vH+l26dEjlTK3+Hy8OITDOKKxV3j3RIftoNt4cI=" crossorigin=anonymous></script><link rel=preload href=/search-data.min.6bf4dc44bbf8ef5af22571f25ab82c5cbc23a3d80b9ec8115b9f75d8123213a4.json as=fetch crossorigin><script>window.SEARCH_DATA_URL="/search-data.min.6bf4dc44bbf8ef5af22571f25ab82c5cbc23a3d80b9ec8115b9f75d8123213a4.json"</script><script defer src=/search.min.f30f9834d4764fd9751da64098c954d01085f648ba9ca421a3c97582f8c47253.js integrity="sha256-8w+YNNR2T9l1HaZAmMlU0BCF9ki6nKQho8l1gvjEclM=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-BJ8Z9RMBPJ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BJ8Z9RMBPJ")</script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css crossorigin=anonymous><script defer src=/scroll-progress.min.841ade7e507a5f6d59c4e7bf2fe2b2ca034070677ff7957eec55610a024dd776.js integrity="sha256-hBreflB6X21ZxOe/L+KyygNAcGd/95V+7FVhCgJN13Y=" crossorigin=anonymous></script><script defer src=/dark-mode.min.e41c6440ffd9967d6f6a419ff3ce09b862009fe1646ab265f5cb2817d2a508e3.js integrity="sha256-5BxkQP/Zln1vakGf884JuGIAn+FkarJl9csoF9KlCOM=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.9.0/highlightjs-line-numbers.min.js></script><script defer src=/copy-code.min.aaeef965f0b4992e55f976edaecb34a89d414e1791caa18c3f4f4376c6d8b5a8.js integrity="sha256-qu75ZfC0mS5V+Xbtrss0qJ1BTheRyqGMP09DdsbYtag=" crossorigin=anonymous></script><script defer src=/toc-highlightjs.093016f0ef312174ad862fdcf5792e88ab5442bd39beecc38d15643f71ab5c31.min integrity="sha256-CTAW8O8xIXSthi/c9XkuiKtUQr05vuzDjRVkP3GrXDE=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-posts book-layout-post"><div class=scroll-progress><div class=scroll-progress-bar></div></div><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><div class=sidebar-profile><div class=profile-img-wrap><a href=https://minyeamer.github.io/><img src=/images/profile/menu.jpg alt=Profile class=profile-img></a></div><div class=sidebar-social><a href=https://github.com/minyeamer target=_blank title=GitHub><i class="fa-brands fa-github"></i>
</a><a href=/categories/ title=Categories><i class="fa-solid fa-folder"></i>
</a><a href=/tags/ title=Tags><i class="fa-solid fa-tags"></i>
</a><button id=dark-mode-toggle class=dark-mode-toggle aria-label="Toggle dark mode">
<i class="fa-solid fa-circle-half-stroke"></i></button></div></div><h2 class=book-brand><a class="flex align-center" href=/><span>Minystory</span></a></h2><div class="book-search hidden"><div class=search-input-container><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/ onkeydown='event.key==="Enter"&&goToSearchPage()'>
<button type=button id=book-search-button class=book-search-btn onclick=goToSearchPage()>
<i class="fa-solid fa-magnifying-glass"></i></button></div><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden");function goToSearchPage(){const t=document.getElementById("book-search-input"),e=t.value.trim();e&&(window.location.href="/search/?q="+encodeURIComponent(e))}</script><div class=book-categories><input type=checkbox class="hidden toggle" id=categories-control checked>
<label for=categories-control class="categories-toggle categories-link"><a href=/categories/><i class="fa-solid fa-folder"></i>
<span>전체</span>
<span class=category-count>(34)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul class=categories-menu id=categories-menu><li><input type=checkbox class="hidden toggle" id=cat-algorithm>
<label for=cat-algorithm class="categories-toggle categories-link"><a href=/categories/algorithm/><i class="fa-solid fa-folder"></i>
Algorithm
<span class=category-count>(1)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/algorithm/sql/><i class="fa-solid fa-file"></i>
SQL
<span class=category-count>(1)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-cloud>
<label for=cat-cloud class="categories-toggle categories-link"><a href=/categories/cloud/><i class="fa-solid fa-folder"></i>
Cloud
<span class=category-count>(2)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/cloud/kubernetes/><i class="fa-solid fa-file"></i>
Kubernetes
<span class=category-count>(2)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-data-analysis>
<label for=cat-data-analysis class="categories-toggle categories-link"><a href=/categories/data-analysis/><i class="fa-solid fa-folder"></i>
Data Analysis
<span class=category-count>(2)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/data-analysis/dacon/><i class="fa-solid fa-file"></i>
Dacon
<span class=category-count>(2)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-data-engineering>
<label for=cat-data-engineering class="categories-toggle categories-link"><a href=/categories/data-engineering/><i class="fa-solid fa-folder"></i>
Data Engineering
<span class=category-count>(19)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/data-engineering/apache-airflow/><i class="fa-solid fa-file"></i>
Apache Airflow
<span class=category-count>(7)</span></a></li><li class=categories-link><a href=/categories/data-engineering/apache-spark/><i class="fa-solid fa-file"></i>
Apache Spark
<span class=category-count>(8)</span></a></li><li class=categories-link><a href=/categories/data-engineering/crawling/><i class="fa-solid fa-file"></i>
Crawling
<span class=category-count>(4)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-frontend>
<label for=cat-frontend class="categories-toggle categories-link"><a href=/categories/frontend/><i class="fa-solid fa-folder"></i>
Frontend
<span class=category-count>(7)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/frontend/blog/><i class="fa-solid fa-file"></i>
Blog
<span class=category-count>(7)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-linux>
<label for=cat-linux class="categories-toggle categories-link"><a href=/categories/linux/><i class="fa-solid fa-folder"></i>
Linux
<span class=category-count>(1)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/linux/ubuntu/><i class="fa-solid fa-file"></i>
Ubuntu
<span class=category-count>(1)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-project>
<label for=cat-project class="categories-toggle categories-link"><a href=/categories/project/><i class="fa-solid fa-folder"></i>
Project
<span class=category-count>(2)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/project/open-source/><i class="fa-solid fa-file"></i>
Open Source
<span class=category-count>(1)</span></a></li><li class=categories-link><a href=/categories/project/tools/><i class="fa-solid fa-file"></i>
Tools
<span class=category-count>(1)</span></a></li></ul></li></ul></div><div class=recent-posts><div class=recent-posts-header><i class="fa-solid fa-clock"></i>
<span>최신글</span></div><ul class=recent-posts-list><li class=recent-post-item><a href=/blog/hugo-blog-3/ title="Hugo 블로그 만들기 (3) - Taxonomies로 태그/카테고리 페이지 커스터마이징"><div class=recent-post-title>Hugo 블로그 만들기 (3) - Taxonomies로 태그/카테고리 페이지 커스터마이징</div><div class=recent-post-date><time datetime=2025-11-22>2025.11.22</time></div></a></li><li class=recent-post-item><a href=/blog/hugo-blog-2/ title="Hugo 블로그 만들기 (2) - 메인 레이아웃 커스터마이징 (메뉴, 목차, 헤더)"><div class=recent-post-title>Hugo 블로그 만들기 (2) - 메인 레이아웃 커스터마이징 (메뉴, 목차, 헤더)</div><div class=recent-post-date><time datetime=2025-11-04>2025.11.04</time></div></a></li><li class=recent-post-item><a href=/blog/hugo-blog-1/ title="Hugo 블로그 만들기 (1) - 프로젝트 구성과 GitHub Pages 배포 (Submodule 활용)"><div class=recent-post-title>Hugo 블로그 만들기 (1) - 프로젝트 구성과 GitHub Pages 배포 (Submodule 활용)</div><div class=recent-post-date><time datetime=2025-11-01>2025.11.01</time></div></a></li><li class=recent-post-item><a href=/blog/openup-handson/ title="[OSSCA] 2025 오픈소스 컨트리뷰션 아카데미 - PyTorch 문서 한글화 참여 후기"><div class=recent-post-title>[OSSCA] 2025 오픈소스 컨트리뷰션 아카데미 - PyTorch 문서 한글화 참여 후기</div><div class=recent-post-date><time datetime=2025-10-28>2025.10.28</time></div></a></li><li class=recent-post-item><a href=/blog/uv-project/ title="[Python] uv로 프로젝트 구성하고 PyPI 배포하기 - Rust 기반 고속 패키지 관리"><div class=recent-post-title>[Python] uv로 프로젝트 구성하고 PyPI 배포하기 - Rust 기반 고속 패키지 관리</div><div class=recent-post-date><time datetime=2025-07-23>2025.07.23</time></div></a></li></ul></div></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><i class="fa-solid fa-bars book-icon" id=menu-icon></i></label><h3><a href=https://minyeamer.github.io/ class=site-title>Minystory</a></h3><label for=toc-control><i class="fa-solid fa-list book-icon" id=toc-icon></i></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#jinja-템플릿>Jinja 템플릿</a><ul><li></li></ul></li><li><a href=#jinja-템플릿-변수-활용>Jinja 템플릿 변수 활용</a><ul><li><a href=#bashoperator>BashOperator</a></li><li><a href=#pythonoperator-1>PythonOperator (1)</a></li><li><a href=#pythonoperator-2>PythonOperator (2)</a></li></ul></li><li><a href=#macro-변수>Macro 변수</a><ul><li><a href=#macro-변수-목록>Macro 변수 목록</a></li><li><a href=#macro-변수-활용-예시>Macro 변수 활용 예시</a></li></ul></li><li><a href=#airflow-30-업데이트>Airflow 3.0 업데이트</a><ul><li><a href=#crondataintervaltimetable>CronDataIntervalTimetable</a></li><li><a href=#crontriggertimetable>CronTriggerTimetable</a></li></ul></li><li><a href=#xcom>XCom</a><ul><li><a href=#xcom-사용법>XCom 사용법</a></li><li><a href=#return-값-활용>return 값 활용</a></li></ul></li><li><a href=#xcom-활용>Xcom 활용</a><ul><li><a href=#pythonoperator-1-1>PythonOperator (1)</a></li><li><a href=#pythonoperator-2-1>PythonOperator (2)</a></li><li><a href=#bashoperator-1>BashOperator</a></li><li><a href=#python--bash-전달>Python → Bash 전달</a></li></ul></li><li><a href=#variable>Variable</a><ul><li><a href=#variable-가져오기>Variable 가져오기</a></li><li><a href=#variable-활용>Variable 활용</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><header class=post-header><div class=post-header-category><a href=/categories/data-engineering/apache-airflow/ class=post-header-category-link>Data Engineering/Apache Airflow</a></div><h1 class=post-header-title>Apache Airflow - 데이터 전달과 템플릿 활용 (Jinja, XCom, Variable)</h1><div class=post-header-date><time datetime=2025-06-01T23:46:09+09:00>2025. 6. 1. 23:46</time></div></header><div class=book-cover><img src="https://dl.dropboxusercontent.com/scl/fi/8oxi6rw0kesl9l3egs78s/airflow-00-cover.webp?rlkey=6abx67jiweasmlwehj4o4gdle&amp;st=n484uuow&amp;dl=0" alt="Cover Image" class=book-cover-img></div><h2 id=jinja-템플릿>Jinja 템플릿
<a class=anchor href=#jinja-%ed%85%9c%ed%94%8c%eb%a6%bf>#</a></h2><a href=https://airflow.apache.org/docs/apache-airflow/stable/templates-ref.html target=_blank class=bookmark-card><div class=bookmark-image><img src="https://dl.dropboxusercontent.com/scl/fi/jaltieh1sb4r7ozm6ju3e/airflow-00-cover-bg.webp?rlkey=s10wwm9o11zy79dwm1vje30sb&amp;dl=0" alt="Templates reference — Airflow 3.1.3 Documentation"></div><div class=bookmark-content><h3 class=bookmark-title>Templates reference — Airflow 3.1.3 Documentation</h3><small class=bookmark-url>airflow.apache.org</small></div></a><ul><li>파이썬 기반 웹 프레임워크 Flask, Django에서 주로 사용</li><li>HTML 템플릿을 만들고 화면에 보여질 때 값을 렌더링해서 출력</li><li>Airflow에서는 파라미터 입력 시 중괄호 2개 <code>{{ }}</code> 를 이용해 변수를 치환된 값으로 입력</li></ul><h4 id=변수-목록-중괄호-생략>변수 목록 (중괄호 생략)
<a class=anchor href=#%eb%b3%80%ec%88%98-%eb%aa%a9%eb%a1%9d-%ec%a4%91%ea%b4%84%ed%98%b8-%ec%83%9d%eb%9e%b5>#</a></h4><ul><li><strong><code>data_interval_start</code></strong> : 스케줄의 시작 날짜이며,<code>pendulum.DateTime</code> 타입</li><li><strong><code>data_interval_end</code></strong> : 스케줄의 종료 날짜(= 배치일)이며,<code>pendulum.DateTime</code> 타입</li><li><strong><code>logical_date</code></strong> : DAG가 실행 중인 시점의 날짜이며,<code>pendulum.DateTime</code> 타입</li><li><strong><code>ds</code></strong> : <code>logical_date</code> 를 <code>YYYY-MM-DD</code> 형태의 문자열로 변환한 값<ul><li><code>ds</code> 에서 <code>-</code> 을 제거한 <code>YYYYMMDD</code> 형태의 문자열 <code>ds_nodash</code> 변수도 제공</li></ul></li><li><strong><code>ts</code></strong> : <code>logical_date</code> 를 <code>2018-01-01T00:00:00+00:00</code> 형태의 문자열로 변환한 값<ul><li><code>ts_nodash_with_tz</code> 또는 <code>ts_nodash</code> 등의 변형된 변수도 지원</li></ul></li><li><code>ds</code> 또는 <code>ts</code> 등은 <code>{{ logical_date | ds }}</code> 의 형태로도 표현 가능</li></ul><h4 id=적용-대상>적용 대상
<a class=anchor href=#%ec%a0%81%ec%9a%a9-%eb%8c%80%ec%83%81>#</a></h4><ul><li>BashOperator에서는 <code>bash_command</code>, <code>env</code> 파라미터에 템플릿 적용 가능</li><li>PythonOperator에서는 <code>templates_dict</code>, <code>op_args</code>, <code>op_kwargs</code> 파라미터에 템플릿 적용 가능</li><li>Airflow의 각 Operator 문서에서 <strong>Templating</strong> 부분 참고</li></ul><h2 id=jinja-템플릿-변수-활용>Jinja 템플릿 변수 활용
<a class=anchor href=#jinja-%ed%85%9c%ed%94%8c%eb%a6%bf-%eb%b3%80%ec%88%98-%ed%99%9c%ec%9a%a9>#</a></h2><h3 id=bashoperator>BashOperator
<a class=anchor href=#bashoperator>#</a></h3><ul><li>Jinja 템플릿 변수를 그대로 출력하는 명령어를 실행하는 DAG 구성</li><li>첫 번째 Task는 변수를 그대로 출력하고, 두 번째 Task는 <code>env</code>로 파라미터를 전달해서 출력</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dags/bash_template.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.sdk</span> <span class=kn>import</span> <span class=n>DAG</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.providers.standard.operators.bash</span> <span class=kn>import</span> <span class=n>BashOperator</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pendulum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dag_id</span><span class=o>=</span><span class=s2>&#34;bash_template&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>=</span><span class=s2>&#34;0 0 * * *&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span><span class=o>=</span><span class=n>pendulum</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;example&#34;</span><span class=p>,</span> <span class=s2>&#34;template&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bash_task1</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;bash_task1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>bash_command</span><span class=o>=</span><span class=s2>&#34;echo </span><span class=se>\&#34;</span><span class=s2>End date is {{ data_interval_end }}</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bash_task2</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;bash_task2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>env</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;START_DATE&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ data_interval_start | ds }}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;END_DATE&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ data_interval_end | ds }}&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>bash_command</span><span class=o>=</span><span class=s2>&#34;echo </span><span class=se>\&#34;</span><span class=s2>Start date is $START_DATE </span><span class=se>\&#34;</span><span class=s2> &amp;&amp; echo </span><span class=se>\&#34;</span><span class=s2>End date is $END_DATE</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bash_task1</span> <span class=o>&gt;&gt;</span> <span class=n>bash_task2</span></span></span></code></pre></div></div><ul><li>DAG 실행 후 <code>bash_task1</code> 의 실행 로그에서 <code>data_interval_end</code> 가 시간대를 포함하여 전체 출력된 것을 확인</li><li><code>bash_task2</code> 의 실행 로그에서는 <code>data_interval_start</code> 와 <code>data_interval_end</code> 이 YYYY-MM-DD 형태의 문자열로 출력된 것을 확인</li></ul><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># bash_task1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:27<span class=o>]</span> INFO - DAG bundles loaded: dags-folder: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.dag_processing.bundles.manager.DagBundlesManager&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:27<span class=o>]</span> INFO - Filling up the DagBag from /opt/airflow/dags/bash_template.py: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.models.dagbag.DagBag&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:27<span class=o>]</span> INFO - Running command: <span class=o>[</span><span class=s1>&#39;/usr/bin/bash&#39;</span>, <span class=s1>&#39;-c&#39;</span>, <span class=s1>&#39;echo &#34;End date is 2025-05-31 15:00:00+00:00&#34;&#39;</span><span class=o>]</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:27<span class=o>]</span> INFO - Output:: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:27<span class=o>]</span> INFO - End date is 2025-05-31 15:00:00+00:00: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:27<span class=o>]</span> INFO - Command exited with <span class=k>return</span> code 0: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:27<span class=o>]</span> INFO - Pushing </span></span></code></pre></div></div><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:28<span class=o>]</span> INFO - DAG bundles loaded: dags-folder: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.dag_processing.bundles.manager.DagBundlesManager&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:28<span class=o>]</span> INFO - Filling up the DagBag from /opt/airflow/dags/bash_template.py: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.models.dagbag.DagBag&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:28<span class=o>]</span> INFO - Running command: <span class=o>[</span><span class=s1>&#39;/usr/bin/bash&#39;</span>, <span class=s1>&#39;-c&#39;</span>, <span class=s1>&#39;echo &#34;Start date is $START_DATE &#34; &amp;&amp; echo &#34;End date is $END_DATE&#34;&#39;</span><span class=o>]</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:28<span class=o>]</span> INFO - Output:: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:28<span class=o>]</span> INFO - Start date is 2025-05-31: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:28<span class=o>]</span> INFO - End date is 2025-05-31: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:28<span class=o>]</span> INFO - Command exited with <span class=k>return</span> code 0: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 19:59:28<span class=o>]</span> INFO - Pushing </span></span></code></pre></div></div><h3 id=pythonoperator-1>PythonOperator (1)
<a class=anchor href=#pythonoperator-1>#</a></h3><ul><li>keyword argument로 전달되는 Jinja 템플릿 변수를 출력하는 명령어를 실행하는 DAG 구성</li><li>이전에 한번 <code>**kwargs</code> 내용을 출력한적이 있었는데, 직접 전달하지 않았음에도 출력되었던 값들이 바로 Jinja 템플릿 변수에 해당</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dags/python_template1.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.sdk</span> <span class=kn>import</span> <span class=n>DAG</span><span class=p>,</span> <span class=n>task</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pendulum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dag_id</span><span class=o>=</span><span class=s2>&#34;python_template1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>=</span><span class=s2>&#34;0 0 * * *&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span><span class=o>=</span><span class=n>pendulum</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;example&#34;</span><span class=p>,</span> <span class=s2>&#34;template&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;python_task&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>show_templates</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>pprint</span> <span class=kn>import</span> <span class=n>pprint</span>
</span></span><span class=line><span class=cl>        <span class=n>pprint</span><span class=p>(</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>show_templates</span><span class=p>()</span></span></span></code></pre></div></div><ul><li>DAG 실행 후 <code>python_task</code> 의 실행 로그에서 <code>data_interval_end</code>, <code>data_interval_start</code> 등 Jinja 템플릿 변수가 출력된 것을 확인</li></ul><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO - DAG bundles loaded: dags-folder: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.dag_processing.bundles.manager.DagBundlesManager&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO - Filling up the DagBag from /opt/airflow/dags/python_template.py: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.models.dagbag.DagBag&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO - <span class=o>{</span><span class=s1>&#39;conn&#39;</span>: &lt;ConnectionAccessor <span class=o>(</span>dynamic access<span class=o>)</span>&gt;,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;dag&#39;</span>: &lt;DAG: python_template&gt;,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;dag_run&#39;</span>: DagRun<span class=o>(</span><span class=nv>dag_id</span><span class=o>=</span><span class=s1>&#39;python_template&#39;</span>, <span class=nv>run_id</span><span class=o>=</span><span class=s1>&#39;scheduled__2025-05-31T15:00:00+00:00&#39;</span>, <span class=nv>logical_date</span><span class=o>=</span>datetime.datetime<span class=o>(</span>2025, 5, 31, 15, 0, <span class=nv>tzinfo</span><span class=o>=</span>TzInfo<span class=o>(</span>UTC<span class=o>))</span>, <span class=nv>data_interval_start</span><span class=o>=</span>datetime.datetime<span class=o>(</span>2025, 5, 31, 15, 0, <span class=nv>tzinfo</span><span class=o>=</span>TzInfo<span class=o>(</span>UTC<span class=o>))</span>, <span class=nv>data_interval_end</span><span class=o>=</span>datetime.datetime<span class=o>(</span>2025, 5, 31, 15, 0, <span class=nv>tzinfo</span><span class=o>=</span>TzInfo<span class=o>(</span>UTC<span class=o>))</span>, <span class=nv>run_after</span><span class=o>=</span>datetime.datetime<span class=o>(</span>2025, 5, 31, 15, 0, <span class=nv>tzinfo</span><span class=o>=</span>TzInfo<span class=o>(</span>UTC<span class=o>))</span>, <span class=nv>start_date</span><span class=o>=</span>datetime.datetime<span class=o>(</span>2025, 6, 1, 11, 18, 19, 250768, <span class=nv>tzinfo</span><span class=o>=</span>TzInfo<span class=o>(</span>UTC<span class=o>))</span>, <span class=nv>end_date</span><span class=o>=</span>None, <span class=nv>clear_number</span><span class=o>=</span>0, <span class=nv>run_type</span><span class=o>=</span>&lt;DagRunType.SCHEDULED: <span class=s1>&#39;scheduled&#39;</span>&gt;, <span class=nv>conf</span><span class=o>={}</span>, <span class=nv>consumed_asset_events</span><span class=o>=[])</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;data_interval_end&#39;</span>: DateTime<span class=o>(</span>2025, 5, 31, 15, 0, 0, <span class=nv>tzinfo</span><span class=o>=</span>Timezone<span class=o>(</span><span class=s1>&#39;UTC&#39;</span><span class=o>))</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;data_interval_start&#39;</span>: DateTime<span class=o>(</span>2025, 5, 31, 15, 0, 0, <span class=nv>tzinfo</span><span class=o>=</span>Timezone<span class=o>(</span><span class=s1>&#39;UTC&#39;</span><span class=o>))</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;ds&#39;</span>: <span class=s1>&#39;2025-05-31&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;ds_nodash&#39;</span>: <span class=s1>&#39;20250531&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;inlet_events&#39;</span>: InletEventsAccessors<span class=o>(</span><span class=nv>_inlets</span><span class=o>=[]</span>, <span class=nv>_assets</span><span class=o>={}</span>, <span class=nv>_asset_aliases</span><span class=o>={})</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;inlets&#39;</span>: <span class=o>[]</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;logical_date&#39;</span>: DateTime<span class=o>(</span>2025, 5, 31, 15, 0, 0, <span class=nv>tzinfo</span><span class=o>=</span>Timezone<span class=o>(</span><span class=s1>&#39;UTC&#39;</span><span class=o>))</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;macros&#39;</span>: &lt;MacrosAccessor <span class=o>(</span>dynamic access to macros<span class=o>)</span>&gt;,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;map_index_template&#39;</span>: None,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;outlet_events&#39;</span>: &lt;airflow.sdk.execution_time.context.OutletEventAccessors object at 0xffffaacaa810&gt;,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;outlets&#39;</span>: <span class=o>[]</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;params&#39;</span>: <span class=o>{}</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;prev_data_interval_end_success&#39;</span>: &lt;Proxy at 0xffffaad2b140 with factory &lt;<span class=k>function</span> RuntimeTaskInstance.get_template_context.&lt;locals&gt;.&lt;lambda&gt; at 0xffffaad3cfe0&gt;&gt;,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO - Done. Returned value was: None: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.airflow.providers.standard.decorators.python._PythonDecoratedOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;prev_data_interval_start_success&#39;</span>: &lt;Proxy at 0xffffaad2b0b0 with factory &lt;<span class=k>function</span> RuntimeTaskInstance.get_template_context.&lt;locals&gt;.&lt;lambda&gt; at 0xffffaad3cea0&gt;&gt;,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;prev_end_date_success&#39;</span>: &lt;Proxy at 0xffffaacde870 with factory &lt;<span class=k>function</span> RuntimeTaskInstance.get_template_context.&lt;locals&gt;.&lt;lambda&gt; at 0xffffaad0c7c0&gt;&gt;,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;prev_start_date_success&#39;</span>: &lt;Proxy at 0xffffaacde8d0 with factory &lt;<span class=k>function</span> RuntimeTaskInstance.get_template_context.&lt;locals&gt;.&lt;lambda&gt; at 0xffffaad0c720&gt;&gt;,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;run_id&#39;</span>: <span class=s1>&#39;scheduled__2025-05-31T15:00:00+00:00&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;task&#39;</span>: &lt;Task<span class=o>(</span>_PythonDecoratedOperator<span class=o>)</span>: python_task&gt;,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;task_instance&#39;</span>: RuntimeTaskInstance<span class=o>(</span><span class=nv>id</span><span class=o>=</span>UUID<span class=o>(</span><span class=s1>&#39;01972b36-c56a-7d54-b52e-45bb8feb6594&#39;</span><span class=o>)</span>, <span class=nv>task_id</span><span class=o>=</span><span class=s1>&#39;python_task&#39;</span>, <span class=nv>dag_id</span><span class=o>=</span><span class=s1>&#39;python_template&#39;</span>, <span class=nv>run_id</span><span class=o>=</span><span class=s1>&#39;scheduled__2025-05-31T15:00:00+00:00&#39;</span>, <span class=nv>try_number</span><span class=o>=</span>1, <span class=nv>map_index</span><span class=o>=</span>-1, <span class=nv>hostname</span><span class=o>=</span><span class=s1>&#39;f6f932b48199&#39;</span>, <span class=nv>context_carrier</span><span class=o>={}</span>, <span class=nv>task</span><span class=o>=</span>&lt;Task<span class=o>(</span>_PythonDecoratedOperator<span class=o>)</span>: python_task&gt;, <span class=nv>bundle_instance</span><span class=o>=</span>LocalDagBundle<span class=o>(</span><span class=nv>name</span><span class=o>=</span>dags-folder<span class=o>)</span>, <span class=nv>max_tries</span><span class=o>=</span>0, <span class=nv>start_date</span><span class=o>=</span>datetime.datetime<span class=o>(</span>2025, 6, 1, 11, 18, 19, 315990, <span class=nv>tzinfo</span><span class=o>=</span>TzInfo<span class=o>(</span>UTC<span class=o>))</span>, <span class=nv>end_date</span><span class=o>=</span>None, <span class=nv>state</span><span class=o>=</span>&lt;TaskInstanceState.RUNNING: <span class=s1>&#39;running&#39;</span>&gt;, <span class=nv>is_mapped</span><span class=o>=</span>False, <span class=nv>rendered_map_index</span><span class=o>=</span>None<span class=o>)</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;task_instance_key_str&#39;</span>: <span class=s1>&#39;python_template__python_task__20250531&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;task_reschedule_count&#39;</span>: 0,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;templates_dict&#39;</span>: None,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;ti&#39;</span>: RuntimeTaskInstance<span class=o>(</span><span class=nv>id</span><span class=o>=</span>UUID<span class=o>(</span><span class=s1>&#39;01972b36-c56a-7d54-b52e-45bb8feb6594&#39;</span><span class=o>)</span>, <span class=nv>task_id</span><span class=o>=</span><span class=s1>&#39;python_task&#39;</span>, <span class=nv>dag_id</span><span class=o>=</span><span class=s1>&#39;python_template&#39;</span>, <span class=nv>run_id</span><span class=o>=</span><span class=s1>&#39;scheduled__2025-05-31T15:00:00+00:00&#39;</span>, <span class=nv>try_number</span><span class=o>=</span>1, <span class=nv>map_index</span><span class=o>=</span>-1, <span class=nv>hostname</span><span class=o>=</span><span class=s1>&#39;f6f932b48199&#39;</span>, <span class=nv>context_carrier</span><span class=o>={}</span>, <span class=nv>task</span><span class=o>=</span>&lt;Task<span class=o>(</span>_PythonDecoratedOperator<span class=o>)</span>: python_task&gt;, <span class=nv>bundle_instance</span><span class=o>=</span>LocalDagBundle<span class=o>(</span><span class=nv>name</span><span class=o>=</span>dags-folder<span class=o>)</span>, <span class=nv>max_tries</span><span class=o>=</span>0, <span class=nv>start_date</span><span class=o>=</span>datetime.datetime<span class=o>(</span>2025, 6, 1, 11, 18, 19, 315990, <span class=nv>tzinfo</span><span class=o>=</span>TzInfo<span class=o>(</span>UTC<span class=o>))</span>, <span class=nv>end_date</span><span class=o>=</span>None, <span class=nv>state</span><span class=o>=</span>&lt;TaskInstanceState.RUNNING: <span class=s1>&#39;running&#39;</span>&gt;, <span class=nv>is_mapped</span><span class=o>=</span>False, <span class=nv>rendered_map_index</span><span class=o>=</span>None<span class=o>)</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;triggering_asset_events&#39;</span>: TriggeringAssetEventsAccessor<span class=o>(</span><span class=nv>_events</span><span class=o>=</span>defaultdict<span class=o>(</span>&lt;class <span class=s1>&#39;list&#39;</span>&gt;, <span class=o>{}))</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;ts&#39;</span>: <span class=s1>&#39;2025-05-31T15:00:00+00:00&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;ts_nodash&#39;</span>: <span class=s1>&#39;20250531T150000&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;ts_nodash_with_tz&#39;</span>: <span class=s1>&#39;20250531T150000+0000&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -  <span class=s1>&#39;var&#39;</span>: <span class=o>{</span><span class=s1>&#39;json&#39;</span>: &lt;VariableAccessor <span class=o>(</span>dynamic access<span class=o>)</span>&gt;,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-01, 20:18:19<span class=o>]</span> INFO -          <span class=s1>&#39;value&#39;</span>: &lt;VariableAccessor <span class=o>(</span>dynamic access<span class=o>)</span>&gt;<span class=o>}}</span>: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span></span></span></code></pre></div></div><h3 id=pythonoperator-2>PythonOperator (2)
<a class=anchor href=#pythonoperator-2>#</a></h3><ul><li>이번에는 PythonOperator에 Jinja 템플릿 변수를 전달하여 출력하는 <code>python_task1</code> 정의</li><li>keyword argument로 전달되는 Jinja 템플릿 변수 중 일부 항목만 선택해서 출력하는 <code>python_task2</code> 정의</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dags/python_template2.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.sdk</span> <span class=kn>import</span> <span class=n>DAG</span><span class=p>,</span> <span class=n>task</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pendulum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dag_id</span><span class=o>=</span><span class=s2>&#34;python_template2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>=</span><span class=s2>&#34;0 0 * * *&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span><span class=o>=</span><span class=n>pendulum</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;example&#34;</span><span class=p>,</span> <span class=s2>&#34;template&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>print_period</span><span class=p>(</span><span class=n>start_date</span><span class=p>,</span> <span class=n>end_date</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>start_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>end_date</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>python_task1</span> <span class=o>=</span> <span class=n>PythonOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;python_task1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>python_callable</span><span class=o>=</span><span class=n>print_period</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>op_kwargs</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;start_date&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ data_interval_start | ds }}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;end_date&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ data_interval_end | ds }}&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;python_task2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>python_task2</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>__key</span> <span class=ow>in</span> <span class=p>[</span><span class=s2>&#34;ds&#34;</span><span class=p>,</span> <span class=s2>&#34;ts&#34;</span><span class=p>,</span> <span class=s2>&#34;data_interval_start&#34;</span><span class=p>,</span> <span class=s2>&#34;data_interval_end&#34;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>__key</span> <span class=ow>in</span> <span class=n>kwargs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>__key</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>kwargs</span><span class=p>[</span><span class=n>__key</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>python_task1</span> <span class=o>&gt;&gt;</span> <span class=n>python_task2</span><span class=p>()</span></span></span></code></pre></div></div><ul><li>DAG 실행 후 <code>python_task1</code> 의 실행 로그에서 전달한 <code>data_interval_start</code>, <code>data_interval_end</code> 값이 YYYY-MM-DD 형태의 문자열로 출력된 것을 확인</li><li><code>python_task2</code> 의 실행 로그에서는 <code>ds</code>, <code>ts</code>, <code>data_interval_start</code>, <code>data_interval_end</code> 값을 keyword argument로부터 꺼내서 그대로 출력</li></ul><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># python_task1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-02, 00:12:27<span class=o>]</span> INFO - DAG bundles loaded: dags-folder: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.dag_processing.bundles.manager.DagBundlesManager&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-02, 00:12:27<span class=o>]</span> INFO - Filling up the DagBag from /opt/airflow/dags/python_template2.py: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.models.dagbag.DagBag&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-02, 00:12:27<span class=o>]</span> INFO - Done. Returned value was: None: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.airflow.providers.standard.operators.python.PythonOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-02, 00:12:27<span class=o>]</span> INFO - 2025-06-01: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-02, 00:12:27<span class=o>]</span> INFO - 2025-06-01: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span></span></span></code></pre></div></div><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># python_task2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-02, 00:12:27<span class=o>]</span> INFO - DAG bundles loaded: dags-folder: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.dag_processing.bundles.manager.DagBundlesManager&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-02, 00:12:27<span class=o>]</span> INFO - Filling up the DagBag from /opt/airflow/dags/python_template2.py: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.models.dagbag.DagBag&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-02, 00:12:27<span class=o>]</span> INFO - Done. Returned value was: None: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.airflow.providers.standard.decorators.python._PythonDecoratedOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-02, 00:12:27<span class=o>]</span> INFO - ds: 2025-06-01: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-02, 00:12:27<span class=o>]</span> INFO - ts: 2025-06-01T15:00:00+00:00: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-02, 00:12:27<span class=o>]</span> INFO - data_interval_start: 2025-06-01 15:00:00+00:00: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-02, 00:12:27<span class=o>]</span> INFO - data_interval_end: 2025-06-01 15:00:00+00:00: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span></span></span></code></pre></div></div><h2 id=macro-변수>Macro 변수
<a class=anchor href=#macro-%eb%b3%80%ec%88%98>#</a></h2><a href=https://airflow.apache.org/docs/apache-airflow/stable/templates-ref.html#macros target=_blank class=bookmark-card><div class=bookmark-image><img src="https://dl.dropboxusercontent.com/scl/fi/jaltieh1sb4r7ozm6ju3e/airflow-00-cover-bg.webp?rlkey=s10wwm9o11zy79dwm1vje30sb&amp;dl=0" alt="Templates reference — Airflow 3.1.3 Documentation"></div><div class=bookmark-content><h3 class=bookmark-title>Templates reference — Airflow 3.1.3 Documentation</h3><small class=bookmark-url>airflow.apache.org</small></div></a><ul><li>Jinja 템플릿 변수 기반으로 다양한 날짜 연산이 가능하도록 연산 모듈을 제공</li></ul><h3 id=macro-변수-목록>Macro 변수 목록
<a class=anchor href=#macro-%eb%b3%80%ec%88%98-%eb%aa%a9%eb%a1%9d>#</a></h3><ul><li><strong><code>macros.datetime</code></strong> : <code>datetime.datetime</code> 라이브러리 기반 연산 제공</li><li><strong><code>macros.timedelta</code></strong> : <code>datetime.timedelta</code> 라이브러리 기반 연산 제공</li><li><strong><code>macros.dateutil</code></strong> : <code>dateutil</code> 라이브러리 기반 연산 제공</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>datetime</span> <span class=k>as</span> <span class=nn>dt</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>dateutil.relativedelta</span> <span class=kn>import</span> <span class=n>relativedelta</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>today</span> <span class=o>=</span> <span class=n>dt</span><span class=o>.</span><span class=n>date</span><span class=o>.</span><span class=n>today</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1일로 변경</span>
</span></span><span class=line><span class=cl><span class=n>first_date</span> <span class=o>=</span> <span class=n>today</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>day</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=c1># datetime 연산</span>
</span></span><span class=line><span class=cl><span class=n>first_date</span> <span class=o>=</span> <span class=n>today</span> <span class=o>+</span> <span class=n>relativedelta</span><span class=p>(</span><span class=n>day</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=c1># dateutil 연산</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 1일 빼기</span>
</span></span><span class=line><span class=cl><span class=n>yesterday</span> <span class=o>=</span> <span class=n>today</span> <span class=o>-</span> <span class=n>dt</span><span class=o>.</span><span class=n>timedela</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=c1># timedela 연산</span>
</span></span><span class=line><span class=cl><span class=n>yesterday</span> <span class=o>=</span> <span class=n>today</span> <span class=o>-</span> <span class=n>relativedelta</span><span class=p>(</span><span class=n>days</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=c1># dateutil 연산</span></span></span></code></pre></div></div><h3 id=macro-변수-활용-예시>Macro 변수 활용 예시
<a class=anchor href=#macro-%eb%b3%80%ec%88%98-%ed%99%9c%ec%9a%a9-%ec%98%88%ec%8b%9c>#</a></h3><ul><li>첫 번째 DAG <code>bash_macros1</code> 은 매월 말에 실행되도록 스케줄을 지정하고,</li><li>직전 배치일에서 1일을 추가한 날짜를 <code>START_DATE</code>, 배치일을 <code>END_DATE</code> 로 설정하여 1일부터 말일이 출력되기를 기대</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dags/bash_macros1.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.sdk</span> <span class=kn>import</span> <span class=n>DAG</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.providers.standard.operators.bash</span> <span class=kn>import</span> <span class=n>BashOperator</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pendulum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dag_id</span><span class=o>=</span><span class=s2>&#34;bash_macros1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>=</span><span class=s2>&#34;0 0 L * *&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span><span class=o>=</span><span class=n>pendulum</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;example&#34;</span><span class=p>,</span> <span class=s2>&#34;template&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bash_task1</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;bash_task1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>env</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;START_DATE&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ (data_interval_start.in_timezone(</span><span class=se>\&#34;</span><span class=s2>Asia/Seoul</span><span class=se>\&#34;</span><span class=s2>) + macros.dateutil.relativedelta.relativedelta(days=1)) | ds }}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;END_DATE&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ data_interval_end.in_timezone(</span><span class=se>\&#34;</span><span class=s2>Asia/Seoul</span><span class=se>\&#34;</span><span class=s2>) | ds }}&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>bash_command</span><span class=o>=</span><span class=s2>&#34;echo </span><span class=se>\&#34;</span><span class=s2>Start date is $START_DATE </span><span class=se>\&#34;</span><span class=s2> &amp;&amp; echo </span><span class=se>\&#34;</span><span class=s2>End date is $END_DATE</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bash_task1</span></span></span></code></pre></div></div><ul><li>두 번째 DAG <code>bash_macros2</code> 는 매월 둘째주 토요일에 실행되도록 스케줄을 지정하고,
직전 배치일과 배치일을 1일로 변경해서 전월 1일과 당월 1일이 출력되기를 기대</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dags/bash_macros2.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.sdk</span> <span class=kn>import</span> <span class=n>DAG</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.providers.standard.operators.bash</span> <span class=kn>import</span> <span class=n>BashOperator</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pendulum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dag_id</span><span class=o>=</span><span class=s2>&#34;bash_macros2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>=</span><span class=s2>&#34;0 0 * * 6#2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span><span class=o>=</span><span class=n>pendulum</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;example&#34;</span><span class=p>,</span> <span class=s2>&#34;template&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bash_task2</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;bash_task2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>env</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;START_DATE&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ (data_interval_end.in_timezone(</span><span class=se>\&#34;</span><span class=s2>Asia/Seoul</span><span class=se>\&#34;</span><span class=s2>) + macros.dateutil.relativedelta.relativedelta(day=1)) | ds }}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;END_DATE&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ (data_interval_end.in_timezone(</span><span class=se>\&#34;</span><span class=s2>Asia/Seoul</span><span class=se>\&#34;</span><span class=s2>) + macros.dateutil.relativedelta.relativedelta(day=1)) | ds }}&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>bash_command</span><span class=o>=</span><span class=s2>&#34;echo </span><span class=se>\&#34;</span><span class=s2>Start date is $START_DATE </span><span class=se>\&#34;</span><span class=s2> &amp;&amp; echo </span><span class=se>\&#34;</span><span class=s2>End date is $END_DATE</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bash_task2</span></span></span></code></pre></div></div><ul><li>하지만 실행 로그를 확인했을 때 기대와 다른 결과가 확인되었는데, 마치 <code>data_interval_start</code>, <code>data_interval_end</code> 가 동일한 값을 가지고 있다고 생각됨</li></ul><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># bash_task1 (bash_macros1)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 10:54:43<span class=o>]</span> INFO - Start date is 2025-06-01: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 10:54:43<span class=o>]</span> INFO - End date is 2025-05-31: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span></span></span></code></pre></div></div><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># bash_task2 (bash_macros2)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 10:57:23<span class=o>]</span> INFO - Start date is 2025-05-01: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 10:57:23<span class=o>]</span> INFO - End date is 2025-05-01: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span></span></span></code></pre></div></div><ul><li>실제로 <code>bash_macros1</code> 의 마지막 실행 내역에 대해 Details 탭에서 실행 정보를 조회했을 때,
<code>data_interval_start</code>, <code>data_interval_end</code> 값이 모두 동일한 배치일로 나타나는 것을 확인</li><li>참고 자료로 활용한 강의에서 사용했던 Airflow 2.x 버전과, 현재 사용하는 Airflow 3.x 버전에서
<code>data_interval_start</code>, <code>data_interval_end</code> 를 결정하는 기준이 변경된 것을 인지</li></ul><p><img src="https://dl.dropboxusercontent.com/scl/fi/wcfx74annpqby7h9qmc73/airflow-19-bash-macros.webp?rlkey=5ec769twafb9d2m9ldfnfc3rc&amp;dl=0" alt="Macro 변수 목록"></p><h2 id=airflow-30-업데이트>Airflow 3.0 업데이트
<a class=anchor href=#airflow-30-%ec%97%85%eb%8d%b0%ec%9d%b4%ed%8a%b8>#</a></h2><ul><li>2.9 버전에서 <code>data_interval</code> 계산 알고리즘에 영향을 주는 <code>create_cron_data_intervals</code> 파라미터가 도입되었는데,
3.0 버전부터 기본값이 기존 <code>False</code> 에서 <code>True</code> 로 변경되면서,
기존 <code>CronDataIntervalTimetable</code> 대신 <code>CronTriggerTimetable</code> 알고리즘이 사용되도록 변경됨</li><li><strong>즉, 3.0 버전부터 기본적으로 <code>data_interval</code> 을 고려하지 않도록 변경되어 <code>data_interval_start</code> 와 <code>data_interval_end</code> 값이 모두 실제 DAG이 실행된 날짜로 표현</strong></li></ul><blockquote class=book-hint><p>The <code>create_cron_data_intervals</code> configuration is now <code>False</code> by default.
This means that the <code>CronTriggerTimetable</code> will be used by default instead of the <code>CronDataIntervalTimetable</code></p></blockquote><a href=https://airflow.apache.org/docs/apache-airflow/stable/installation/upgrading_to_airflow3.html#breaking-changes target=_blank class=bookmark-card><div class=bookmark-image><img src=https://airflow.apache.org/docs/apache-airflow/stable/_images/airflow-2-arch.png alt="Upgrading to Airflow 3 — Airflow 3.1.3 Documentation"></div><div class=bookmark-content><h3 class=bookmark-title>Upgrading to Airflow 3 — Airflow 3.1.3 Documentation</h3><small class=bookmark-url>airflow.apache.org</small></div></a><h3 id=crondataintervaltimetable>CronDataIntervalTimetable
<a class=anchor href=#crondataintervaltimetable>#</a></h3><ul><li>이전 버전의 알고리즘인 <code>CronDataIntervalTimetable</code> 의 경로를 파악해서 <code>bash_macros1</code> DAG의 스케줄을 재설정</li><li>실행 로그를 조회했을 때, 초기 의도대로 <code>START_DATE</code> 는 배치일 기준 1일, <code>END_DATE</code> 는 배치일인 말일이 출력되는 것을 확인</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dags/bash_macros1.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.sdk</span> <span class=kn>import</span> <span class=n>DAG</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.providers.standard.operators.bash</span> <span class=kn>import</span> <span class=n>BashOperator</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.timetables.interval</span> <span class=kn>import</span> <span class=n>CronDataIntervalTimetable</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pendulum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dag_id</span><span class=o>=</span><span class=s2>&#34;bash_macros1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>=</span><span class=n>CronDataIntervalTimetable</span><span class=p>(</span><span class=s2>&#34;0 0 L * *&#34;</span><span class=p>,</span> <span class=n>timezone</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span><span class=o>=</span><span class=n>pendulum</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;example&#34;</span><span class=p>,</span> <span class=s2>&#34;template&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bash_task1</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;bash_task1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>env</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;START_DATE&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ (data_interval_start.in_timezone(</span><span class=se>\&#34;</span><span class=s2>Asia/Seoul</span><span class=se>\&#34;</span><span class=s2>) + macros.dateutil.relativedelta.relativedelta(days=1)) | ds }}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;END_DATE&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ data_interval_end.in_timezone(</span><span class=se>\&#34;</span><span class=s2>Asia/Seoul</span><span class=se>\&#34;</span><span class=s2>) | ds }}&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>bash_command</span><span class=o>=</span><span class=s2>&#34;echo </span><span class=se>\&#34;</span><span class=s2>Start date is $START_DATE </span><span class=se>\&#34;</span><span class=s2> &amp;&amp; echo </span><span class=se>\&#34;</span><span class=s2>End date is $END_DATE</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bash_task1</span></span></span></code></pre></div></div><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># bash_task1 (bash_macros1)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 12:10:27<span class=o>]</span> INFO - Start date is 2025-05-01: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 12:10:27<span class=o>]</span> INFO - End date is 2025-05-31: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span></span></span></code></pre></div></div><h3 id=crontriggertimetable>CronTriggerTimetable
<a class=anchor href=#crontriggertimetable>#</a></h3><ul><li>3.0 버전 이후에서 사용되는 <code>CronTriggerTimetable</code> 알고리즘으로도 <code>data_interval</code> 을 적용할 수 있는 방법이 있는데, <code>interval</code> 파라미터로 <code>timedelta</code> 를 전달하면 가능</li><li><code>bash_macros2</code> DAG의 스케줄에 <code>CronTriggerTimetable</code> 알고리즘을 적용하면서, <code>interval</code> 파라미터로 1주의 간격을 지정 (초기 의도인 매월 둘째주 토요일과는 다르게 매주 토요일로 변경)</li><li>실행 로그를 조회했을 때, <code>END_DATE</code> 는 배치일인 5월 31일, <code>START_DATE</code> 는 직전 배치일인 5월 24일이 출력되는 것을 확인</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dags/bash_macros2.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.sdk</span> <span class=kn>import</span> <span class=n>DAG</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.providers.standard.operators.bash</span> <span class=kn>import</span> <span class=n>BashOperator</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.timetables.trigger</span> <span class=kn>import</span> <span class=n>CronTriggerTimetable</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>datetime</span> <span class=k>as</span> <span class=nn>dt</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pendulum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dag_id</span><span class=o>=</span><span class=s2>&#34;bash_macros2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>=</span><span class=n>CronTriggerTimetable</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;0 0 * * 6&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>timezone</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>interval</span><span class=o>=</span><span class=n>dt</span><span class=o>.</span><span class=n>timedelta</span><span class=p>(</span><span class=n>weeks</span><span class=o>=</span><span class=mi>1</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span><span class=o>=</span><span class=n>pendulum</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;example&#34;</span><span class=p>,</span> <span class=s2>&#34;template&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bash_task2</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;bash_task2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>env</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;START_DATE&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ data_interval_start.in_timezone(</span><span class=se>\&#34;</span><span class=s2>Asia/Seoul</span><span class=se>\&#34;</span><span class=s2>) | ds }}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;END_DATE&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ data_interval_end.in_timezone(</span><span class=se>\&#34;</span><span class=s2>Asia/Seoul</span><span class=se>\&#34;</span><span class=s2>) | ds }}&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>bash_command</span><span class=o>=</span><span class=s2>&#34;echo </span><span class=se>\&#34;</span><span class=s2>Start date is $START_DATE </span><span class=se>\&#34;</span><span class=s2> &amp;&amp; echo </span><span class=se>\&#34;</span><span class=s2>End date is $END_DATE</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bash_task2</span></span></span></code></pre></div></div><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># bash_task2 (bash_macros2)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 12:20:03<span class=o>]</span> INFO - Start date is 2025-05-24: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 12:20:03<span class=o>]</span> INFO - End date is 2025-05-31: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span></span></span></code></pre></div></div><h2 id=xcom>XCom
<a class=anchor href=#xcom>#</a></h2><a href=https://airflow.apache.org/docs/apache-airflow/stable/core-concepts/xcoms.html target=_blank class=bookmark-card><div class=bookmark-image><img src="https://dl.dropboxusercontent.com/scl/fi/jaltieh1sb4r7ozm6ju3e/airflow-00-cover-bg.webp?rlkey=s10wwm9o11zy79dwm1vje30sb&amp;dl=0" alt="XComs — Airflow 3.1.3 Documentation"></div><div class=bookmark-content><h3 class=bookmark-title>XComs — Airflow 3.1.3 Documentation</h3><small class=bookmark-url>airflow.apache.org</small></div></a><ul><li>Cross Communication이란 의미로, Airflow DAG 내 Task 간 데이터 공유를 위해 사용되는 기술</li><li>주로 작은 규모의 데이터 공유를 위해 사용 (XCom 내용은 메타 DB의 xcom 테이블에 값이 저장)<ul><li>1GB 이상의 대용량 데이터 공유를 위해서는 외부 솔루션 사용 필요</li></ul></li></ul><h3 id=xcom-사용법>XCom 사용법
<a class=anchor href=#xcom-%ec%82%ac%ec%9a%a9%eb%b2%95>#</a></h3><ul><li>keyword arguments로 전달되는 <code>ti</code> (task_instance) 객체를 활용</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;task1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>task1</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>ti</span> <span class=o>=</span> <span class=n>kwargs</span><span class=p>[</span><span class=s2>&#34;ti&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=n>ti</span><span class=o>.</span><span class=n>xcom_push</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=s2>&#34;key1&#34;</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=s2>&#34;value1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;task2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>task2</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>ti</span> <span class=o>=</span> <span class=n>kwargs</span><span class=p>[</span><span class=s2>&#34;ti&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=n>value1</span> <span class=o>=</span> <span class=n>ti</span><span class=o>.</span><span class=n>xcom_pull</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=s2>&#34;key1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>value1</span><span class=p>)</span></span></span></code></pre></div></div><ul><li>만약 서로 다른 Task 에서 동일한 키값을 push 한 후, 단순히 해당 키값을 pull로 꺼낼 때, 가장 마지막에 push된 키값이 반환</li><li>안전하게 키값을 꺼내오기 위해서는 대상 Task를 가리키는 <code>task_ids</code> 파라미터를 명시할 수 있음</li></ul><blockquote class=book-hint><p>주의) Airflow 3.0 버전에서는 <code>task_ids</code> 가 반드시 명시되어야 함</p></blockquote><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;task2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>task2</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>ti</span> <span class=o>=</span> <span class=n>kwargs</span><span class=p>[</span><span class=s2>&#34;ti&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=n>value1</span> <span class=o>=</span> <span class=n>ti</span><span class=o>.</span><span class=n>xcom_pull</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=s2>&#34;key1&#34;</span><span class=p>,</span> <span class=n>task_ids</span><span class=o>=</span><span class=s2>&#34;task1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>value1</span><span class=p>)</span></span></span></code></pre></div></div><h3 id=return-값-활용>return 값 활용
<a class=anchor href=#return-%ea%b0%92-%ed%99%9c%ec%9a%a9>#</a></h3><ul><li><code>@task</code> 데코레이터 사용 시 return 값은 자동으로 XCom에 <code>return_value</code> 키로 저장</li><li>다음 단계의 Task에서 이전 단계의 return 값을 꺼낼 수 있음</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;task1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>task1</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=s2>&#34;value1&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;task2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>task2</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>ti</span> <span class=o>=</span> <span class=n>kwargs</span><span class=p>[</span><span class=s2>&#34;ti&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=n>value1</span> <span class=o>=</span> <span class=n>ti</span><span class=o>.</span><span class=n>xcom_pull</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=s2>&#34;return_value&#34;</span><span class=p>,</span> <span class=n>task_ids</span><span class=o>=</span><span class=s2>&#34;task1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>value1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>task1</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>task2</span><span class=p>()</span></span></span></code></pre></div></div><ul><li>또는, 데코레이터 사용 시 함수의 출력값을 다음 함수의 입력값으로 직접 전달하는 표현을 통해 return 값을 인수로 전달할 수도 있음</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;task1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>task1</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=s2>&#34;value1&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;task2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>task2</span><span class=p>(</span><span class=n>value1</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=n>value1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>task2</span><span class=p>(</span><span class=n>task1</span><span class=p>())</span></span></span></code></pre></div></div><h2 id=xcom-활용>Xcom 활용
<a class=anchor href=#xcom-%ed%99%9c%ec%9a%a9>#</a></h2><h3 id=pythonoperator-1-1>PythonOperator (1)
<a class=anchor href=#pythonoperator-1-1>#</a></h3><ul><li>앞서 서술한 코드를 DAG 안에서 Task로 구현</li><li>두 개의 <code>xcom_push_task</code> 에서 동일한 키값을 XCom에 push하고, <code>xcom_pull_task</code> 에서 Xcom으로부터 키값을 pull하여 출력</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dags/python_xcom1.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.sdk</span> <span class=kn>import</span> <span class=n>DAG</span><span class=p>,</span> <span class=n>task</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.models.taskinstance</span> <span class=kn>import</span> <span class=n>TaskInstance</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pendulum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dag_id</span><span class=o>=</span><span class=s2>&#34;python_xcom1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>=</span><span class=s2>&#34;0 0 * * *&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span><span class=o>=</span><span class=n>pendulum</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;example&#34;</span><span class=p>,</span> <span class=s2>&#34;xcom&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;xcom_push_task1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>xcom_push_task1</span><span class=p>(</span><span class=n>ti</span><span class=p>:</span> <span class=n>TaskInstance</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>ti</span><span class=o>.</span><span class=n>xcom_push</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=s2>&#34;key1&#34;</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=s2>&#34;value1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ti</span><span class=o>.</span><span class=n>xcom_push</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=s2>&#34;key2&#34;</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=p>[</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;xcom_push_task2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>xcom_push_task2</span><span class=p>(</span><span class=n>ti</span><span class=p>:</span> <span class=n>TaskInstance</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>ti</span><span class=o>.</span><span class=n>xcom_push</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=s2>&#34;key1&#34;</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=s2>&#34;value2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ti</span><span class=o>.</span><span class=n>xcom_push</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=s2>&#34;key2&#34;</span><span class=p>,</span> <span class=n>value</span><span class=o>=</span><span class=p>[</span><span class=mi>4</span><span class=p>,</span><span class=mi>5</span><span class=p>,</span><span class=mi>6</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;xcom_pull_task&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>xcom_pull_task</span><span class=p>(</span><span class=n>ti</span><span class=p>:</span> <span class=n>TaskInstance</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>value1</span> <span class=o>=</span> <span class=n>ti</span><span class=o>.</span><span class=n>xcom_pull</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=s2>&#34;key1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>value2</span> <span class=o>=</span> <span class=n>ti</span><span class=o>.</span><span class=n>xcom_pull</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=s2>&#34;key2&#34;</span><span class=p>,</span> <span class=n>task_ids</span><span class=o>=</span><span class=s2>&#34;xcom_push_task1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>value1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>value2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>xcom_push_task1</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>xcom_push_task2</span><span class=p>()</span> <span class=o>&gt;&gt;</span> <span class=n>xcom_pull_task</span><span class=p>()</span></span></span></code></pre></div></div><ul><li>두 개의 <code>xcom_push_task</code> 실행 내역의 XCom 탭에서 <code>key1</code> 과 <code>key2</code> 에 대한 값이 지정됨을 확인</li><li><code>xcom_pull_task</code> 에서는 <code>task_ids</code> 를 지정하지 않았을 때 마지막으로 push된 "value2"가 출력될 것을 기대했지만, Airflow 3.0에서 발생한 업데이트로 인해 None 값이 출력</li></ul><p><img src="https://dl.dropboxusercontent.com/scl/fi/j0vd8nzylw6qanmygqxhb/airflow-20-xcom-push-task1.webp?rlkey=x6e0oqpuaf8lxltfy6v91fx7u&amp;dl=0" alt="xcom_push_task1 > XCom 목록"></p><p><img src="https://dl.dropboxusercontent.com/scl/fi/20rcijufdw87qw9xw3cxv/airflow-21-xcom-push-task2.webp?rlkey=47xl0no6t7wdemtgiwdnn3srd&amp;dl=0" alt="xcom_push_task2 > XCom 목록"></p><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># xcom_pull_task</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 15:27:41<span class=o>]</span> INFO - None: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 15:27:41<span class=o>]</span> INFO - <span class=o>[</span>1, 2, 3<span class=o>]</span>: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span></span></span></code></pre></div></div><h4 id=airflow-30-업데이트-1>Airflow 3.0 업데이트
<a class=anchor href=#airflow-30-%ec%97%85%eb%8d%b0%ec%9d%b4%ed%8a%b8-1>#</a></h4><ul><li>Airflow 3.0부터는 <code>task_ids</code> 를 반드시 명시하도록 변경됨<ul><li><code>kwargs["ti"].xcom_pull(key="key")</code> 와 같은 구문은 더 이상 작동하지 않음</li></ul></li></ul><blockquote class=book-hint><p>In Airflow 2, the <code>xcom_pull()</code> method allowed pulling XComs by key without specifying task_ids, ..., leading to unpredictable behavior.
Airflow 3 resolves this inconsistency by requiring <code>task_ids</code> when pulling by key.</p></blockquote><a href=https://airflow.apache.org/docs/apache-airflow/stable/release_notes.html#behaviour-change-in-xcom-pull target=_blank class=bookmark-card><div class=bookmark-image><img src="https://dl.dropboxusercontent.com/scl/fi/jaltieh1sb4r7ozm6ju3e/airflow-00-cover-bg.webp?rlkey=s10wwm9o11zy79dwm1vje30sb&amp;dl=0" alt="Release Notes — Airflow 3.1.3 Documentation"></div><div class=bookmark-content><h3 class=bookmark-title>Release Notes — Airflow 3.1.3 Documentation</h3><small class=bookmark-url>airflow.apache.org</small></div></a><h3 id=pythonoperator-2-1>PythonOperator (2)
<a class=anchor href=#pythonoperator-2-1>#</a></h3><ul><li><code>xcom_return_task</code> 에서 문자열 "Success"를 반환하고, 두 개의 <code>xcom_pull_task</code> 에서 서로 다른 방식으로 return 값을 받아 출력</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dags/python_xcom2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.sdk</span> <span class=kn>import</span> <span class=n>DAG</span><span class=p>,</span> <span class=n>task</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.models.taskinstance</span> <span class=kn>import</span> <span class=n>TaskInstance</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pendulum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dag_id</span><span class=o>=</span><span class=s2>&#34;python_xcom2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>=</span><span class=s2>&#34;0 0 * * *&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span><span class=o>=</span><span class=n>pendulum</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;example&#34;</span><span class=p>,</span> <span class=s2>&#34;xcom&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;xcom_return_task&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>xcom_return_task</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;Success&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;xcom_pull_task1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>xcom_pull_task1</span><span class=p>(</span><span class=n>ti</span><span class=p>:</span> <span class=n>TaskInstance</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>status</span> <span class=o>=</span> <span class=n>ti</span><span class=o>.</span><span class=n>xcom_pull</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=s2>&#34;return_value&#34;</span><span class=p>,</span> <span class=n>task_ids</span><span class=o>=</span><span class=s2>&#34;xcom_return_task&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>xcom_return_task</span><span class=se>\&#34;</span><span class=s2> 함수의 리턴 값: </span><span class=si>{</span><span class=n>status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;xcom_pull_task2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>xcom_pull_task2</span><span class=p>(</span><span class=n>status</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\&#34;</span><span class=s2>xcom_return_task</span><span class=se>\&#34;</span><span class=s2> 함수로부터 전달받은 값: </span><span class=si>{</span><span class=n>status</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>return_value</span> <span class=o>=</span> <span class=n>xcom_return_task</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>return_value</span> <span class=o>&gt;&gt;</span> <span class=n>xcom_pull_task1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>xcom_pull_task2</span><span class=p>(</span><span class=n>return_value</span><span class=p>)</span></span></span></code></pre></div></div><ul><li>두 개의 <code>xcom_pull_task</code> 에서 모두 정상적으로 return 값을 받아서 동일한 결과가 출력됨을 확인</li></ul><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># xcom_pull_task1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 15:36:10<span class=o>]</span> INFO - <span class=s2>&#34;xcom_return_task&#34;</span> 함수의 리턴 값: <span class=s2>&#34;Success&#34;</span>: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span></span></span></code></pre></div></div><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># xcom_pull_task2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 15:36:10<span class=o>]</span> INFO - <span class=s2>&#34;xcom_return_task&#34;</span> 함수로부터 전달받은 값: <span class=s2>&#34;Success&#34;</span>: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span></span></span></code></pre></div></div><h3 id=bashoperator-1>BashOperator
<a class=anchor href=#bashoperator-1>#</a></h3><ul><li>Jinja 템플릿 문법을 통해 <code>ti.xcom_push</code> 또는 <code>ti.xcom_pull</code> 사용이 가능</li><li>마지막 출력문은 자동으로 <code>return_value</code> 로 전달</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dags/bash_xcom.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.sdk</span> <span class=kn>import</span> <span class=n>DAG</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.providers.standard.operators.bash</span> <span class=kn>import</span> <span class=n>BashOperator</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pendulum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dag_id</span><span class=o>=</span><span class=s2>&#34;bash_xcom&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>=</span><span class=s2>&#34;0 0 * * *&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span><span class=o>=</span><span class=n>pendulum</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;example&#34;</span><span class=p>,</span> <span class=s2>&#34;xcom&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>bash_push_task</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;bash_push_task&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>bash_command</span><span class=o>=</span><span class=s2>&#34;echo START &amp;&amp; echo XCOM PUSHED {{ ti.xcom_push(key=&#39;bash_pushed&#39;, value=&#39;bash_message&#39;) }} &amp;&amp; echo COMPLETE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bash_pull_task</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;bash_pull_task&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>env</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;PUSHED_VALUE&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ ti.xcom_pull(key=&#39;bash_pushed&#39;, task_ids=&#39;bash_push_task&#39;) }}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;RETURN_VALUE&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ ti.xcom_pull(key=&#39;return_value&#39;, task_ids=&#39;bash_push_task&#39;) }}&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>bash_command</span><span class=o>=</span><span class=s2>&#34;echo $PUSHED_VALUE &amp;&amp; echo $RETURN_VALUE&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bash_push_task</span> <span class=o>&gt;&gt;</span> <span class=n>bash_pull_task</span></span></span></code></pre></div></div><ul><li><code>bash_push_task</code> 의 실행 내역에서 직접 push한 <code>bash_pushed</code> 가 XCom에 들어있고, 마지막 출력문도 <code>return_value</code> 로 저장되어 있음을 조회</li><li><code>bash_pull_task</code> 에서 첫 번째로는 XCom에서 <code>bash_pushed</code> 키를 가지고 꺼낸 PUSHED_VALUE 값을 출력하여, 실행 로그에 "bash_message" 가 출력됨을 확인</li><li>두 번째로는 Xcom에서 <code>return_value</code> 키를 가지고 꺼낸 RETURN_VALUE 값을 출력하여, 실행 로그에 <code>bash_push_task</code> 의 마지막 출력문 "COMPLETE" 가 출력됨을 확인</li></ul><p><img src="https://dl.dropboxusercontent.com/scl/fi/4qwkzxfg4atptcz3djxs4/airflow-22-bash-push-task.webp?rlkey=lr5wsqb82ititdv0f0jp1ic82&amp;dl=0" alt="bash_push_task1 > XCom 목록"></p><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># bash_pull_task</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 16:05:09<span class=o>]</span> INFO - bash_message: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 16:05:09<span class=o>]</span> INFO - COMPLETE: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span></span></span></code></pre></div></div><h3 id=python--bash-전달>Python → Bash 전달
<a class=anchor href=#python--bash-%ec%a0%84%eb%8b%ac>#</a></h3><ul><li>PythonOperator에서 딕셔너리 객체를 반환했을 경우, BashOperator에서 XCom을 통해 딕셔너리 내 특정 값을 꺼낼 수 있음</li><li>반대로, BashOperator에서 push한 값 또는 마지막 출력문을 PythonOperator에서 XCom을 통해 꺼낼 수도 있음</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;python_push&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>python_push_xcom</span><span class=p>():</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>{</span><span class=s2>&#34;status&#34;</span><span class=p>:</span><span class=s2>&#34;Success&#34;</span><span class=p>,</span> <span class=s2>&#34;data&#34;</span><span class=p>:[</span><span class=mi>1</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>]}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bash_pull</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;bash_pull&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>env</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    	<span class=s2>&#34;STATUS&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ ti.xcom_pull(key=</span><span class=se>\&#34;</span><span class=s2>return_value</span><span class=se>\&#34;</span><span class=s2>, task_ids=</span><span class=se>\&#34;</span><span class=s2>python_push</span><span class=se>\&#34;</span><span class=s2>)[</span><span class=se>\&#34;</span><span class=s2>status</span><span class=se>\&#34;</span><span class=s2>] }}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    	<span class=s2>&#34;DATA&#34;</span><span class=p>:</span> <span class=s2>&#34;{{ ti.xcom_pull(key=</span><span class=se>\&#34;</span><span class=s2>return_value</span><span class=se>\&#34;</span><span class=s2>, task_ids=</span><span class=se>\&#34;</span><span class=s2>python_push</span><span class=se>\&#34;</span><span class=s2>)[</span><span class=se>\&#34;</span><span class=s2>data</span><span class=se>\&#34;</span><span class=s2>] }}&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=n>bash_command</span><span class=o>=</span><span class=s2>&#34;echo $STATUS &amp;&amp; echo $DATA&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></div></div><h2 id=variable>Variable
<a class=anchor href=#variable>#</a></h2><a href=https://airflow.apache.org/docs/apache-airflow/stable/core-concepts/variables.html target=_blank class=bookmark-card><div class=bookmark-image><img src="https://dl.dropboxusercontent.com/scl/fi/jaltieh1sb4r7ozm6ju3e/airflow-00-cover-bg.webp?rlkey=s10wwm9o11zy79dwm1vje30sb&amp;dl=0" alt="Variables — Airflow 3.1.3 Documentation"></div><div class=bookmark-content><h3 class=bookmark-title>Variables — Airflow 3.1.3 Documentation</h3><small class=bookmark-url>airflow.apache.org</small></div></a><ul><li>모든 DAG에서 공유하는 전역 변수</li><li>Airflow UI에서 Admin 메뉴를 통해 접근 및 생성 가능</li></ul><p><img src="https://dl.dropboxusercontent.com/scl/fi/n02tx2fag1ngmoo34c2ar/airflow-23-variable.webp?rlkey=lks97xtcwoplxjhx6tg3rxjga&amp;dl=0" alt="Variable 페이지"></p><p><img src="https://dl.dropboxusercontent.com/scl/fi/of4scht6bxg0avu0t69m0/airflow-24-add-variable.webp?rlkey=k0lij755upimzylzcxk4bnhhj&amp;dl=0" alt="Variable 추가"></p><h3 id=variable-가져오기>Variable 가져오기
<a class=anchor href=#variable-%ea%b0%80%ec%a0%b8%ec%98%a4%ea%b8%b0>#</a></h3><ul><li>Variable 라이브러리를 통해 전역 변수를 꺼내는 방법</li><li>해당 방법은 DAG를 파싱할 때마다 DB 연결을 발생시켜 불필요한 부하가 발생 (스케줄러 과부하 원인)</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.models</span> <span class=kn>import</span> <span class=n>Variable</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>var</span> <span class=o>=</span> <span class=n>Variable</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;key&#34;</span><span class=p>)</span></span></span></code></pre></div></div><ul><li>Jinja 템플릿을 이용해 Operator 내부에서 가져오는 방법</li><li>실제 실행할때만 DB에 접근하기 때문에 상대적으로 부하가 적음 (Airflow에서 권장하는 방법)</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.operators.bash</span> <span class=kn>import</span> <span class=n>BashOperator</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>bash_task</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;bash_task&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>bash_command</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;echo </span><span class=se>{{</span><span class=s2>var.value.key</span><span class=se>}}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span></span></span></code></pre></div></div><h3 id=variable-활용>Variable 활용
<a class=anchor href=#variable-%ed%99%9c%ec%9a%a9>#</a></h3><ul><li>앞서 서술한 코드를 DAG 안에서 Task로 구현</li><li>첫 번째 Task에서는 Variable 라이브러리로 꺼낸 전역 변수를 출력하고, 두 번째 Task에서는 Jinja 템플릿을 이용해 전역 변수를 출력</li></ul><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dags/bash_variable.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.sdk</span> <span class=kn>import</span> <span class=n>DAG</span><span class=p>,</span> <span class=n>Variable</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.providers.standard.operators.bash</span> <span class=kn>import</span> <span class=n>BashOperator</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pendulum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dag_id</span><span class=o>=</span><span class=s2>&#34;bash_variable&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>=</span><span class=s2>&#34;0 0 * * *&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span><span class=o>=</span><span class=n>pendulum</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;example&#34;</span><span class=p>,</span> <span class=s2>&#34;xcom&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>var</span> <span class=o>=</span> <span class=n>Variable</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;sample_key&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bash_var_task1</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;bash_var_task1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>bash_command</span><span class=o>=</span><span class=sa>f</span><span class=s2>&#34;echo variable: </span><span class=se>\&#34;</span><span class=si>{</span><span class=n>var</span><span class=si>}</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>bash_var_task2</span> <span class=o>=</span> <span class=n>BashOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;bash_var_task2&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>bash_command</span><span class=o>=</span><span class=s2>&#34;echo variable: </span><span class=se>\&#34;</span><span class=s2>{{ var.value.sample_key }}</span><span class=se>\&#34;</span><span class=s2>&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span></span></span></code></pre></div></div><ul><li>기대했던 것과 달리, 실행 로그에서는 전역 변수가 마스킹 처리되어 출력</li><li><code>airflow.cfg</code> 설정에서 <code>sensitive_var_conn_names</code> 항목을 확인해보고, Web UI 컨테이너에 들어가서 <code>airflow variables get</code> 명령어로 전역 변수가 마스킹된 채로 저장되어 있는지도 확인해보고, BashOperator 안에서 비교 연산자로 설정한 것과 동일한 값이 가져와지는지도 출력해서 확인해봤는데, 모두 정상적이고 실행 로그에서 전역 변수를 직접 출력할 때만 마스킹 처리됨</li><li>어떻게든 출력해보려고 했지만, 모든 사람이 접근할 수 있는 환경 변수를 평문으로 출력시키지 않으려는 의도가 있다고 짐작하고 추가적인 시도를 중지함</li></ul><div class=book-codeblock data-lang=bash><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># bash_var_task1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-03, 16:52:07<span class=o>]</span> INFO - variable: ***: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.hooks.airflow.providers.standard.hooks.subprocess.SubprocessHook&#34;</span></span></span></code></pre></div></div><a href=https://airflow.apache.org/docs/apache-airflow/stable/security/secrets/mask-sensitive-values.html target=_blank class=bookmark-card><div class=bookmark-image><img src="https://dl.dropboxusercontent.com/scl/fi/jaltieh1sb4r7ozm6ju3e/airflow-00-cover-bg.webp?rlkey=s10wwm9o11zy79dwm1vje30sb&amp;dl=0" alt="Masking sensitive data — Airflow 3.1.3 Documentation"></div><div class=bookmark-content><h3 class=bookmark-title>Masking sensitive data — Airflow 3.1.3 Documentation</h3><small class=bookmark-url>airflow.apache.org</small></div></a></article><div class=book-nav><button class=book-nav-btn3 onclick='window.scrollTo({top:0,behavior:"smooth"})' title="Go to top">
<i class="fa fa-chevron-up"></i>
</button>
<button class=book-nav-btn3 onclick='window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})' title="Go to bottom">
<i class="fa fa-chevron-down"></i>
<button class=book-nav-btn3 onclick=history.back() title="Go back">
<i class="fa-solid fa-arrow-left"></i></button></div><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class=post-tags><a href=/tags/apache-airflow/ class=tag>#Apache Airflow</a>
<a href=/tags/jinja-%ED%85%9C%ED%94%8C%EB%A6%BF/ class=tag>#Jinja 템플릿</a>
<a href=/tags/xcom/ class=tag>#XCom</a>
<a href=/tags/variable/ class=tag>#Variable</a>
<a href=/tags/%ED%85%9C%ED%94%8C%EB%A6%BF-%EB%B3%80%EC%88%98/ class=tag>#템플릿 변수</a>
<a href=/tags/bashoperator/ class=tag>#BashOperator</a>
<a href=/tags/pythonoperator/ class=tag>#PythonOperator</a>
<a href=/tags/%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%97%94%EC%A7%80%EB%8B%88%EC%96%B4%EB%A7%81/ class=tag>#데이터 엔지니어링</a>
<a href=/tags/%EC%97%90%EC%96%B4%ED%94%8C%EB%A1%9C%EC%9A%B0/ class=tag>#에어플로우</a>
<a href=/tags/python/ class=tag>#Python</a>
<a href=/tags/study/ class=tag>#Study</a></div><div class=post-navigation><a href=/blog/airflow-study-2/ class="post-nav-link post-nav-prev"><span class=post-nav-direction><i class="fa-solid fa-backward"></i> PREV</span>
<span class=post-nav-title>Apache Airflow - 기본 Operator 이해하기 (Bash, Python)</span>
</a><a href=/blog/airflow-study-4/ class="post-nav-link post-nav-next"><span class=post-nav-direction>NEXT <i class="fa-solid fa-forward"></i></span>
<span class=post-nav-title>Apache Airflow - 조건부 실행과 알림 (Branch, Email Operator)</span></a></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script><div class=book-comments><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://minyeamer.github.io/blog/airflow-study-3/",this.page.identifier="https://minyeamer.github.io/blog/airflow-study-3/"};(function(){var e=document,t=e.createElement("script");t.src="https://minyeamer.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})();function reloadDisqus(){window.DISQUS&&DISQUS.reset({reload:!0,config:function(){this.page.url="https://minyeamer.github.io/blog/airflow-study-3/",this.page.identifier="https://minyeamer.github.io/blog/airflow-study-3/"}})}</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#jinja-템플릿>Jinja 템플릿</a><ul><li></li></ul></li><li><a href=#jinja-템플릿-변수-활용>Jinja 템플릿 변수 활용</a><ul><li><a href=#bashoperator>BashOperator</a></li><li><a href=#pythonoperator-1>PythonOperator (1)</a></li><li><a href=#pythonoperator-2>PythonOperator (2)</a></li></ul></li><li><a href=#macro-변수>Macro 변수</a><ul><li><a href=#macro-변수-목록>Macro 변수 목록</a></li><li><a href=#macro-변수-활용-예시>Macro 변수 활용 예시</a></li></ul></li><li><a href=#airflow-30-업데이트>Airflow 3.0 업데이트</a><ul><li><a href=#crondataintervaltimetable>CronDataIntervalTimetable</a></li><li><a href=#crontriggertimetable>CronTriggerTimetable</a></li></ul></li><li><a href=#xcom>XCom</a><ul><li><a href=#xcom-사용법>XCom 사용법</a></li><li><a href=#return-값-활용>return 값 활용</a></li></ul></li><li><a href=#xcom-활용>Xcom 활용</a><ul><li><a href=#pythonoperator-1-1>PythonOperator (1)</a></li><li><a href=#pythonoperator-2-1>PythonOperator (2)</a></li><li><a href=#bashoperator-1>BashOperator</a></li><li><a href=#python--bash-전달>Python → Bash 전달</a></li></ul></li><li><a href=#variable>Variable</a><ul><li><a href=#variable-가져오기>Variable 가져오기</a></li><li><a href=#variable-활용>Variable 활용</a></li></ul></li></ul></nav></div></aside></main></body></html>