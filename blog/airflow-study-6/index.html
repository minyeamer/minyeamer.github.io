<!doctype html><html lang=ko-kr dir=ltr><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><meta name=author content><meta name=keywords content="Apache Airflow,HttpOperator,BaseOperator,REST API,네이버 Open API,Custom Operator,데이터 엔지니어링,에어플로우,Python,Study"><meta name=description content="Apache Airflow의 HttpOperator와 Custom Operator 개념을 소개하고, 네이버 Open API 연동과 BaseOperator 상속을 단계별로 안내합니다 …"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><link rel=icon href=https://minyeamer.github.io/images/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://minyeamer.github.io/images/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://minyeamer.github.io/images/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://minyeamer.github.io/images/favicons/apple-touch-icon.png><link rel=mask-icon href=https://minyeamer.github.io/images/favicons/apple-touch-icon.png><meta name=google-site-verification content="u1tWcHmHUZWfFT1cHaku6sqU-bK40N3WLR-C-4VUWN0"><meta name=naver-site-verification content="6eaf8e9da1a6104780f056f1a7797fe5a3a5a0da"><meta property="og:title" content="Apache Airflow - REST API 연동과 Custom Operator 구현"><meta property="og:description" content="Apache Airflow의 HttpOperator와 Custom Operator 개념을 소개하고, 네이버 Open API 연동과 BaseOperator 상속을 단계별로 안내합니다 …"><meta property="og:type" content="article"><meta property="og:url" content="https://minyeamer.github.io/blog/airflow-study-6/"><meta property="og:image" content="https://dl.dropboxusercontent.com/scl/fi/8oxi6rw0kesl9l3egs78s/airflow-00-cover.webp?rlkey=6abx67jiweasmlwehj4o4gdle&amp;raw=1"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-07T12:50:14+09:00"><meta property="article:modified_time" content="2025-06-07T12:50:14+09:00"><meta property="og:see_also" content="https://minyeamer.github.io/blog/airflow-study-7/"><meta property="og:see_also" content="https://minyeamer.github.io/blog/airflow-study-5/"><meta property="og:see_also" content="https://minyeamer.github.io/blog/airflow-study-4/"><meta property="og:see_also" content="https://minyeamer.github.io/blog/airflow-study-3/"><meta property="og:see_also" content="https://minyeamer.github.io/blog/airflow-study-2/"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://dl.dropboxusercontent.com/scl/fi/8oxi6rw0kesl9l3egs78s/airflow-00-cover.webp?rlkey=6abx67jiweasmlwehj4o4gdle&amp;raw=1"><meta name=twitter:title content="Apache Airflow - REST API 연동과 Custom Operator 구현"><meta name=twitter:description content="Apache Airflow의 HttpOperator와 Custom Operator 개념을 소개하고, 네이버 Open API 연동과 BaseOperator 상속을 단계별로 안내합니다 …"><meta name=twitter:site content="@https://x.com/minyeamer"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://minyeamer.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Apache Airflow - REST API 연동과 Custom Operator 구현","item":"https://minyeamer.github.io/blog/airflow-study-6/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Apache Airflow - REST API 연동과 Custom Operator 구현","name":"Apache Airflow - REST API 연동과 Custom Operator 구현","description":"Apache Airflow의 HttpOperator와 Custom Operator 개념을 소개하고, 네이버 Open API 연동과 BaseOperator 상속을 단계별로 안내합니다. REST API 호출, Connection 설정, Variable 활용, CSV 파일 저장, NaverSearchToCsvOperator 구현까지 다룹니다.\n","keywords":["Apache Airflow, HttpOperator, BaseOperator, REST API, 네이버 Open API, Custom Operator, 데이터 엔지니어링, 에어플로우, Python, Study"],"articleBody":" Apache Airflow 배우기 1. 설치하기 (Docker Compose) 2. 기본 Operator 이해하기 (Bash, Python) 3. 데이터 전달과 템플릿 활용 (Jinja, XCom, Variable) 4. 조건부 실행과 알림 (Branch, Email Operator) 5. DAG 흐름 제어 (Trigger Rule, TriggerDagRun, TaskGroup) 6. REST API 연동과 Custom Operator 구현 7. 외부 시스템 연동 (Connection, Hook, PostgreSQL) 숨기기 목록 보기 6/7 HttpOperator # apache-airflow-providers-http — apache-airflow-providers-http Documentationairflow.apache.org HTTP 요청을 하고 응답 결과를 반환받는 Operator (반환값은 XCom에 저장) HTTP를 이용하여 API를 처리하는 RestAPI 호출 시 사용 가능 Provider 패키지 설치 # HttpOperator 는 Provider 패키지로 별도의 설치가 필요 5.3.0 버전을 기준으로 apache-airflow\u003e=2.10.0 버전을 요구 Copy bash pip install apache-airflow-providers-httpHttpOperator 파라미터 # airflow.providers.http.operators.http — apache-airflow-providers-http …airflow.apache.org http_conn_id : http Connection을 생성해야 하는데 해당 Connection의 ID endpoint : Connection에 등록한 Host 뒤에 붙는 경로 method : HTTP 메서드 (GET, POST, PUT, DELETE 등) data : POST 요청 시 전달할 데이터 또는 GET 요청 시 전달할 파라미터 headers : HTTP 요청 헤더 response_check : HTTP 응답 결과가 정상인지 확인하는 함수 (True 반환) response_filter : HTTP 응답 결과에 대한 전처리 함수 네이버 쇼핑 검색 API # 검색 \u003e 쇼핑 - Search API 검색 \u003e 쇼핑 쇼핑 검색 개요 개요 사전 준비 사항 쇼핑 검색 API 레퍼런스 쇼핑 검색 결과 조회 오류 코드 검색 API 쇼핑 검색 구현 예제 쇼핑 검색 개요 개요 사전 준비 사항 개요 검색 API와 쇼핑 검색 개 … developers.naver.com HttpOperator 활용을 위해 간단한 API를 예제로 사용 네이버 쇼핑 검색 API는 네이버에서 제공하는 Open API 중 하나로 네이버 쇼핑 페이지에서 검색한 결과를 XML 형식 또는 JSON 형식으로 반환하는 RestAPI 하나의 키워드를 전달하여 정확도순으로 1위에 노출되는 상품 정보를 출력하는 기능을 구현 API 키 생성 # 네이버 개발자 센터에서 로그인 후 상단의 메뉴 중 Application-\u003e애플리케이션 등록 으로 이동 아래 이미지와 같이 사용 API로 \"검색\"을 선택하고, 임의로 애플리케이션 이름과 서비스 환경을 입력하여 애플리케이션 등록 생성한 애플리케이션 정보에서 Client ID 와 Client Secret 을 조회 가능 Connection 추가 # 문서에 명시된 요청 URL을 참고하여 Host 를 입력 API가 별도로 알려지지 않은 포트를 사용할 경우 Port 에 포트 번호를 입력하지만, 네이버 Open API는 표준 HTTPS 포트를 사용하기 때문에 미표기 Variable 추가 # API키는 Variable로 추가하는데, Client ID 와 Client Secret 을 각각의 Variable로 등록 Client Secret 의 키 명칭에는 \"secret\" 이 포함되어 UI에서 자동으로 마스킹 처리되는 것을 확인 HttpOperator 활용 예시 # 앞서 등록한 Connection의 ID를 http_conn_id 에 입력하고, endpoint 에 Host를 제외한 나머지 경로를 입력 data 에는 GET 요청에 대한 파라미터를 전달하는데, query 로 원하는 키워드를 입력 headers 에는 Jinja 템플릿을 활용하여 Client ID 와 Client Secret 에 대한 Variable 값을 추가 HTTPS 요청 후 반환되는 Response 객체를 JSON 파싱하여 items 배열 내 첫 번째 항목, 즉 \"노트북\" 키워드로 검색한 결과에서 1위로 노출되는 상품을 딕셔너리 타입으로 반환 다음 단계의 Task print_product_task 에서는 XCom에서 반환된 값을 꺼내 단순 출력 Copy python # dags/http_operator.py from airflow.sdk import DAG, task from airflow.providers.http.operators.http import HttpOperator from airflow.models.taskinstance import TaskInstance import pendulum with DAG( dag_id=\"http_operator\", start_date=pendulum.datetime(2025, 6, 1, tz=\"Asia/Seoul\"), schedule=None, catchup=False, tags=[\"example\", \"http\"], ) as dag: def parse(response): return response.json()[\"items\"][0] nshopping_search_task = HttpOperator( task_id=\"nshopping_search_task\", http_conn_id=\"openapi.naver.com\", endpoint=\"/v1/search/shop.json\", method=\"GET\", data={ \"query\": \"노트북\", \"display\": 10, \"start\": 1, \"sort\": \"sim\" }, headers={ \"Content-Type\": \"application/json\", \"X-Naver-Client-Id\": \"{{var.value.client_id_openapi_naver_com}}\", \"X-Naver-Client-Secret\": \"{{var.value.client_secret_openapi_naver_com}}\" }, response_filter=parse ) @task(task_id=\"print_product_task\") def print_product_task(ti: TaskInstance, **kwargs): result = ti.xcom_pull(task_ids=\"nshopping_search_task\") from pprint import pprint pprint(result) nshopping_search_task \u003e\u003e print_product_task() DAG 실행 후 print_product_task 의 실행 로그를 확인했을 때, 아래와 같이 nshopping_search_task 에서 반환된 상품에 대한 정보를 조회 가능 Copy bash # print_product_task [2025-06-07, 12:33:35] INFO - DAG bundles loaded: dags-folder: source=\"airflow.dag_processing.bundles.manager.DagBundlesManager\" [2025-06-07, 12:33:35] INFO - Filling up the DagBag from /opt/airflow/dags/http_operator.py: source=\"airflow.models.dagbag.DagBag\" [2025-06-07, 12:33:35] INFO - {'brand': '갤럭시북',: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - 'category1': '디지털/가전',: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - 'category2': '노트북',: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - 'category3': '',: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - 'category4': '',: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - 'hprice': '',: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - 'image': 'https://shopping-phinf.pstatic.net/main_8795238/87952389253.11.jpg',: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - 'link': 'https://smartstore.naver.com/main/products/10407884292',: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - 'lprice': '428000',: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - 'maker': '삼성전자',: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - 'mallName': '삼성공식파트너 코인비엠에스',: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - 'productId': '87952389253',: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - 'productType': '2',: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - 'title': '삼성 갤럭시북 인강용 사무용 업무용 가성비 윈도우11 저가 싼 태블릿 노트북 추천 기본팩'}: chan=\"stdout\": source=\"task\" [2025-06-07, 12:33:35] INFO - Done. Returned value was: None: source=\"airflow.task.operators.airflow.providers.standard.decorators.python._PythonDecoratedOperator\"Custom Operator # Creating a custom Operator — Airflow 3.1.3 Documentationairflow.apache.org BaseOperator # BaseOperator 클래스를 상속받아 직접 만든 Operator를 사용 가능 BaseOperator 상속 시 두 가지 메서드를 재정의(Overriding)해야 함 def __int__(self, *args, **kwargs) 객체 생성 시 초기화하는 과정을 구현 (명시하지 않은 파라미터는 kwargs에 포함) def execute(self, context) Operator 실행 시 호출되는 메서드로 비즈니스 로직을 구현 template_fields: Sequence[str] = (\"name\",) Jinja template을 적용할 파라미터를 지정 Copy python class HelloOperator(BaseOperator): template_fields: Sequence[str] = (\"name\",) def __init__(self, name: str, world: str, **kwargs) -\u003e None: super().__init__(**kwargs) self.name = name self.world = world def execute(self, context): message = f\"Hello {self.world} it's {self.name}!\" print(message) return messageHttpOperator 개선점 파악 # 주요 문제점은 네이버 쇼핑 검색 API의 표시 결과가 최대 100개로 제한되는 것으로, 더 많은 결과를 보려면 파라미터의 start 값을 다르게 한 여러 개의 HttpOperator를 만들어야 함 execute() 메서드 안에서 전체 요청을 100개 단위로 나누고, 반복문을 통해 여러 번 요청 및 응답 결과를 합칠 수 있게 로직을 작성 기존엔 endpoint 를 전부 입력해야 했는데, API 종류를 구분할 수 있는 문자열만 전달해서 endpoint 를 자동으로 만들어주면 더 편리할 것이라 생각함 endpoint 변경이 용이하기 때문에 쇼핑 검색 뿐 아니라 블로그 검색도 같이 수행할 것을 고려 기존엔 JSON 파싱한 결과를 그대로 반환했는데, 로컬 경로에 CSV 파일로 저장하면 결과를 확인하기 더 쉬울 것이라 생각함 Operator 기능 정의 # 네이버 쇼핑 및 블로그 검색 API를 호출하여 전체 데이터를 받은 후 CSV 파일로 저장하기\nNaverSearchToCsvOperator # BaseOperator 를 상속받는 NaverSearchToCsvOperator 를 구현 Operator 재사용을 위해 plugins/ 경로 아래에 추가 Copy python # plugins/operators/nshopping.py from airflow.models import BaseOperator from airflow.hooks.base import BaseHook from typing import Dict, List class NaverSearchToCsvOperator(BaseOperator): template_fields = (\"file_path\", \"client_id\", \"client_secret\") def __init__(self, search_type: str, file_path: str, client_id: str, client_secret: str, keyword: str, display: int = 10, start: int = 1, sort = \"sim\", **kwargs): super().__init__(**kwargs) self.http_conn_id = \"openapi.naver.com\" self.endpoint = f\"/v1/search/{search_type}.json\" self.method = \"GET\" self.file_path = file_path if file_path.startswith(\"/\") else (\"/opt/airflow/files/\"+file_path) self.client_id = client_id self.client_secret = client_secret self.keyword = keyword self.display = min(display, 1000) self.start = min(start, 1000) self.sort = sort def execute(self, context): connection = BaseHook.get_connection(self.http_conn_id) url = connection.host + self.endpoint rows = list() for i, start in enumerate(range(self.start, self.display, 100)): display = min(self.display + self.start - start, 100) self.log.info(f\"시작: {start}\") self.log.info(f\"끝: {start+display-1}\") kwargs = dict(keyword=self.keyword, display=display, start=start, sort=self.sort) rows = rows + self._request_api(url, show_header=(i == 0), **kwargs) self._mkdir(self.file_path) self._to_csv(rows, self.file_path, encoding=\"utf-8\", sep=',') def _request_api(self, url: str, keyword: str, display: int=10, start: int=1, sort=\"sim\", show_header=True) -\u003e List[List]: import requests params = self._get_params(keyword, display, start, sort) headers = self._get_headers(self.client_id, self.client_secret) with requests.request(self.method, url, params=params, headers=headers) as response: return self._parse_api(response, start, show_header) def _get_params(self, keyword: str, display: int=10, start: int=1, sort=\"sim\") -\u003e Dict: return {\"query\": keyword, \"display\": min(display, 100), \"start\": min(start, 1000), \"sort\": sort} def _get_headers(self, client_id: str, client_secret: str) -\u003e Dict[str,str]: return { \"Content-Type\": \"application/json\", \"X-Naver-Client-Id\": client_id, \"X-Naver-Client-Secret\": client_secret } def _parse_api(self, response, start: int=1, show_header=True) -\u003e List[List]: contents = response.json()[\"items\"] if contents: header = ([[\"rank\"] + list(contents[0].keys())]) if show_header else [] return header + [[start+i]+list(content.values()) for i, content in enumerate(contents)] else: return list() def _mkdir(self, file_path: str): import os dir_path = os.path.split(file_path)[0] if not os.path.exists(dir_path): os.system(f\"mkdir -p {dir_path}\") def _to_csv(self, rows: List[List], file_path: str, encoding=\"utf-8\", sep=','): def clean(value: str) -\u003e str: return str(value).replace(sep, '') with open(file_path, 'w', encoding=encoding) as file: for row in rows: file.write(sep.join(map(clean, row))+'\\n')초기화 파라미터 #search_type: str\n네이버 쇼핑 검색 API의 endpoint 는 /v1/search/shop.json 인데, 블로그 검색 또는 뉴스 검색과 같은 다른 API를 확인했을 때, URL에서 {{host}}/v1/search/{{search_type}}.json 와 같은 패턴이 있음을 확인 가능 따라서, endpoint 대신에 search_type 을 입력으로 받고 endpoint 를 자동으로 생성 file_path: str\nnaverSearch/ 경로 아래 실행 날짜별로 폴더를 만들어서 아래에 CSV 파일을 저장할 계획인데, data_interval_end 변수를 사용하기 위해 template_fields 에 해당 파라미터를 등록 Root(/) 경로를 지정하지 않았을 경우 /opt/airflow/files 경로를 Root 경로로 사용하도록 지정 이 때, Airflow 웹서버 컨테이너에 파일을 저장해도 로컬 컴퓨터에서 확인할 수 없기 때문에 docker-compose.yaml 파일에 컨테이너와 로컬 컴퓨터 경로를 연결짓는 구문을 입력 Copy yaml # docker-compose.yaml x-airflow-common: volumes: - ${AIRFLOW_PROJ_DIR:-.}/files:/opt/airflow/files client_id: str, client_secret: str\n두 개의 API 계정 정보 또한 Variable에서 값을 꺼내오기 때문에 template_fields 에 등록 요청 헤더에 게정 정보를 추가하기 위해 사용 keyword: str, display: int, start: int, sort: str\nAPI 요청 파라미터를 구성하는 대표적인 키값을 입력 받음 display 는 최대 100까지 허용되지만, 반복문을 통해 나눠서 요청할 수 있기 때문에 1000까지 확장 start 는 API 문서에 명세된 것과 같이 최대 1000까지의 값으로 제한 sort 는 API 종류에 따라 허용되는 값이 다르지만, 공통적으로 정확도순 정렬(sim)을 사용할 것이기에 별도로 검증하지 않음 Copy python template_fields = (\"file_path\", \"client_id\", \"client_secret\") def __init__(self, search_type: str, file_path: str, client_id: str, client_secret: str, keyword: str, display: int = 10, start: int = 1, sort = \"sim\", **kwargs): super().__init__(**kwargs) self.http_conn_id = \"openapi.naver.com\" self.endpoint = f\"/v1/search/{search_type}.json\" self.method = \"GET\" self.file_path = file_path if file_path.startswith(\"/\") else (\"/opt/airflow/files/\"+file_path) self.client_id = client_id self.client_secret = client_secret self.keyword = keyword self.display = min(display, 1000) self.start = min(start, 1000) self.sort = sortAPI 요청 메서드 #execute()\n고정된 Connection ID를 가지고 Connection에 등록된 Host를 조회 Host와 endpoint 를 조합하여 API 요청 URL을 생성 start 부터 display 까지의 범위를 100개 단위로 구분하여 반복문을 구성하고, 반복문마다 파라미터를 다르게 하여 API 요청 메서드 _request_api() 에 전달 Copy python def execute(self, context): connection = BaseHook.get_connection(self.http_conn_id) url = connection.host + self.endpoint rows = list() for i, start in enumerate(range(self.start, self.display, 100)): display = min(self.display + self.start - start, 100) self.log.info(f\"시작: {start}\") self.log.info(f\"끝: {start+display-1}\") kwargs = dict(keyword=self.keyword, display=display, start=start, sort=self.sort) rows = rows + self._request_api(url, show_header=(i == 0), **kwargs) ..._request_api()\n직접적으로 API에 요청을 보내는 메서드 다른 메서드를 통해 파라미터와 헤더를 만들고, 전달받은 URL에 대해 GET 요청을 보냄 응답 결과인 requests.Response 객체를 그대로 파싱 메서드 _parse_api() 로 전달 Copy python def _request_api(self, url: str, keyword: str, display: int=10, start: int=1, sort=\"sim\", show_header=True) -\u003e List[List]: import requests params = self._get_params(keyword, display, start, sort) headers = self._get_headers(self.client_id, self.client_secret) with requests.request(self.method, url, params=params, headers=headers) as response: return self._parse_api(response, start, show_header)_get_params()\n전달받은 파라미터를 딕셔너리 객체로 맵핑하여 반환하는 메서드 Copy python def _get_params(self, keyword: str, display: int=10, start: int=1, sort=\"sim\") -\u003e Dict: return {\"query\": keyword, \"display\": min(display, 100), \"start\": min(start, 1000), \"sort\": sort}_get_headers()\nAPI 계정 정보를 추가한 요청 헤더를 딕셔너리 객체로 반환하는 메서드 Copy python def _get_headers(self, client_id: str, client_secret: str) -\u003e Dict[str,str]: return { \"Content-Type\": \"application/json\", \"X-Naver-Client-Id\": client_id, \"X-Naver-Client-Secret\": client_secret }API 응답 결과 파싱 메서드 #execute()\n반복문 밖에서 리스트 객체 rows 를 만들고, 반복문마다 _request_api() 메서드가 반환하는 각각의 리스트 객체를 하나로 결합 첫 번째 반복문에서만 CSV의 헤더를 표시하기 위해 show_header 파라미터를 활용 Copy python def execute(self, context): ... rows = list() for start in range(self.start, self.display, 100): ... rows = rows + self._request_api(url, show_header=(i == 0), **kwargs) ..._parse_api()\nrequests.Response 객체를 인수로 전달받아 JSON 파싱한 후 items 키에서 배열을 꺼냄 CSV 파일로 저장하기 편한 구조로 가공하기 위해 딕셔너리에서 값만 꺼내 배열로 구성 execute() 에서 전달한 show_header 파라미터를 통해 첫 번째 반복문에서만 CSV 헤더를 추가해 반환 pd.DataFrame 을 활용할 수도 있지만, 단순하게 배열 타입으로 파싱 Copy python def _parse_api(self, response, start: int=1, show_header=True) -\u003e List[List]: contents = response.json()[\"items\"] if contents: header = ([[\"rank\"] + list(contents[0].keys())]) if show_header else [] return header + [[start+i]+list(content.values()) for i, content in enumerate(contents)] else: return list()CSV 파일 저장 메서드 #execute()\nCSV 파일을 저장하기 전에 _mkdir() 메서드를 통해 file_path 검증 API 응답 결과를 가진 rows 객체를 _to_csv() 메서드에 전달해 CSV 파일로 저장 Copy python def execute(self, context): ... self._mkdir(self.file_path) self._to_csv(rows, self.file_path, encoding=\"utf-8\", sep=',')_mkdir()\nfile_path 가 있는지 확인하고, 없으면 해당 경로를 생성하는 메서드 Copy python def _mkdir(self, file_path: str): import os dir_path = os.path.split(file_path)[0] if not os.path.exists(dir_path): os.system(f\"mkdir -p {dir_path}\")_to_csv()\nfile_path 를 열고, 전달받은 rows 객체를 한 줄씩 기록하는 메서드 구분자 , 가 있을 경우 쌍따옴표 \" \" 로 감싸는 것과 같은 조치가 필요하지만, 내용이 중요한건 아니기 때문에 단순히 값에서 구분자 , 를 모두 제거하는 방식으로 가공하여 저장 Copy python def _to_csv(self, rows: List[List], file_path: str, encoding=\"utf-8\", sep=','): def clean(value: str) -\u003e str: return str(value).replace(sep, '') with open(file_path, 'w', encoding=encoding) as file: for row in rows: file.write(sep.join(map(clean, row))+'\\n')Custom Operator 활용 예시 #DAG 생성 및 실행 # plugins/ 에 정의한 NaverSearchToCsvOperator 를 가져와서 두 개의 Task를 생성 하나는 네이버 쇼핑 검색 API를 사용하는 search_shopping_task, 다른 하나는 네이버 블로그 검색 API를 사용하는 search_blog_task HttpOperator 를 사용했으면 길어졌을 내용을 NaverSearchToCsvOperator 로 구조화하여 DAG 선언을 단순화 Copy python # dags/nsearch_operator.py from airflow.sdk import DAG from operators.nshopping import NaverSearchToCsvOperator import pendulum with DAG( dag_id=\"nsearch_operator\", schedule=\"0 9 * * *\", start_date=pendulum.datetime(2025, 1, 1, tz=\"Asia/Seoul\"), catchup=False, tags=[\"example\", \"http\"], ) as dag: api_keys = dict( client_id=\"{{var.value.client_id_openapi_naver_com}}\", client_secret=\"{{var.value.client_secret_openapi_naver_com}}\") common_params = dict(keyword=\"노트북\", display=1000, start=1, sort=\"sim\") \"\"\"네이버 쇼핑 검색\"\"\" search_shopping_task = NaverSearchToCsvOperator( task_id=\"search_shopping_task\", search_type=\"shop\", file_path=\"naverSearch/{{data_interval_end.in_timezone(\\\"Asia/Seoul\\\") | ds_nodash }}/shop.csv\", **api_keys, **common_params ) \"\"\"네이버 블로그 검색\"\"\" search_blog_task = NaverSearchToCsvOperator( task_id=\"search_blog_task\", search_type=\"blog\", file_path=\"naverSearch/{{data_interval_end.in_timezone(\\\"Asia/Seoul\\\") | ds_nodash }}/blog.csv\", **api_keys, **common_params ) search_shopping_task \u003e\u003e search_blog_task start 1부터 display 1000까지 총 1000개의 검색 결과를 100개 단위로 나눠서 요청하는 과정을 로그로 남겨서 조회 Copy bash [2025-06-07, 19:44:00] INFO - DAG bundles loaded: dags-folder: source=\"airflow.dag_processing.bundles.manager.DagBundlesManager\" [2025-06-07, 19:44:00] INFO - Filling up the DagBag from /opt/airflow/dags/nsearch_operator.py: source=\"airflow.models.dagbag.DagBag\" [2025-06-07, 19:44:00] INFO - Secrets backends loaded for worker: count=1: backend_classes=[\"EnvironmentVariablesBackend\"]: source=\"supervisor\" [2025-06-07, 19:44:00] INFO - Secrets backends loaded for worker: count=1: backend_classes=[\"EnvironmentVariablesBackend\"]: source=\"supervisor\" [2025-06-07, 19:44:00] INFO - Secrets backends loaded for worker: count=1: backend_classes=[\"EnvironmentVariablesBackend\"]: source=\"supervisor\" [2025-06-07, 19:44:00] INFO - Connection Retrieved 'openapi.naver.com': source=\"airflow.hooks.base\" [2025-06-07, 19:44:00] INFO - 시작: 1: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:00] INFO - 끝: 100: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:00] INFO - 시작: 101: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:00] INFO - 끝: 200: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:01] INFO - 시작: 201: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:01] INFO - 끝: 300: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:01] INFO - 시작: 301: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:01] INFO - 끝: 400: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:01] INFO - 시작: 401: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:01] INFO - 끝: 500: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:02] INFO - 시작: 501: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:02] INFO - 끝: 600: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:02] INFO - 시작: 601: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:02] INFO - 끝: 700: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:02] INFO - 시작: 701: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:02] INFO - 끝: 800: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:02] INFO - 시작: 801: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:02] INFO - 끝: 900: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:03] INFO - 시작: 901: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\" [2025-06-07, 19:44:03] INFO - 끝: 1000: source=\"airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator\"CSV 파일 확인 # 모든 Task가 success 로 처리된 후, 로컬 컴퓨터의 files/ 경로에 두 개의 CSV 파일이 생성됨을 확인 Copy bash % tree files -F files/ └── naverSearch/ └── 20250607/ ├── blog.csv └── shop.csvshop.csv # shop.csv ranktitlelinkimagelpricehpricemallNameproductIdproductTypebrandmakercategory1category2category3category4 1삼성 갤럭시북...https://...https://...428000삼성공식파트너 코인비엠에스879523892532갤럭시북삼성전자디지털/가전노트북2삼성전자 갤럭시북4...https://...https://...799000네이버526312366421갤럭시북4삼성전자디지털/가전노트북3LG전자 울트라PC...https://...https://...599000제이 씨앤에스837187364882LG전자LG전자디지털/가전노트북4삼성전자 갤럭시북4...https://...https://...728000네이버526477942781갤럭시북4삼성전자디지털/가전노트북5LG그램 노트북...https://...https://...1149000온라인총판대리점866360050312LG그램LG전자디지털/가전노트북 blog.csv # blog.csv ranktitlelinkdescriptionbloggernamebloggerlinkpostdate 1노트북에서...https://...버리고 노트북으로...란디의 하늘색 꿈blog.naver.com/fksel33202506012고비넘긴 삼성노트북...https://...노원구 공릉동에 위치한...하드웨어수리닷컴(엘존)blog.naver.com/yzenn202506033MSI 사무용노트북...https://...MSI노트북중에서...Modulestudioblog.naver.com/modulestudio202506024아직 이걸 안 써?...https://...아직 이걸 안 써?...짜루의 이것저것 리뷰blog.naver.com/skdaksdptn202505205가성비 초경량 노트북...https://...그런 노트북을...삼성Mall 한사랑씨앤씨 공식 블로그blog.naver.com/hansarangcnc20250527 ","wordCount":"2378","inLanguage":"ko","image":"https:\/\/dl.dropboxusercontent.com\/scl\/fi\/8oxi6rw0kesl9l3egs78s\/airflow-00-cover.webp?rlkey=6abx67jiweasmlwehj4o4gdle\u0026raw=1","datePublished":"2025-06-07T12:50:14+09:00","dateModified":"2025-06-07T12:50:14+09:00","author":{"@type":"Person","name":"minyeamer"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://minyeamer.github.io/blog/airflow-study-6/"},"publisher":{"@type":"Person","name":"Minystory","logo":{"@type":"ImageObject","url":"https://minyeamer.github.io/images/favicons/favicon.ico"}}}</script><script>(function(){const e=256+768*1.3;window.innerWidth>e&&localStorage.getItem("menu-expanded")==="false"&&document.documentElement.classList.add("menu-initial-collapsed")})()</script><title>Apache Airflow - REST API 연동과 Custom Operator 구현</title><link rel=icon href=/images/favicon.ico><link rel=manifest href=/data/manifest.json><link rel=canonical href=https://minyeamer.github.io/blog/airflow-study-6/><link rel=stylesheet href=/main.min.1f7c5f920f4425b60fca8d9aacdbea68a37a89f29e14068052e04434f4625b19.css integrity="sha256-H3xfkg9EJbYPyo2arNvqaKN6ifKeFAaAUuBENPRiWxk=" crossorigin=anonymous><script async src="https://www.googletagmanager.com/gtag/js?id=G-BJ8Z9RMBPJ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BJ8Z9RMBPJ")</script><script defer src=/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js integrity="sha256-b2+Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC+NdcPIvZhzk=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css crossorigin=anonymous><script>(function(){const e=console.warn;console.warn=function(...n){const t=(new Error).stack||"";if(t.includes("highlight.min.js")||t.includes("highlightjs-line-numbers"))return;e.apply(console,n)}})()</script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.9.0/highlightjs-line-numbers.min.js crossorigin=anonymous></script><script defer src=/js/scroll-progress.min.841ade7e507a5f6d59c4e7bf2fe2b2ca034070677ff7957eec55610a024dd776.js integrity="sha256-hBreflB6X21ZxOe/L+KyygNAcGd/95V+7FVhCgJN13Y=" crossorigin=anonymous></script><script defer src=/js/menu-toggle.min.dd99cf31bd583912ea1bbd2c953c8c6b53d89da9846e8f05c9189de9369c97c9.js integrity="sha256-3ZnPMb1YORLqG70slTyMa1PYnamEbo8FyRid6Tacl8k=" crossorigin=anonymous></script><script defer src=/js/toc-toggle.min.48870f47596275987bbd50f04ba301b2b9469da2b3ed9d94e569774691851717.js integrity="sha256-SIcPR1lidZh7vVDwS6MBsrlGnaKz7Z2U5Wl3RpGFFxc=" crossorigin=anonymous></script><script defer src=/js/set-theme.min.986446861d7c48b101b4a6f53724b7fc97d6efec2a87906c6630cb9e503897c4.js integrity="sha256-mGRGhh18SLEBtKb1NyS3/JfW7+wqh5BsZjDLnlA4l8Q=" crossorigin=anonymous></script><script defer src=/js/copy-code.min.e18ffc44cf6beb1757c467945bb2897b0e1cb2ee52f08b460ee3ee57f0db6d60.js integrity="sha256-4Y/8RM9r6xdXxGeUW7KJew4csu5S8ItGDuPuV/DbbWA=" crossorigin=anonymous></script><script defer src=/js/toc-highlight.min.7917ead4ecb7378779bfbf3f988251ac76bd55ca7f12fd5919870777dbcd6095.js integrity="sha256-eRfq1Oy3N4d5v78/mIJRrHa9Vcp/Ev1ZGYcHd9vNYJU=" crossorigin=anonymous></script><script defer src=/js/reading-time.min.c8cf75fb9d8569d73b13b6a2bf6f52c235ff03ad7848e0386ccce2d7dcb8d9be.js integrity="sha256-yM91+52Fadc7E7aiv29SwjX/A614SOA4bMzi19y42b4=" crossorigin=anonymous></script><script defer src=/js/image-zoom.min.73ef1954212429af5df3e0386860f8f9b32748998c0ed1eb62ed800e348a2fab.js integrity="sha256-c+8ZVCEkKa9d8+A4aGD4+bMnSJmMDtHrYu2ADjSKL6s=" crossorigin=anonymous></script><script defer src=/js/data-table.min.fa6db79ffc740d269f74059cc2e802ba7528441b1a4c0d39f9f825f81dbfc344.js integrity="sha256-+m23n/x0DSafdAWcwugCunUoRBsaTA05+fgl+B2/w0Q=" crossorigin=anonymous></script><script>window.siteSearch=window.siteSearch||{}</script><script>window.siteSearch.contentUrl="/data/content.min.cb6ba0a02d6b756b479e75c9b6465c0ef470c0df2952c4722d68402bd23dcca4.json"</script><script>window.siteSearch.categoriesUrl="/data/categories.min.249a3bfbb1ae8ee6e09c08bd2449462f8e161c8a98748da0169c2abe6f79598e.json"</script><script>window.siteSearch.tagsUrl="/data/tags.min.11b7d30fcd3cbb5269823c54a83c4889d580a62df2d1988344ddf158197da767.json"</script><script defer src=/fuse.min.js></script><script defer src=/js/search/init.min.3ec02e8ced439eef10e68b1663c5dab0c0ec89f63a79e154e33b0d62221bdbdb.js integrity="sha256-PsAujO1Dnu8Q5osWY8XasMDsifY6eeFU4zsNYiIb29s=" crossorigin=anonymous></script><script defer src=/js/search/input.min.27eda7796db42efef8727211d407e1e656de277ab39ea388861f5c738641668c.js integrity="sha256-J+2neW20Lv74cnIR1Afh5lbeJ3qznqOIhh9cc4ZBZow=" crossorigin=anonymous></script><script defer src=/js/search/list.min.65c865585bcec3cd299a342aed710907648722cc5cea50ba08b5495a08033d42.js integrity="sha256-ZchlWFvOw80pmjQq7XEJB2SHIsxc6lC6CLVJWggDPUI=" crossorigin=anonymous></script></head><body dir=ltr class="site-kind-page site-type-posts site-layout-post"><div class=scroll-progress><div class=scroll-progress-bar></div></div><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><div class=menu-overlay></div><main class=container><aside class=site-menu aria-label=메뉴><div class=menu-content><nav><div class=menu-profile><div class=profile-image-wrap><a href=https://minyeamer.github.io/><img src=/images/profile/menu.jpg alt=Profile class=profile-image decoding=async></a></div><h2 class=profile-title><a class="flex align-center" href=https://minyeamer.github.io/><span>Minystory</span></a></h2></div><div class=menu-links><a href=https://github.com/minyeamer target=_blank id=github-link title=GitHub><i class="fa-brands fa-github"></i>
</a><a href=/categories/ id=categories-link title=Categories><i class="fa-solid fa-folder"></i>
</a><a href=/tags/ id=tags-link title=Tags><i class="fa-solid fa-tags"></i>
</a><button class=dark-mode-toggle id=theme-toggle-button aria-label="Toggle color scheme">
<i class="fa-solid fa-circle-half-stroke"></i></button></div><div class=menu-search id=search-input data-hotkeys=s/ role=button tabindex=0 aria-label=검색><i class="fa-solid fa-magnifying-glass search-icon"></i>
<span class=search-placeholder><code>/</code> 를 눌러 검색하세요</span></div><div class=menu-categories><input type=checkbox class="hidden toggle" id=categories-control checked>
<label for=categories-control class="categories-label categories-toggle"><a href=/categories/ class=categories-root><i class="fa-solid fa-folder"></i>
전체
<span class=category-count>(40)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li><input type=checkbox class="hidden toggle" id=cat-algorithm>
<label for=cat-algorithm class="categories-label categories-toggle"><a href="/search/?category1=Algorithm"><i class="fa-solid fa-folder"></i>Algorithm<span class=category-count>(4)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-label><a href="/search/?category1=Algorithm&category2=Graph"><i class="fa-solid fa-file"></i>Graph<span class=category-count>(1)</span></a></li><li class=categories-label><a href="/search/?category1=Algorithm&category2=Python"><i class="fa-solid fa-file"></i>Python<span class=category-count>(2)</span></a></li><li class=categories-label><a href="/search/?category1=Algorithm&category2=SQL"><i class="fa-solid fa-file"></i>SQL<span class=category-count>(1)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-cloud>
<label for=cat-cloud class="categories-label categories-toggle"><a href="/search/?category1=Cloud"><i class="fa-solid fa-folder"></i>Cloud<span class=category-count>(2)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-label><a href="/search/?category1=Cloud&category2=Kubernetes"><i class="fa-solid fa-file"></i>Kubernetes<span class=category-count>(2)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-data-analysis>
<label for=cat-data-analysis class="categories-label categories-toggle"><a href="/search/?category1=Data%20Analysis"><i class="fa-solid fa-folder"></i>Data Analysis<span class=category-count>(3)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-label><a href="/search/?category1=Data%20Analysis&category2=Dacon"><i class="fa-solid fa-file"></i>Dacon<span class=category-count>(3)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-data-engineering>
<label for=cat-data-engineering class="categories-label categories-toggle"><a href="/search/?category1=Data%20Engineering"><i class="fa-solid fa-folder"></i>Data Engineering<span class=category-count>(19)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-label><a href="/search/?category1=Data%20Engineering&category2=Apache%20Airflow"><i class="fa-solid fa-file"></i>Apache Airflow<span class=category-count>(7)</span></a></li><li class=categories-label><a href="/search/?category1=Data%20Engineering&category2=Apache%20Spark"><i class="fa-solid fa-file"></i>Apache Spark<span class=category-count>(8)</span></a></li><li class=categories-label><a href="/search/?category1=Data%20Engineering&category2=Crawling"><i class="fa-solid fa-file"></i>Crawling<span class=category-count>(4)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-frontend>
<label for=cat-frontend class="categories-label categories-toggle"><a href="/search/?category1=Frontend"><i class="fa-solid fa-folder"></i>Frontend<span class=category-count>(9)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-label><a href="/search/?category1=Frontend&category2=Blog"><i class="fa-solid fa-file"></i>Blog<span class=category-count>(9)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-linux>
<label for=cat-linux class="categories-label categories-toggle"><a href="/search/?category1=Linux"><i class="fa-solid fa-folder"></i>Linux<span class=category-count>(1)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-label><a href="/search/?category1=Linux&category2=Ubuntu"><i class="fa-solid fa-file"></i>Ubuntu<span class=category-count>(1)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-project>
<label for=cat-project class="categories-label categories-toggle"><a href="/search/?category1=Project"><i class="fa-solid fa-folder"></i>Project<span class=category-count>(2)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-label><a href="/search/?category1=Project&category2=Open%20Source"><i class="fa-solid fa-file"></i>Open Source<span class=category-count>(1)</span></a></li><li class=categories-label><a href="/search/?category1=Project&category2=Tools"><i class="fa-solid fa-file"></i>Tools<span class=category-count>(1)</span></a></li></ul></li></ul></div><div class=recent-posts><div class=recent-post-label><i class="fa-solid fa-clock"></i>
<span>최신글</span></div><ul class=recent-post-list><li class=recent-post-item><a href=/blog/hugo-blog-5/ title="Hugo Disqus 댓글 연동 - 본문 레이아웃 개선하기 (헤더/푸터)"><div class=recent-post-title>Hugo Disqus 댓글 연동 - 본문 레이아웃 개선하기 (헤더/푸터)</div><div class=recent-post-date><time datetime=2025-12-15>2025.12.15</time></div></a></li><li class=recent-post-item><a href=/blog/hugo-blog-4/ title="Hugo 검색 기능 구현 - Fuse.js로 검색 인덱스 최적화하기"><div class=recent-post-title>Hugo 검색 기능 구현 - Fuse.js로 검색 인덱스 최적화하기</div><div class=recent-post-date><time datetime=2025-12-14>2025.12.14</time></div></a></li><li class=recent-post-item><a href=/blog/hugo-blog-3/ title="Hugo Taxonomies 커스터마이징 - 태그/카테고리 템플릿 구현"><div class=recent-post-title>Hugo Taxonomies 커스터마이징 - 태그/카테고리 템플릿 구현</div><div class=recent-post-date><time datetime=2025-11-22>2025.11.22</time></div></a></li><li class=recent-post-item><a href=/blog/hugo-blog-2/ title="Hugo Book 테마 커스터마이징 - 메뉴/목차/헤더 레이아웃 개선"><div class=recent-post-title>Hugo Book 테마 커스터마이징 - 메뉴/목차/헤더 레이아웃 개선</div><div class=recent-post-date><time datetime=2025-11-04>2025.11.04</time></div></a></li><li class=recent-post-item><a href=/blog/hugo-blog-1/ title="Hugo 블로그 만들기 - Git Submodule로 구성하고 배포하기"><div class=recent-post-title>Hugo 블로그 만들기 - Git Submodule로 구성하고 배포하기</div><div class=recent-post-date><time datetime=2025-11-01>2025.11.01</time></div></a></li></ul></div></nav><script>(function(){var e=document.querySelector("aside .menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=main-wrap><header class=site-header><div class="flex align-center justify-between"><label for=menu-control aria-label="메뉴 접기/펼치기" title="메뉴 접기/펼치기"><i class="fa-solid fa-bars menu-icon" id=menu-icon></i></label><div class=mobile-search id=mobile-search-input role=button tabindex=0 aria-label=검색><i class="fa-solid fa-magnifying-glass search-icon"></i>
<span class=mobile-title>Minystory</span>
<i class=mobile-title-pad></i></div><label for=toc-control aria-label="목차 접기/펼치기" title="목차 접기/펼치기"><i class="fa-solid fa-list menu-icon" id=toc-icon></i></label></div></header><article class="content-wrap markdown" id=content-wrap><header class=content-header><div class=content-category><a href="/search/?category1=Data%20Engineering&category2=Apache%20Airflow" class=content-category-link>Data Engineering/Apache Airflow</a></div><h1 class=content-title>Apache Airflow - REST API 연동과 Custom Operator 구현</h1><div class=content-datetime><time datetime=2025-06-07T12:50:14+09:00>2025. 6. 7. 12:50
</time><span id=reading-time></span></div></header><div class=content-cover-wrap><img src="https://dl.dropboxusercontent.com/scl/fi/8oxi6rw0kesl9l3egs78s/airflow-00-cover.webp?rlkey=6abx67jiweasmlwehj4o4gdle&amp;raw=1" class=content-cover alt="Cover Image" decoding=async></div><div id=series-anchor></div><div class=sc-series><div class=series-bookmark><svg width="32" height="48" fill="currentColor" viewBox="0 0 32 48" class="series-corner-image"><path fill="currentColor" d="M32 0H0v48h.163l16-16L32 47.836V0z"/></svg></div><div class=series-header><h2 class=series-title>Apache Airflow 배우기</h2></div><input type=checkbox id=series-toggle class=series-toggle-input hidden><div class=series-content><ol class=series-list><li class=series-item><span class=series-item-index>1.</span>
<a href=/blog/airflow-study-1/#series-anchor>설치하기 (Docker Compose)</a></li><li class=series-item><span class=series-item-index>2.</span>
<a href=/blog/airflow-study-2/#series-anchor>기본 Operator 이해하기 (Bash, Python)</a></li><li class=series-item><span class=series-item-index>3.</span>
<a href=/blog/airflow-study-3/#series-anchor>데이터 전달과 템플릿 활용 (Jinja, XCom, Variable)</a></li><li class=series-item><span class=series-item-index>4.</span>
<a href=/blog/airflow-study-4/#series-anchor>조건부 실행과 알림 (Branch, Email Operator)</a></li><li class=series-item><span class=series-item-index>5.</span>
<a href=/blog/airflow-study-5/#series-anchor>DAG 흐름 제어 (Trigger Rule, TriggerDagRun, TaskGroup)</a></li><li class="series-item active"><span class=series-item-index>6.</span>
<a href=/blog/airflow-study-6/#series-anchor>REST API 연동과 Custom Operator 구현</a></li><li class=series-item><span class=series-item-index>7.</span>
<a href=/blog/airflow-study-7/#series-anchor>외부 시스템 연동 (Connection, Hook, PostgreSQL)</a></li></ol></div><div class=series-footer><label for=series-toggle class=series-toggle-label><span class=series-toggle-icon><i class="fas fa-caret-up"></i></span>
<span class=series-toggle-text-hide>숨기기</span>
<span class=series-toggle-text-show>목록 보기</span></label><div class=series-nav><span class=series-nav-info>6/7</span><div class=series-nav-buttons><a href=/blog/airflow-study-5/#series-anchor class=series-nav-button><i class="fas fa-chevron-left"></i></a>
<a href=/blog/airflow-study-7/#series-anchor class=series-nav-button><i class="fas fa-chevron-right"></i></a></div></div></div></div><script>(function(){const e=document.getElementById("series-toggle"),t="series-expanded",n=localStorage.getItem(t)??"true";n==="true"&&(e.checked=!0),e.addEventListener("change",function(){localStorage.setItem(t,this.checked)})})()</script><h2 id=httpoperator>HttpOperator
<a class=anchor href=#httpoperator>#</a></h2><a href=https://airflow.apache.org/docs/apache-airflow-providers-http/stable/index.html target=_blank class=sc-bookmark-card><div class=sc-bookmark-image><img src="https://dl.dropboxusercontent.com/scl/fi/jaltieh1sb4r7ozm6ju3e/airflow-00-cover-bg.webp?rlkey=s10wwm9o11zy79dwm1vje30sb&amp;raw=1" alt="apache-airflow-providers-http — apache-airflow-providers-http Documentation" loading=lazy decoding=async></div><div class=sc-bookmark-content><h3 class=sc-bookmark-title>apache-airflow-providers-http — apache-airflow-providers-http Documentation</h3><small class=sc-bookmark-url>airflow.apache.org</small></div></a><ul><li>HTTP 요청을 하고 응답 결과를 반환받는 Operator (반환값은 XCom에 저장)</li><li>HTTP를 이용하여 API를 처리하는 RestAPI 호출 시 사용 가능</li></ul><h3 id=provider-패키지-설치>Provider 패키지 설치
<a class=anchor href=#provider-%ed%8c%a8%ed%82%a4%ec%a7%80-%ec%84%a4%ec%b9%98>#</a></h3><ul><li><code>HttpOperator</code> 는 Provider 패키지로 별도의 설치가 필요</li><li>5.3.0 버전을 기준으로 <code>apache-airflow>=2.10.0</code> 버전을 요구</li></ul><div class=sc-codeblock data-lang=bash><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip install apache-airflow-providers-http</span></span></code></pre></div></div><h3 id=httpoperator-파라미터>HttpOperator 파라미터
<a class=anchor href=#httpoperator-%ed%8c%8c%eb%9d%bc%eb%af%b8%ed%84%b0>#</a></h3><a href=https://airflow.apache.org/docs/apache-airflow-providers-http/stable/_api/airflow/providers/http/operators/http/index.html target=_blank class=sc-bookmark-card><div class=sc-bookmark-image><img src="https://dl.dropboxusercontent.com/scl/fi/jaltieh1sb4r7ozm6ju3e/airflow-00-cover-bg.webp?rlkey=s10wwm9o11zy79dwm1vje30sb&amp;raw=1" alt="airflow.providers.http.operators.http — apache-airflow-providers-http Documentation" loading=lazy decoding=async></div><div class=sc-bookmark-content><h3 class=sc-bookmark-title>airflow.providers.http.operators.http — apache-airflow-providers-http …</h3><small class=sc-bookmark-url>airflow.apache.org</small></div></a><ul><li><code>http_conn_id</code> : http Connection을 생성해야 하는데 해당 Connection의 ID</li><li><code>endpoint</code> : Connection에 등록한 Host 뒤에 붙는 경로</li><li><code>method</code> : HTTP 메서드 (GET, POST, PUT, DELETE 등)</li><li><code>data</code> : POST 요청 시 전달할 데이터 또는 GET 요청 시 전달할 파라미터</li><li><code>headers</code> : HTTP 요청 헤더</li><li><code>response_check</code> : HTTP 응답 결과가 정상인지 확인하는 함수 (<code>True</code> 반환)</li><li><code>response_filter</code> : HTTP 응답 결과에 대한 전처리 함수</li></ul><h2 id=네이버-쇼핑-검색-api>네이버 쇼핑 검색 API
<a class=anchor href=#%eb%84%a4%ec%9d%b4%eb%b2%84-%ec%87%bc%ed%95%91-%ea%b2%80%ec%83%89-api>#</a></h2><a href=https://developers.naver.com/docs/serviceapi/search/shopping/shopping.md target=_blank class=sc-bookmark-card><div class=sc-bookmark-image><img src="https://dl.dropboxusercontent.com/scl/fi/x4x2s1wylgkwatfygk09z/naver-developers.webp?rlkey=z10lqzacm268bma2enhqbej0g&amp;raw=1" alt="검색 > 쇼핑 - Search API" loading=lazy decoding=async></div><div class=sc-bookmark-content><h3 class=sc-bookmark-title>검색 > 쇼핑 - Search API</h3><p class=sc-bookmark-description>검색 > 쇼핑 쇼핑 검색 개요 개요 사전 준비 사항 쇼핑 검색 API 레퍼런스 쇼핑 검색 결과 조회 오류 코드 검색 API 쇼핑 검색 구현 예제 쇼핑 검색 개요 개요 사전 준비 사항 개요 검색 API와 쇼핑 검색 개 …</p><small class=sc-bookmark-url>developers.naver.com</small></div></a><ul><li><code>HttpOperator</code> 활용을 위해 간단한 API를 예제로 사용</li><li>네이버 쇼핑 검색 API는 네이버에서 제공하는 Open API 중 하나로 네이버 쇼핑 페이지에서 검색한 결과를 XML 형식 또는 JSON 형식으로 반환하는 RestAPI</li><li>하나의 키워드를 전달하여 정확도순으로 1위에 노출되는 상품 정보를 출력하는 기능을 구현</li></ul><h3 id=api-키-생성>API 키 생성
<a class=anchor href=#api-%ed%82%a4-%ec%83%9d%ec%84%b1>#</a></h3><ul><li><a href=https://developers.naver.com/main/ target=_blank rel="noopener noreferrer">네이버 개발자 센터</a>에서 로그인 후 상단의 메뉴 중 <code>Application->애플리케이션 등록</code> 으로 이동</li><li>아래 이미지와 같이 사용 API로 "검색"을 선택하고, 임의로 애플리케이션 이름과 서비스 환경을 입력하여 애플리케이션 등록</li></ul><label class=sc-image for=sc-image-toggle-4 style=text-align:center><input class="hidden toggle" type=checkbox id=sc-image-toggle-4><img src="https://dl.dropboxusercontent.com/scl/fi/077ryedn6nmsmd7xnb1xy/airflow-42-naver-openapi-register.webp?rlkey=8e0iylgt9z8ze8snge38nbaky&amp;raw=1" alt="애플리케이션 등록 (API 이용신청)" loading=lazy decoding=async style=zgotmplz></label><ul><li>생성한 애플리케이션 정보에서 <code>Client ID</code> 와 <code>Client Secret</code> 을 조회 가능</li></ul><label class=sc-image for=sc-image-toggle-5 style=text-align:center><input class="hidden toggle" type=checkbox id=sc-image-toggle-5><img src="https://dl.dropboxusercontent.com/scl/fi/yxvxn3o30wvxip6cyy40b/airflow-43-naver-openapi-info.webp?rlkey=skjpbqiydx1e4if1octvkef4a&amp;raw=1" alt="애플리케이션 정보 - Client ID, Client Secret" loading=lazy decoding=async style=zgotmplz></label><h3 id=connection-추가>Connection 추가
<a class=anchor href=#connection-%ec%b6%94%ea%b0%80>#</a></h3><ul><li><a href=https://developers.naver.com/docs/serviceapi/search/shopping/shopping.md#%EC%9A%94%EC%B2%AD-url target=_blank rel="noopener noreferrer">문서에 명시된 요청 URL</a>을
참고하여 <code>Host</code> 를 입력</li><li>API가 별도로 알려지지 않은 포트를 사용할 경우 <code>Port</code> 에 포트 번호를 입력하지만, 네이버 Open API는 표준 HTTPS 포트를 사용하기 때문에 미표기</li></ul><label class=sc-image for=sc-image-toggle-6 style=text-align:center><input class="hidden toggle" type=checkbox id=sc-image-toggle-6><img src="https://dl.dropboxusercontent.com/scl/fi/yk6vu7a970ulpe7m1fog5/airflow-44-http-connection.webp?rlkey=5l6wya7grf6757xubjmcfid2w&amp;raw=1" alt="Edit Connection - HTTP" loading=lazy decoding=async style=zgotmplz></label><h3 id=variable-추가>Variable 추가
<a class=anchor href=#variable-%ec%b6%94%ea%b0%80>#</a></h3><ul><li>API키는 Variable로 추가하는데, <code>Client ID</code> 와 <code>Client Secret</code> 을 각각의 Variable로 등록</li><li><code>Client Secret</code> 의 키 명칭에는 "secret" 이 포함되어 UI에서 자동으로 마스킹 처리되는 것을 확인</li></ul><p><label class=md-image for=md-image-toggle-0><input class="hidden toggle" type=checkbox id=md-image-toggle-0>
<img src="https://dl.dropboxusercontent.com/scl/fi/t27j9mfzzmve67j5oflj1/airflow-45-naver-openapi-variables.webp?rlkey=3tj9lslxgqltobx9yuesp1xe1&amp;raw=1" alt="Variables - 애플리케이션 정보" loading=lazy decoding=async></label></p><h3 id=httpoperator-활용-예시>HttpOperator 활용 예시
<a class=anchor href=#httpoperator-%ed%99%9c%ec%9a%a9-%ec%98%88%ec%8b%9c>#</a></h3><ul><li>앞서 등록한 Connection의 ID를 <code>http_conn_id</code> 에 입력하고, <code>endpoint</code> 에 Host를 제외한 나머지 경로를 입력</li><li><code>data</code> 에는 GET 요청에 대한 파라미터를 전달하는데, <code>query</code> 로 원하는 키워드를 입력</li><li><code>headers</code> 에는 Jinja 템플릿을 활용하여 <code>Client ID</code> 와 <code>Client Secret</code> 에 대한 Variable 값을 추가</li><li>HTTPS 요청 후 반환되는 <code>Response</code> 객체를 JSON 파싱하여 <code>items</code> 배열 내 첫 번째 항목, 즉 "노트북" 키워드로 검색한 결과에서 1위로 노출되는 상품을 딕셔너리 타입으로 반환</li><li>다음 단계의 Task <code>print_product_task</code> 에서는 XCom에서 반환된 값을 꺼내 단순 출력</li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dags/http_operator.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.sdk</span> <span class=kn>import</span> <span class=n>DAG</span><span class=p>,</span> <span class=n>task</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.providers.http.operators.http</span> <span class=kn>import</span> <span class=n>HttpOperator</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.models.taskinstance</span> <span class=kn>import</span> <span class=n>TaskInstance</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pendulum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dag_id</span><span class=o>=</span><span class=s2>&#34;http_operator&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span><span class=o>=</span><span class=n>pendulum</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>6</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;example&#34;</span><span class=p>,</span> <span class=s2>&#34;http&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=n>response</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()[</span><span class=s2>&#34;items&#34;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>nshopping_search_task</span> <span class=o>=</span> <span class=n>HttpOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;nshopping_search_task&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>http_conn_id</span><span class=o>=</span><span class=s2>&#34;openapi.naver.com&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>endpoint</span><span class=o>=</span><span class=s2>&#34;/v1/search/shop.json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>method</span><span class=o>=</span><span class=s2>&#34;GET&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>data</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;query&#34;</span><span class=p>:</span> <span class=s2>&#34;노트북&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;display&#34;</span><span class=p>:</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;start&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;sort&#34;</span><span class=p>:</span> <span class=s2>&#34;sim&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>headers</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;X-Naver-Client-Id&#34;</span><span class=p>:</span> <span class=s2>&#34;{{var.value.client_id_openapi_naver_com}}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;X-Naver-Client-Secret&#34;</span><span class=p>:</span> <span class=s2>&#34;{{var.value.client_secret_openapi_naver_com}}&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>},</span>
</span></span><span class=line><span class=cl>        <span class=n>response_filter</span><span class=o>=</span><span class=n>parse</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@task</span><span class=p>(</span><span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;print_product_task&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>print_product_task</span><span class=p>(</span><span class=n>ti</span><span class=p>:</span> <span class=n>TaskInstance</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=n>ti</span><span class=o>.</span><span class=n>xcom_pull</span><span class=p>(</span><span class=n>task_ids</span><span class=o>=</span><span class=s2>&#34;nshopping_search_task&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=kn>from</span> <span class=nn>pprint</span> <span class=kn>import</span> <span class=n>pprint</span>
</span></span><span class=line><span class=cl>        <span class=n>pprint</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>nshopping_search_task</span> <span class=o>&gt;&gt;</span> <span class=n>print_product_task</span><span class=p>()</span></span></span></code></pre></div></div><ul><li>DAG 실행 후 <code>print_product_task</code> 의 실행 로그를 확인했을 때, 아래와 같이 <code>nshopping_search_task</code> 에서 반환된 상품에 대한 정보를 조회 가능</li></ul><div class=sc-codeblock data-lang=bash><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># print_product_task</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO - DAG bundles loaded: dags-folder: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.dag_processing.bundles.manager.DagBundlesManager&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO - Filling up the DagBag from /opt/airflow/dags/http_operator.py: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.models.dagbag.DagBag&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO - <span class=o>{</span><span class=s1>&#39;brand&#39;</span>: <span class=s1>&#39;갤럭시북&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO -  <span class=s1>&#39;category1&#39;</span>: <span class=s1>&#39;디지털/가전&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO -  <span class=s1>&#39;category2&#39;</span>: <span class=s1>&#39;노트북&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO -  <span class=s1>&#39;category3&#39;</span>: <span class=s1>&#39;&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO -  <span class=s1>&#39;category4&#39;</span>: <span class=s1>&#39;&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO -  <span class=s1>&#39;hprice&#39;</span>: <span class=s1>&#39;&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO -  <span class=s1>&#39;image&#39;</span>: <span class=s1>&#39;https://shopping-phinf.pstatic.net/main_8795238/87952389253.11.jpg&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO -  <span class=s1>&#39;link&#39;</span>: <span class=s1>&#39;https://smartstore.naver.com/main/products/10407884292&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO -  <span class=s1>&#39;lprice&#39;</span>: <span class=s1>&#39;428000&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO -  <span class=s1>&#39;maker&#39;</span>: <span class=s1>&#39;삼성전자&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO -  <span class=s1>&#39;mallName&#39;</span>: <span class=s1>&#39;삼성공식파트너 코인비엠에스&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO -  <span class=s1>&#39;productId&#39;</span>: <span class=s1>&#39;87952389253&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO -  <span class=s1>&#39;productType&#39;</span>: <span class=s1>&#39;2&#39;</span>,: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO -  <span class=s1>&#39;title&#39;</span>: <span class=s1>&#39;삼성 갤럭시북 인강용 사무용 업무용 가성비 윈도우11 저가 싼 태블릿 &lt;b&gt;노트북&lt;/b&gt; 추천 기본팩&#39;</span><span class=o>}</span>: <span class=nv>chan</span><span class=o>=</span><span class=s2>&#34;stdout&#34;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;task&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 12:33:35<span class=o>]</span> INFO - Done. Returned value was: None: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.airflow.providers.standard.decorators.python._PythonDecoratedOperator&#34;</span></span></span></code></pre></div></div><h2 id=custom-operator>Custom Operator
<a class=anchor href=#custom-operator>#</a></h2><a href=https://airflow.apache.org/docs/apache-airflow/stable/howto/custom-operator.html target=_blank class=sc-bookmark-card><div class=sc-bookmark-image><img src=https://airflow.apache.org/docs/apache-airflow/stable/_images/template_field_renderer_path.png alt="Creating a custom Operator — Airflow 3.1.3 Documentation" loading=lazy decoding=async></div><div class=sc-bookmark-content><h3 class=sc-bookmark-title>Creating a custom Operator — Airflow 3.1.3 Documentation</h3><small class=sc-bookmark-url>airflow.apache.org</small></div></a><h3 id=baseoperator>BaseOperator
<a class=anchor href=#baseoperator>#</a></h3><ul><li><code>BaseOperator</code> 클래스를 상속받아 직접 만든 Operator를 사용 가능</li><li><code>BaseOperator</code> 상속 시 두 가지 메서드를 재정의(Overriding)해야 함<ol><li><code>def __int__(self, *args, **kwargs)</code><ul><li>객체 생성 시 초기화하는 과정을 구현 (명시하지 않은 파라미터는 <code>kwargs</code>에 포함)</li></ul></li><li><code>def execute(self, context)</code><ul><li>Operator 실행 시 호출되는 메서드로 비즈니스 로직을 구현</li></ul></li><li><code>template_fields: Sequence[str] = ("name",)</code><ul><li>Jinja template을 적용할 파라미터를 지정</li></ul></li></ol></li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>class</span> <span class=nc>HelloOperator</span><span class=p>(</span><span class=n>BaseOperator</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>template_fields</span><span class=p>:</span> <span class=n>Sequence</span><span class=p>[</span><span class=nb>str</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=s2>&#34;name&#34;</span><span class=p>,)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>world</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>name</span> <span class=o>=</span> <span class=n>name</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>world</span> <span class=o>=</span> <span class=n>world</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>execute</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;Hello </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>world</span><span class=si>}</span><span class=s2> it&#39;s </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>!&#34;</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>message</span></span></span></code></pre></div></div><h3 id=httpoperator-개선점-파악>HttpOperator 개선점 파악
<a class=anchor href=#httpoperator-%ea%b0%9c%ec%84%a0%ec%a0%90-%ed%8c%8c%ec%95%85>#</a></h3><ol><li>주요 문제점은 네이버 쇼핑 검색 API의 표시 결과가 최대 100개로 제한되는 것으로, 더 많은 결과를 보려면 파라미터의 <code>start</code> 값을 다르게 한 여러 개의 HttpOperator를 만들어야 함<ul><li><code>execute()</code> 메서드 안에서 전체 요청을 100개 단위로 나누고, 반복문을 통해 여러 번 요청 및 응답 결과를 합칠 수 있게 로직을 작성</li></ul></li><li>기존엔 <code>endpoint</code> 를 전부 입력해야 했는데, API 종류를 구분할 수 있는 문자열만 전달해서 <code>endpoint</code> 를 자동으로 만들어주면 더 편리할 것이라 생각함<ul><li><code>endpoint</code> 변경이 용이하기 때문에 쇼핑 검색 뿐 아니라 블로그 검색도 같이 수행할 것을 고려</li></ul></li><li>기존엔 JSON 파싱한 결과를 그대로 반환했는데, 로컬 경로에 CSV 파일로 저장하면 결과를 확인하기 더 쉬울 것이라 생각함</li></ol><h3 id=operator-기능-정의>Operator 기능 정의
<a class=anchor href=#operator-%ea%b8%b0%eb%8a%a5-%ec%a0%95%ec%9d%98>#</a></h3><blockquote class=sc-hint><p>네이버 쇼핑 및 블로그 검색 API를 호출하여 전체 데이터를 받은 후 CSV 파일로 저장하기</p></blockquote><h2 id=naversearchtocsvoperator>NaverSearchToCsvOperator
<a class=anchor href=#naversearchtocsvoperator>#</a></h2><ul><li><code>BaseOperator</code> 를 상속받는 <code>NaverSearchToCsvOperator</code> 를 구현</li><li>Operator 재사용을 위해 <code>plugins/</code> 경로 아래에 추가</li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># plugins/operators/nshopping.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.models</span> <span class=kn>import</span> <span class=n>BaseOperator</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.hooks.base</span> <span class=kn>import</span> <span class=n>BaseHook</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>NaverSearchToCsvOperator</span><span class=p>(</span><span class=n>BaseOperator</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>template_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s2>&#34;file_path&#34;</span><span class=p>,</span> <span class=s2>&#34;client_id&#34;</span><span class=p>,</span> <span class=s2>&#34;client_secret&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>search_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>client_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>client_secret</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>keyword</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>display</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>start</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>sort</span> <span class=o>=</span> <span class=s2>&#34;sim&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>http_conn_id</span> <span class=o>=</span> <span class=s2>&#34;openapi.naver.com&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>endpoint</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;/v1/search/</span><span class=si>{</span><span class=n>search_type</span><span class=si>}</span><span class=s2>.json&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>method</span> <span class=o>=</span> <span class=s2>&#34;GET&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>file_path</span> <span class=o>=</span> <span class=n>file_path</span> <span class=k>if</span> <span class=n>file_path</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span> <span class=k>else</span> <span class=p>(</span><span class=s2>&#34;/opt/airflow/files/&#34;</span><span class=o>+</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client_id</span> <span class=o>=</span> <span class=n>client_id</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client_secret</span> <span class=o>=</span> <span class=n>client_secret</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>keyword</span> <span class=o>=</span> <span class=n>keyword</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>display</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>display</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>start</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>sort</span> <span class=o>=</span> <span class=n>sort</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>execute</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>connection</span> <span class=o>=</span> <span class=n>BaseHook</span><span class=o>.</span><span class=n>get_connection</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>http_conn_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>url</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>host</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoint</span>
</span></span><span class=line><span class=cl>        <span class=n>rows</span> <span class=o>=</span> <span class=nb>list</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>start</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>start</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>display</span><span class=p>,</span> <span class=mi>100</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>            <span class=n>display</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>display</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>start</span> <span class=o>-</span> <span class=n>start</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;시작: </span><span class=si>{</span><span class=n>start</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;끝: </span><span class=si>{</span><span class=n>start</span><span class=o>+</span><span class=n>display</span><span class=o>-</span><span class=mi>1</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>kwargs</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>keyword</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>keyword</span><span class=p>,</span> <span class=n>display</span><span class=o>=</span><span class=n>display</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=n>start</span><span class=p>,</span> <span class=n>sort</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>sort</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>rows</span> <span class=o>=</span> <span class=n>rows</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>_request_api</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>show_header</span><span class=o>=</span><span class=p>(</span><span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>),</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_mkdir</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_to_csv</span><span class=p>(</span><span class=n>rows</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>file_path</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s1>&#39;,&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_request_api</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>keyword</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>display</span><span class=p>:</span> <span class=nb>int</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>start</span><span class=p>:</span> <span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>sort</span><span class=o>=</span><span class=s2>&#34;sim&#34;</span><span class=p>,</span> <span class=n>show_header</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>List</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>        <span class=n>params</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_params</span><span class=p>(</span><span class=n>keyword</span><span class=p>,</span> <span class=n>display</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>sort</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>headers</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_headers</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>client_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>client_secret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>method</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span> <span class=k>as</span> <span class=n>response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_api</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>show_header</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_params</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>keyword</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>display</span><span class=p>:</span> <span class=nb>int</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>start</span><span class=p>:</span> <span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>sort</span><span class=o>=</span><span class=s2>&#34;sim&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;query&#34;</span><span class=p>:</span> <span class=n>keyword</span><span class=p>,</span> <span class=s2>&#34;display&#34;</span><span class=p>:</span> <span class=nb>min</span><span class=p>(</span><span class=n>display</span><span class=p>,</span> <span class=mi>100</span><span class=p>),</span> <span class=s2>&#34;start&#34;</span><span class=p>:</span> <span class=nb>min</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=mi>1000</span><span class=p>),</span> <span class=s2>&#34;sort&#34;</span><span class=p>:</span> <span class=n>sort</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_headers</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>client_secret</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;X-Naver-Client-Id&#34;</span><span class=p>:</span> <span class=n>client_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;X-Naver-Client-Secret&#34;</span><span class=p>:</span> <span class=n>client_secret</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_parse_api</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>,</span> <span class=n>start</span><span class=p>:</span> <span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>show_header</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>List</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=n>contents</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()[</span><span class=s2>&#34;items&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>contents</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>header</span> <span class=o>=</span> <span class=p>([[</span><span class=s2>&#34;rank&#34;</span><span class=p>]</span> <span class=o>+</span> <span class=nb>list</span><span class=p>(</span><span class=n>contents</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>keys</span><span class=p>())])</span> <span class=k>if</span> <span class=n>show_header</span> <span class=k>else</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>header</span> <span class=o>+</span> <span class=p>[[</span><span class=n>start</span><span class=o>+</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=nb>list</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>values</span><span class=p>())</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>content</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>contents</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span> <span class=k>return</span> <span class=nb>list</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_mkdir</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>        <span class=n>dir_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>file_path</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>dir_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;mkdir -p </span><span class=si>{</span><span class=n>dir_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_to_csv</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rows</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>List</span><span class=p>],</span> <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s1>&#39;,&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>def</span> <span class=nf>clean</span><span class=p>(</span><span class=n>value</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>value</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>sep</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=n>encoding</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>sep</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=n>clean</span><span class=p>,</span> <span class=n>row</span><span class=p>))</span><span class=o>+</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span></span></span></code></pre></div></div><h3 id=초기화-파라미터>초기화 파라미터
<a class=anchor href=#%ec%b4%88%ea%b8%b0%ed%99%94-%ed%8c%8c%eb%9d%bc%eb%af%b8%ed%84%b0>#</a></h3><p><strong><code>search_type: str</code></strong></p><ul><li>네이버 쇼핑 검색 API의 <code>endpoint</code> 는 <code>/v1/search/shop.json</code> 인데, 블로그 검색 또는 뉴스 검색과 같은 다른 API를 확인했을 때, URL에서 <code>{{host}}/v1/search/{{search_type}}.json</code> 와 같은 패턴이 있음을 확인 가능</li><li>따라서, <code>endpoint</code> 대신에 <code>search_type</code> 을 입력으로 받고 <code>endpoint</code> 를 자동으로 생성</li></ul><p><strong><code>file_path: str</code></strong></p><ul><li><code>naverSearch/</code> 경로 아래 실행 날짜별로 폴더를 만들어서 아래에 CSV 파일을 저장할 계획인데, <code>data_interval_end</code> 변수를 사용하기 위해 <code>template_fields</code> 에 해당 파라미터를 등록</li><li>Root(<code>/</code>) 경로를 지정하지 않았을 경우 <code>/opt/airflow/files</code> 경로를 Root 경로로 사용하도록 지정</li><li>이 때, Airflow 웹서버 컨테이너에 파일을 저장해도 로컬 컴퓨터에서 확인할 수 없기 때문에 <code>docker-compose.yaml</code> 파일에 컨테이너와 로컬 컴퓨터 경로를 연결짓는 구문을 입력<div class=sc-codeblock data-lang=yaml><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">yaml</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># docker-compose.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=nt>x-airflow-common</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>${AIRFLOW_PROJ_DIR:-.}/files:/opt/airflow/files</span></span></span></code></pre></div></div></li></ul><p><strong><code>client_id: str</code>, <code>client_secret: str</code></strong></p><ul><li>두 개의 API 계정 정보 또한 Variable에서 값을 꺼내오기 때문에 <code>template_fields</code> 에 등록</li><li>요청 헤더에 게정 정보를 추가하기 위해 사용</li></ul><p><strong><code>keyword: str</code>, <code>display: int</code>, <code>start: int</code>, <code>sort: str</code></strong></p><ul><li>API 요청 파라미터를 구성하는 대표적인 키값을 입력 받음</li><li><code>display</code> 는 최대 100까지 허용되지만, 반복문을 통해 나눠서 요청할 수 있기 때문에 1000까지 확장</li><li><code>start</code> 는 API 문서에 명세된 것과 같이 최대 1000까지의 값으로 제한</li><li><code>sort</code> 는 API 종류에 따라 허용되는 값이 다르지만, 공통적으로 정확도순 정렬(<code>sim</code>)을 사용할 것이기에 별도로 검증하지 않음</li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>template_fields</span> <span class=o>=</span> <span class=p>(</span><span class=s2>&#34;file_path&#34;</span><span class=p>,</span> <span class=s2>&#34;client_id&#34;</span><span class=p>,</span> <span class=s2>&#34;client_secret&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>search_type</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>client_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>client_secret</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>keyword</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>display</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>10</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>start</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>sort</span> <span class=o>=</span> <span class=s2>&#34;sim&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=o>**</span><span class=n>kwargs</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>http_conn_id</span> <span class=o>=</span> <span class=s2>&#34;openapi.naver.com&#34;</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>endpoint</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;/v1/search/</span><span class=si>{</span><span class=n>search_type</span><span class=si>}</span><span class=s2>.json&#34;</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>method</span> <span class=o>=</span> <span class=s2>&#34;GET&#34;</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>file_path</span> <span class=o>=</span> <span class=n>file_path</span> <span class=k>if</span> <span class=n>file_path</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;/&#34;</span><span class=p>)</span> <span class=k>else</span> <span class=p>(</span><span class=s2>&#34;/opt/airflow/files/&#34;</span><span class=o>+</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>client_id</span> <span class=o>=</span> <span class=n>client_id</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>client_secret</span> <span class=o>=</span> <span class=n>client_secret</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>keyword</span> <span class=o>=</span> <span class=n>keyword</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>display</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>display</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>start</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=mi>1000</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>sort</span> <span class=o>=</span> <span class=n>sort</span></span></span></code></pre></div></div><h3 id=api-요청-메서드>API 요청 메서드
<a class=anchor href=#api-%ec%9a%94%ec%b2%ad-%eb%a9%94%ec%84%9c%eb%93%9c>#</a></h3><p><strong><code>execute()</code></strong></p><ul><li>고정된 Connection ID를 가지고 Connection에 등록된 Host를 조회</li><li>Host와 <code>endpoint</code> 를 조합하여 API 요청 URL을 생성</li><li><code>start</code> 부터 <code>display</code> 까지의 범위를 100개 단위로 구분하여 반복문을 구성하고, 반복문마다 파라미터를 다르게 하여 API 요청 메서드 <code>_request_api()</code> 에 전달</li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>execute</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>connection</span> <span class=o>=</span> <span class=n>BaseHook</span><span class=o>.</span><span class=n>get_connection</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>http_conn_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>host</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>endpoint</span>
</span></span><span class=line><span class=cl>    <span class=n>rows</span> <span class=o>=</span> <span class=nb>list</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>start</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>start</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>display</span><span class=p>,</span> <span class=mi>100</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=n>display</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>display</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>start</span> <span class=o>-</span> <span class=n>start</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;시작: </span><span class=si>{</span><span class=n>start</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;끝: </span><span class=si>{</span><span class=n>start</span><span class=o>+</span><span class=n>display</span><span class=o>-</span><span class=mi>1</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>kwargs</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>keyword</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>keyword</span><span class=p>,</span> <span class=n>display</span><span class=o>=</span><span class=n>display</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=n>start</span><span class=p>,</span> <span class=n>sort</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>sort</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>rows</span> <span class=o>=</span> <span class=n>rows</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>_request_api</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>show_header</span><span class=o>=</span><span class=p>(</span><span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>),</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>...</span></span></span></code></pre></div></div><p><strong><code>_request_api()</code></strong></p><ul><li>직접적으로 API에 요청을 보내는 메서드</li><li>다른 메서드를 통해 파라미터와 헤더를 만들고, 전달받은 URL에 대해 GET 요청을 보냄</li><li>응답 결과인 <code>requests.Response</code> 객체를 그대로 파싱 메서드 <code>_parse_api()</code> 로 전달</li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>_request_api</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>keyword</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>display</span><span class=p>:</span> <span class=nb>int</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>start</span><span class=p>:</span> <span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>sort</span><span class=o>=</span><span class=s2>&#34;sim&#34;</span><span class=p>,</span> <span class=n>show_header</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>List</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_params</span><span class=p>(</span><span class=n>keyword</span><span class=p>,</span> <span class=n>display</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>sort</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>headers</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_headers</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>client_id</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>client_secret</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>requests</span><span class=o>.</span><span class=n>request</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>method</span><span class=p>,</span> <span class=n>url</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span> <span class=k>as</span> <span class=n>response</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_api</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=n>start</span><span class=p>,</span> <span class=n>show_header</span><span class=p>)</span></span></span></code></pre></div></div><p><strong><code>_get_params()</code></strong></p><ul><li>전달받은 파라미터를 딕셔너리 객체로 맵핑하여 반환하는 메서드</li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>_get_params</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>keyword</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>display</span><span class=p>:</span> <span class=nb>int</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>start</span><span class=p>:</span> <span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>sort</span><span class=o>=</span><span class=s2>&#34;sim&#34;</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span><span class=s2>&#34;query&#34;</span><span class=p>:</span> <span class=n>keyword</span><span class=p>,</span> <span class=s2>&#34;display&#34;</span><span class=p>:</span> <span class=nb>min</span><span class=p>(</span><span class=n>display</span><span class=p>,</span> <span class=mi>100</span><span class=p>),</span> <span class=s2>&#34;start&#34;</span><span class=p>:</span> <span class=nb>min</span><span class=p>(</span><span class=n>start</span><span class=p>,</span> <span class=mi>1000</span><span class=p>),</span> <span class=s2>&#34;sort&#34;</span><span class=p>:</span> <span class=n>sort</span><span class=p>}</span></span></span></code></pre></div></div><p><strong><code>_get_headers()</code></strong></p><ul><li>API 계정 정보를 추가한 요청 헤더를 딕셔너리 객체로 반환하는 메서드</li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>_get_headers</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client_id</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>client_secret</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>[</span><span class=nb>str</span><span class=p>,</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Content-Type&#34;</span><span class=p>:</span> <span class=s2>&#34;application/json&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;X-Naver-Client-Id&#34;</span><span class=p>:</span> <span class=n>client_id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;X-Naver-Client-Secret&#34;</span><span class=p>:</span> <span class=n>client_secret</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span></span></span></code></pre></div></div><h3 id=api-응답-결과-파싱-메서드>API 응답 결과 파싱 메서드
<a class=anchor href=#api-%ec%9d%91%eb%8b%b5-%ea%b2%b0%ea%b3%bc-%ed%8c%8c%ec%8b%b1-%eb%a9%94%ec%84%9c%eb%93%9c>#</a></h3><p><strong><code>execute()</code></strong></p><ul><li>반복문 밖에서 리스트 객체 <code>rows</code> 를 만들고, 반복문마다 <code>_request_api()</code> 메서드가 반환하는 각각의 리스트 객체를 하나로 결합</li><li>첫 번째 반복문에서만 CSV의 헤더를 표시하기 위해 <code>show_header</code> 파라미터를 활용</li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>execute</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=n>rows</span> <span class=o>=</span> <span class=nb>list</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>start</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>start</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>display</span><span class=p>,</span> <span class=mi>100</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=o>...</span>
</span></span><span class=line><span class=cl>        <span class=n>rows</span> <span class=o>=</span> <span class=n>rows</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>_request_api</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>show_header</span><span class=o>=</span><span class=p>(</span><span class=n>i</span> <span class=o>==</span> <span class=mi>0</span><span class=p>),</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span></span></span></code></pre></div></div><p><strong><code>_parse_api()</code></strong></p><ul><li><code>requests.Response</code> 객체를 인수로 전달받아 JSON 파싱한 후 <code>items</code> 키에서 배열을 꺼냄</li><li>CSV 파일로 저장하기 편한 구조로 가공하기 위해 딕셔너리에서 값만 꺼내 배열로 구성</li><li><code>execute()</code> 에서 전달한 <code>show_header</code> 파라미터를 통해 첫 번째 반복문에서만 CSV 헤더를 추가해 반환</li><li><code>pd.DataFrame</code> 을 활용할 수도 있지만, 단순하게 배열 타입으로 파싱</li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>_parse_api</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>response</span><span class=p>,</span> <span class=n>start</span><span class=p>:</span> <span class=nb>int</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>show_header</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>List</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=n>contents</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()[</span><span class=s2>&#34;items&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>contents</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>header</span> <span class=o>=</span> <span class=p>([[</span><span class=s2>&#34;rank&#34;</span><span class=p>]</span> <span class=o>+</span> <span class=nb>list</span><span class=p>(</span><span class=n>contents</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>keys</span><span class=p>())])</span> <span class=k>if</span> <span class=n>show_header</span> <span class=k>else</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>header</span> <span class=o>+</span> <span class=p>[[</span><span class=n>start</span><span class=o>+</span><span class=n>i</span><span class=p>]</span><span class=o>+</span><span class=nb>list</span><span class=p>(</span><span class=n>content</span><span class=o>.</span><span class=n>values</span><span class=p>())</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>content</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>contents</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span> <span class=k>return</span> <span class=nb>list</span><span class=p>()</span></span></span></code></pre></div></div><h3 id=csv-파일-저장-메서드>CSV 파일 저장 메서드
<a class=anchor href=#csv-%ed%8c%8c%ec%9d%bc-%ec%a0%80%ec%9e%a5-%eb%a9%94%ec%84%9c%eb%93%9c>#</a></h3><p><strong><code>execute()</code></strong></p><ul><li>CSV 파일을 저장하기 전에 <code>_mkdir()</code> 메서드를 통해 <code>file_path</code> 검증</li><li>API 응답 결과를 가진 <code>rows</code> 객체를 <code>_to_csv()</code> 메서드에 전달해 CSV 파일로 저장</li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>execute</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>context</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>_mkdir</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>_to_csv</span><span class=p>(</span><span class=n>rows</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>file_path</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s1>&#39;,&#39;</span><span class=p>)</span></span></span></code></pre></div></div><p><strong><code>_mkdir()</code></strong></p><ul><li><code>file_path</code> 가 있는지 확인하고, 없으면 해당 경로를 생성하는 메서드</li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>_mkdir</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>    <span class=n>dir_path</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>file_path</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>dir_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>os</span><span class=o>.</span><span class=n>system</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;mkdir -p </span><span class=si>{</span><span class=n>dir_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span></span></span></code></pre></div></div><p><strong><code>_to_csv()</code></strong></p><ul><li><code>file_path</code> 를 열고, 전달받은 <code>rows</code> 객체를 한 줄씩 기록하는 메서드</li><li>구분자 <code>,</code> 가 있을 경우 쌍따옴표 <code>" "</code> 로 감싸는 것과 같은 조치가 필요하지만, 내용이 중요한건 아니기 때문에 단순히 값에서 구분자 <code>,</code> 를 모두 제거하는 방식으로 가공하여 저장</li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>_to_csv</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>rows</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>List</span><span class=p>],</span> <span class=n>file_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>,</span> <span class=n>sep</span><span class=o>=</span><span class=s1>&#39;,&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>clean</span><span class=p>(</span><span class=n>value</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>value</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=n>sep</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=n>encoding</span><span class=p>)</span> <span class=k>as</span> <span class=n>file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>rows</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>sep</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=n>clean</span><span class=p>,</span> <span class=n>row</span><span class=p>))</span><span class=o>+</span><span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span></span></span></code></pre></div></div><h2 id=custom-operator-활용-예시>Custom Operator 활용 예시
<a class=anchor href=#custom-operator-%ed%99%9c%ec%9a%a9-%ec%98%88%ec%8b%9c>#</a></h2><h3 id=dag-생성-및-실행>DAG 생성 및 실행
<a class=anchor href=#dag-%ec%83%9d%ec%84%b1-%eb%b0%8f-%ec%8b%a4%ed%96%89>#</a></h3><ul><li><code>plugins/</code> 에 정의한 <code>NaverSearchToCsvOperator</code> 를 가져와서 두 개의 Task를 생성</li><li>하나는 네이버 쇼핑 검색 API를 사용하는 <code>search_shopping_task</code>, 다른 하나는 네이버 블로그 검색 API를 사용하는 <code>search_blog_task</code></li><li><code>HttpOperator</code> 를 사용했으면 길어졌을 내용을 <code>NaverSearchToCsvOperator</code> 로 구조화하여 DAG 선언을 단순화</li></ul><div class=sc-codeblock data-lang=python><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># dags/nsearch_operator.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>airflow.sdk</span> <span class=kn>import</span> <span class=n>DAG</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>operators.nshopping</span> <span class=kn>import</span> <span class=n>NaverSearchToCsvOperator</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>pendulum</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>with</span> <span class=n>DAG</span><span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=n>dag_id</span><span class=o>=</span><span class=s2>&#34;nsearch_operator&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>schedule</span><span class=o>=</span><span class=s2>&#34;0 9 * * *&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>start_date</span><span class=o>=</span><span class=n>pendulum</span><span class=o>.</span><span class=n>datetime</span><span class=p>(</span><span class=mi>2025</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=n>tz</span><span class=o>=</span><span class=s2>&#34;Asia/Seoul&#34;</span><span class=p>),</span>
</span></span><span class=line><span class=cl>    <span class=n>catchup</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=n>tags</span><span class=o>=</span><span class=p>[</span><span class=s2>&#34;example&#34;</span><span class=p>,</span> <span class=s2>&#34;http&#34;</span><span class=p>],</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=k>as</span> <span class=n>dag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>api_keys</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>client_id</span><span class=o>=</span><span class=s2>&#34;{{var.value.client_id_openapi_naver_com}}&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>client_secret</span><span class=o>=</span><span class=s2>&#34;{{var.value.client_secret_openapi_naver_com}}&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>common_params</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>keyword</span><span class=o>=</span><span class=s2>&#34;노트북&#34;</span><span class=p>,</span> <span class=n>display</span><span class=o>=</span><span class=mi>1000</span><span class=p>,</span> <span class=n>start</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>sort</span><span class=o>=</span><span class=s2>&#34;sim&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;네이버 쇼핑 검색&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>search_shopping_task</span> <span class=o>=</span> <span class=n>NaverSearchToCsvOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;search_shopping_task&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>search_type</span><span class=o>=</span><span class=s2>&#34;shop&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>file_path</span><span class=o>=</span><span class=s2>&#34;naverSearch/{{data_interval_end.in_timezone(</span><span class=se>\&#34;</span><span class=s2>Asia/Seoul</span><span class=se>\&#34;</span><span class=s2>) | ds_nodash }}/shop.csv&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=o>**</span><span class=n>api_keys</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=o>**</span><span class=n>common_params</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;네이버 블로그 검색&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>search_blog_task</span> <span class=o>=</span> <span class=n>NaverSearchToCsvOperator</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=n>task_id</span><span class=o>=</span><span class=s2>&#34;search_blog_task&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>search_type</span><span class=o>=</span><span class=s2>&#34;blog&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>file_path</span><span class=o>=</span><span class=s2>&#34;naverSearch/{{data_interval_end.in_timezone(</span><span class=se>\&#34;</span><span class=s2>Asia/Seoul</span><span class=se>\&#34;</span><span class=s2>) | ds_nodash }}/blog.csv&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=o>**</span><span class=n>api_keys</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=o>**</span><span class=n>common_params</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>search_shopping_task</span> <span class=o>&gt;&gt;</span> <span class=n>search_blog_task</span></span></span></code></pre></div></div><ul><li><code>start</code> 1부터 <code>display</code> 1000까지 총 1000개의 검색 결과를 100개 단위로 나눠서 요청하는 과정을 로그로 남겨서 조회</li></ul><label class=sc-image for=sc-image-toggle-8 style=text-align:center><input class="hidden toggle" type=checkbox id=sc-image-toggle-8><img src="https://dl.dropboxusercontent.com/scl/fi/3hty0k935z7ae0y3u0y2y/airflow-46-naver-search-task.webp?rlkey=k2diw9fntl9qaud4pxvgl6akv&amp;raw=1" alt="search_shopping_task >> search_blog_task" loading=lazy decoding=async style=zgotmplz></label><div class=sc-codeblock data-lang=bash><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:00<span class=o>]</span> INFO - DAG bundles loaded: dags-folder: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.dag_processing.bundles.manager.DagBundlesManager&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:00<span class=o>]</span> INFO - Filling up the DagBag from /opt/airflow/dags/nsearch_operator.py: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.models.dagbag.DagBag&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:00<span class=o>]</span> INFO - Secrets backends loaded <span class=k>for</span> worker: <span class=nv>count</span><span class=o>=</span>1: <span class=nv>backend_classes</span><span class=o>=[</span><span class=s2>&#34;EnvironmentVariablesBackend&#34;</span><span class=o>]</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;supervisor&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:00<span class=o>]</span> INFO - Secrets backends loaded <span class=k>for</span> worker: <span class=nv>count</span><span class=o>=</span>1: <span class=nv>backend_classes</span><span class=o>=[</span><span class=s2>&#34;EnvironmentVariablesBackend&#34;</span><span class=o>]</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;supervisor&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:00<span class=o>]</span> INFO - Secrets backends loaded <span class=k>for</span> worker: <span class=nv>count</span><span class=o>=</span>1: <span class=nv>backend_classes</span><span class=o>=[</span><span class=s2>&#34;EnvironmentVariablesBackend&#34;</span><span class=o>]</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;supervisor&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:00<span class=o>]</span> INFO - Connection Retrieved <span class=s1>&#39;openapi.naver.com&#39;</span>: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.hooks.base&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:00<span class=o>]</span> INFO - 시작: 1: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:00<span class=o>]</span> INFO - 끝: 100: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:00<span class=o>]</span> INFO - 시작: 101: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:00<span class=o>]</span> INFO - 끝: 200: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:01<span class=o>]</span> INFO - 시작: 201: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:01<span class=o>]</span> INFO - 끝: 300: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:01<span class=o>]</span> INFO - 시작: 301: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:01<span class=o>]</span> INFO - 끝: 400: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:01<span class=o>]</span> INFO - 시작: 401: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:01<span class=o>]</span> INFO - 끝: 500: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:02<span class=o>]</span> INFO - 시작: 501: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:02<span class=o>]</span> INFO - 끝: 600: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:02<span class=o>]</span> INFO - 시작: 601: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:02<span class=o>]</span> INFO - 끝: 700: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:02<span class=o>]</span> INFO - 시작: 701: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:02<span class=o>]</span> INFO - 끝: 800: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:02<span class=o>]</span> INFO - 시작: 801: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:02<span class=o>]</span> INFO - 끝: 900: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:03<span class=o>]</span> INFO - 시작: 901: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span>
</span></span><span class=line><span class=cl><span class=o>[</span>2025-06-07, 19:44:03<span class=o>]</span> INFO - 끝: 1000: <span class=nv>source</span><span class=o>=</span><span class=s2>&#34;airflow.task.operators.operators.nshopping.NaverSearchToCsvOperator&#34;</span></span></span></code></pre></div></div><h3 id=csv-파일-확인>CSV 파일 확인
<a class=anchor href=#csv-%ed%8c%8c%ec%9d%bc-%ed%99%95%ec%9d%b8>#</a></h3><ul><li>모든 Task가 <code>success</code> 로 처리된 후, 로컬 컴퓨터의 <code>files/</code> 경로에 두 개의 CSV 파일이 생성됨을 확인</li></ul><div class=sc-codeblock data-lang=bash><div class=code-actions><button class="code-copy-button code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">bash</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>% tree files -F
</span></span><span class=line><span class=cl>files/
</span></span><span class=line><span class=cl>└── naverSearch/
</span></span><span class=line><span class=cl>    └── 20250607/
</span></span><span class=line><span class=cl>        ├── blog.csv
</span></span><span class=line><span class=cl>        └── shop.csv</span></span></code></pre></div></div><h4 id=shopcsv><code>shop.csv</code>
<a class=anchor href=#shopcsv>#</a></h4><div class=sc-data-table><table class=data-table data-filename=shop.csv><caption class=data-table-caption><button class=data-download-button data-filename=shop.csv data-delimiter=, onclick=downloadCSV(this)>
<i class="fa-solid fa-download"></i> shop.csv</button></caption><thead><tr><th title=rank>rank</th><th title=title>title</th><th title=link>link</th><th title=image>image</th><th title=lprice>lprice</th><th title=hprice>hprice</th><th title=mallName>mallName</th><th title=productId>productId</th><th title=productType>productType</th><th title=brand>brand</th><th title=maker>maker</th><th title=category1>category1</th><th title=category2>category2</th><th title=category3>category3</th><th title=category4>category4</th></tr></thead><tbody><tr><td title=1>1</td><td title="삼성 갤럭시북...">삼성 갤럭시북...</td><td title=https://...>https://...</td><td title=https://...>https://...</td><td title=428000>428000</td><td title></td><td title="삼성공식파트너 코인비엠에스">삼성공식파트너 코인비엠에스</td><td title=87952389253>87952389253</td><td title=2>2</td><td title=갤럭시북>갤럭시북</td><td title=삼성전자>삼성전자</td><td title=디지털/가전>디지털/가전</td><td title=노트북>노트북</td><td title></td><td title></td></tr><tr><td title=2>2</td><td title="삼성전자 갤럭시북4...">삼성전자 갤럭시북4...</td><td title=https://...>https://...</td><td title=https://...>https://...</td><td title=799000>799000</td><td title></td><td title=네이버>네이버</td><td title=52631236642>52631236642</td><td title=1>1</td><td title=갤럭시북4>갤럭시북4</td><td title=삼성전자>삼성전자</td><td title=디지털/가전>디지털/가전</td><td title=노트북>노트북</td><td title></td><td title></td></tr><tr><td title=3>3</td><td title="LG전자 울트라PC...">LG전자 울트라PC...</td><td title=https://...>https://...</td><td title=https://...>https://...</td><td title=599000>599000</td><td title></td><td title="제이 씨앤에스">제이 씨앤에스</td><td title=83718736488>83718736488</td><td title=2>2</td><td title=LG전자>LG전자</td><td title=LG전자>LG전자</td><td title=디지털/가전>디지털/가전</td><td title=노트북>노트북</td><td title></td><td title></td></tr><tr><td title=4>4</td><td title="삼성전자 갤럭시북4...">삼성전자 갤럭시북4...</td><td title=https://...>https://...</td><td title=https://...>https://...</td><td title=728000>728000</td><td title></td><td title=네이버>네이버</td><td title=52647794278>52647794278</td><td title=1>1</td><td title=갤럭시북4>갤럭시북4</td><td title=삼성전자>삼성전자</td><td title=디지털/가전>디지털/가전</td><td title=노트북>노트북</td><td title></td><td title></td></tr><tr><td title=5>5</td><td title="LG그램 <b>노트북</b>...">LG그램 <b>노트북</b>...</td><td title=https://...>https://...</td><td title=https://...>https://...</td><td title=1149000>1149000</td><td title></td><td title=온라인총판대리점>온라인총판대리점</td><td title=86636005031>86636005031</td><td title=2>2</td><td title=LG그램>LG그램</td><td title=LG전자>LG전자</td><td title=디지털/가전>디지털/가전</td><td title=노트북>노트북</td><td title></td><td title></td></tr></tbody></table></div><h4 id=blogcsv><code>blog.csv</code>
<a class=anchor href=#blogcsv>#</a></h4><div class=sc-data-table><table class=data-table data-filename=blog.csv><caption class=data-table-caption><button class=data-download-button data-filename=blog.csv data-delimiter=, onclick=downloadCSV(this)>
<i class="fa-solid fa-download"></i> blog.csv</button></caption><thead><tr><th title=rank>rank</th><th title=title>title</th><th title=link>link</th><th title=description>description</th><th title=bloggername>bloggername</th><th title=bloggerlink>bloggerlink</th><th title=postdate>postdate</th></tr></thead><tbody><tr><td title=1>1</td><td title="<b>노트북</b>에서..."><b>노트북</b>에서...</td><td title=https://...>https://...</td><td title="버리고 <b>노트북</b>으로...">버리고 <b>노트북</b>으로...</td><td title="란디의 하늘색 꿈">란디의 하늘색 꿈</td><td title=blog.naver.com/fksel33>blog.naver.com/fksel33</td><td title=20250601>20250601</td></tr><tr><td title=2>2</td><td title="고비넘긴 삼성<b>노트북</b>...">고비넘긴 삼성<b>노트북</b>...</td><td title=https://...>https://...</td><td title="노원구 공릉동에 위치한...">노원구 공릉동에 위치한...</td><td title=하드웨어수리닷컴(엘존)>하드웨어수리닷컴(엘존)</td><td title=blog.naver.com/yzenn>blog.naver.com/yzenn</td><td title=20250603>20250603</td></tr><tr><td title=3>3</td><td title="MSI 사무용<b>노트북</b>...">MSI 사무용<b>노트북</b>...</td><td title=https://...>https://...</td><td title="MSI<b>노트북</b>중에서...">MSI<b>노트북</b>중에서...</td><td title=Modulestudio>Modulestudio</td><td title=blog.naver.com/modulestudio>blog.naver.com/modulestudio</td><td title=20250602>20250602</td></tr><tr><td title=4>4</td><td title="아직 이걸 안 써?...">아직 이걸 안 써?...</td><td title=https://...>https://...</td><td title="아직 이걸 안 써?...">아직 이걸 안 써?...</td><td title="짜루의 이것저것 리뷰">짜루의 이것저것 리뷰</td><td title=blog.naver.com/skdaksdptn>blog.naver.com/skdaksdptn</td><td title=20250520>20250520</td></tr><tr><td title=5>5</td><td title="가성비 초경량 <b>노트북</b>...">가성비 초경량 <b>노트북</b>...</td><td title=https://...>https://...</td><td title="그런 <b>노트북</b>을...">그런 <b>노트북</b>을...</td><td title="삼성Mall 한사랑씨앤씨 공식 블로그">삼성Mall 한사랑씨앤씨 공식 블로그</td><td title=blog.naver.com/hansarangcnc>blog.naver.com/hansarangcnc</td><td title=20250527>20250527</td></tr></tbody></table></div></article><footer class=site-footer><div class=tags-wrap><a href="/search/?tags=Apache%20Airflow" class=tag>#Apache Airflow</a>
<a href="/search/?tags=HttpOperator" class=tag>#HttpOperator</a>
<a href="/search/?tags=BaseOperator" class=tag>#BaseOperator</a>
<a href="/search/?tags=REST%20API" class=tag>#REST API</a>
<a href="/search/?tags=%eb%84%a4%ec%9d%b4%eb%b2%84%20Open%20API" class=tag>#네이버 Open API</a>
<a href="/search/?tags=Custom%20Operator" class=tag>#Custom Operator</a>
<a href="/search/?tags=%eb%8d%b0%ec%9d%b4%ed%84%b0%20%ec%97%94%ec%a7%80%eb%8b%88%ec%96%b4%eb%a7%81" class=tag>#데이터 엔지니어링</a>
<a href="/search/?tags=%ec%97%90%ec%96%b4%ed%94%8c%eb%a1%9c%ec%9a%b0" class=tag>#에어플로우</a>
<a href="/search/?tags=Python" class=tag>#Python</a>
<a href="/search/?tags=Study" class=tag>#Study</a></div><div class=prev-next-wrap><a href=/blog/airflow-study-5/ class=prev-link><span class=prev-next-label><i class="fa-solid fa-backward"></i> PREV</span>
<span class=prev-next-title>Apache Airflow - DAG 흐름 제어 (Trigger Rule, TriggerDagRun, TaskGroup)</span>
</a><a href=/blog/airflow-study-7/ class=next-link><span class=prev-next-label>NEXT <i class="fa-solid fa-forward"></i></span>
<span class=prev-next-title>Apache Airflow - 외부 시스템 연동 (Connection, Hook, PostgreSQL)</span></a></div><div class=comments-wrap><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://minyeamer.github.io/blog/airflow-study-6/",this.page.identifier="https://minyeamer.github.io/blog/airflow-study-6/"};window.relocateDisqus=()=>{let e=0;const t=20,n=setInterval(()=>{e++;const s=document.getElementById(atob(atob("WkdsemNYVnpYM1JvY21WaFpBPT0=")));var o=!1;if(s){const e=s.querySelector(atob(atob("VzNOeVl5bzlKMkZrY3lkZA==")));e&&(s.appendChild(e),o=!0)}(o||e>t)&&clearInterval(n)},1e3)},function(){var e=document,t=e.createElement("script");t.src="https://minyeamer.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)}(),window.relocateDisqus();function reloadDisqus(){window.DISQUS&&(DISQUS.reset({reload:!0,config:function(){this.page.url="https://minyeamer.github.io/blog/airflow-study-6/",this.page.identifier="https://minyeamer.github.io/blog/airflow-study-6/"}}),window.relocateDisqus())}</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><div class="copyright-wrap flex justify-center"><small>Minystory - <a href=https://creativecommons.org/licenses/by/4.0/legalcode target=_blank rel="noopener noreferrer">© CC BY 4.0</a></small></div></footer><label for=menu-control class="hidden site-menu-overlay"></label></div><aside class=site-toc aria-label=목차><div class=toc-content><nav id=TableOfContents><ul><li><a href=#httpoperator>HttpOperator</a><ul><li><a href=#provider-패키지-설치>Provider 패키지 설치</a></li><li><a href=#httpoperator-파라미터>HttpOperator 파라미터</a></li></ul></li><li><a href=#네이버-쇼핑-검색-api>네이버 쇼핑 검색 API</a><ul><li><a href=#api-키-생성>API 키 생성</a></li><li><a href=#connection-추가>Connection 추가</a></li><li><a href=#variable-추가>Variable 추가</a></li><li><a href=#httpoperator-활용-예시>HttpOperator 활용 예시</a></li></ul></li><li><a href=#custom-operator>Custom Operator</a><ul><li><a href=#baseoperator>BaseOperator</a></li><li><a href=#httpoperator-개선점-파악>HttpOperator 개선점 파악</a></li><li><a href=#operator-기능-정의>Operator 기능 정의</a></li></ul></li><li><a href=#naversearchtocsvoperator>NaverSearchToCsvOperator</a><ul><li><a href=#초기화-파라미터>초기화 파라미터</a></li><li><a href=#api-요청-메서드>API 요청 메서드</a></li><li><a href=#api-응답-결과-파싱-메서드>API 응답 결과 파싱 메서드</a></li><li><a href=#csv-파일-저장-메서드>CSV 파일 저장 메서드</a></li></ul></li><li><a href=#custom-operator-활용-예시>Custom Operator 활용 예시</a><ul><li><a href=#dag-생성-및-실행>DAG 생성 및 실행</a></li><li><a href=#csv-파일-확인>CSV 파일 확인</a></li></ul></li></ul></nav></div><div class=hidden id=toc-config data-start=2 data-end=3></div></aside><div class=site-toolbar role=toolbar aria-label="툴바'"><input type=checkbox id=toolbar-toggle class="hidden toggle"><div class=toolbar-items><button class=toolbar-button onclick='window.scrollTo({top:0,behavior:"smooth"})' title="Go to top">
<i class="fa fa-chevron-up"></i>
</button>
<button class=toolbar-button onclick='window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})' title="Go to bottom">
<i class="fa fa-chevron-down"></i>
</button>
<button class=toolbar-button onclick=history.back() title="Go back">
<i class="fa-solid fa-arrow-left"></i></button></div><label for=toolbar-toggle class="toolbar-button toolbar-toggle-label"><i class="fa-solid fa-plus icon-expand"></i>
<i class="fa-solid fa-xmark icon-collapse"></i></label></div></main></body></html>