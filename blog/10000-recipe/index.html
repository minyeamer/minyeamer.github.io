<!doctype html><html lang=ko-kr dir=ltr><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><meta name=keywords content="Crawling,Python,만개의레시피,크롤링"><meta name=description content="최근 레시피 생성을 목적으로 한 사이드 프로젝트에 참여하게 되었는데 모델 학습을 위한 만개의 레시피 데이터 크롤링을 진행해보았습니다. 스키마 구성 # 기존엔 레시피 명칭과 음식 재 …"><meta name=author content="minyeamer"><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><link rel=canonical href=https://minyeamer.github.io/blog/10000-recipe/><link rel=icon href=https://minyeamer.github.io/images/favicons/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://minyeamer.github.io/images/favicons/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://minyeamer.github.io/images/favicons/favicon-32x32.png><link rel=apple-touch-icon href=https://minyeamer.github.io/images/favicons/apple-touch-icon.png><link rel=mask-icon href=https://minyeamer.github.io/images/favicons/apple-touch-icon.png><meta name=google-site-verification content="u1tWcHmHUZWfFT1cHaku6sqU-bK40N3WLR-C-4VUWN0"><meta name=naver-site-verification content="6eaf8e9da1a6104780f056f1a7797fe5a3a5a0da"><meta property="og:title" content="[Python] 만개의 레시피 데이터 수집"><meta property="og:description" content="최근 레시피 생성을 목적으로 한 사이드 프로젝트에 참여하게 되었는데 모델 학습을 위한 만개의 레시피 데이터 크롤링을 진행해보았습니다. 스키마 구성 # 기존엔 레시피 명칭과 음식 재 …"><meta property="og:type" content="article"><meta property="og:url" content="https://minyeamer.github.io/blog/10000-recipe/"><meta property="og:image" content="https://minyeamer.github.io/images/profile/opengraph.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-26T18:52:14+09:00"><meta property="article:modified_time" content="2023-03-26T18:52:14+09:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://minyeamer.github.io/images/profile/opengraph.jpg"><meta name=twitter:title content="[Python] 만개의 레시피 데이터 수집"><meta name=twitter:description content="최근 레시피 생성을 목적으로 한 사이드 프로젝트에 참여하게 되었는데 모델 학습을 위한 만개의 레시피 데이터 크롤링을 진행해보았습니다. 스키마 구성 # 기존엔 레시피 명칭과 음식 재 …"><meta name=twitter:site content="@https://x.com/minyeamer"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://minyeamer.github.io/posts/"},{"@type":"ListItem","position":2,"name":"[Python] 만개의 레시피 데이터 수집","item":"https://minyeamer.github.io/blog/10000-recipe/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Python] 만개의 레시피 데이터 수집","name":"[Python] 만개의 레시피 데이터 수집","description":"최근 레시피 생성을 목적으로 한 사이드 프로젝트에 참여하게 되었는데\n모델 학습을 위한 만개의 레시피 데이터 크롤링을 진행해보았습니다.\n스키마 구성 # 기존엔 레시피 명칭과 음식 재료 정보만을 수집할 계획이었지만,\n만개의 레시피의 각 페이지를 살펴보면서 추가적으로 가져갈만한 데이터가 있음을 확인하여\n우선적으로 테이블 관계 및 스키마를 구성해보았습니다.\n초기에 만개의 레시피와 공공데이터를 데이터 소스로 삼았기 때문에,\n만개의 레시피에 대한 DB _10000, 공공데이터에 대한 DB food로 구성했습니다.\n_10000 DB 내 테이블은 만개의 레시피 내 각각의 페이지에서 가져온 데이터로 구성되며,\n크게 카테고리, 레시피, 사용자 단위로 구분할 수 있습니다.\n","keywords":["Crawling","Python","만개의레시피","크롤링"],"articleBody":"최근 레시피 생성을 목적으로 한 사이드 프로젝트에 참여하게 되었는데\n모델 학습을 위한 만개의 레시피 데이터 크롤링을 진행해보았습니다.\n스키마 구성 # 기존엔 레시피 명칭과 음식 재료 정보만을 수집할 계획이었지만,\n만개의 레시피의 각 페이지를 살펴보면서 추가적으로 가져갈만한 데이터가 있음을 확인하여\n우선적으로 테이블 관계 및 스키마를 구성해보았습니다.\n초기에 만개의 레시피와 공공데이터를 데이터 소스로 삼았기 때문에,\n만개의 레시피에 대한 DB _10000, 공공데이터에 대한 DB food로 구성했습니다.\n_10000 DB 내 테이블은 만개의 레시피 내 각각의 페이지에서 가져온 데이터로 구성되며,\n크게 카테고리, 레시피, 사용자 단위로 구분할 수 있습니다.\n만개의 레시피 데이터 수집 # 크롤링에서 데이터 요청 및 가공을 위해 정의된 유틸리티 함수들이 있는데,\n별도로 코드를 보여주지는 않고 해당 함수가 호출될 때 간단히 어떤 동작을 하는지만 전달드립니다.\n카테고리 추출 # 만개의 레시피 카테고리는 레시피 검색 페이지에서 간단하게 추출할 수 있으므로,\n개발자 도구 또는 requests에 대한 응답에서 카테고리에 해당하는 부분을 가져옵니다.\n여기서 get_headers() 함수는 User-Agent 등 기본적인 브라우저 정보가 담긴 헤더를 반환합니다.\nCopy python url = \"https://www.10000recipe.com/recipe/list.html\" headers = get_headers(url, referer=url) headers[\"upgrade-insecure-requests\"] = '1' response = session.get(url, params=params, headers=headers) source = BeautifulSoup(response.text, \"html.parser\") cate_list = source.select_one(\"div.cate_list\") pattern = \"javascript:goSearchRecipe([\\d\\w()',]+)\" raw_cat = [(re_get(pattern, cat.attrs[\"href\"]),cat.text) for cat in cate_list.select(\"a\") if \"href\" in cat.attrs] cat_map = lambda catType, catId, catName: {\"categoryId\":catId, \"categoryType\":catType, \"categoryName\":catName} categories = [cat_map(*literal_eval(data), name) for data, name in raw_cat] categories = pd.DataFrame(categories) categories = categories[categories[\"categoryId\"]!=''] categories.head() 데이터 수집 결과 아래와 같은 구조의 데이터를 획득할 수 있습니다.\ncategoryId categoryType categoryName 63 cat4 밑반찬 56 cat4 메인반찬 54 cat4 국/탕 55 cat4 찌개 60 cat4 디저트 레시피 목록 추출 # 레시피 검색 페이지는 검색어, 정렬 기준, 페이지, 카테고리를 쿼리로 받습니다.\n레시피 목록을 추출하는데 검색어나 카테고리는 필요하지 않고 동일한 정렬 기준에서 수집하기 때문에\n데이터 수집 시에는 페이지에 반복문을 적용하여 데이터가 존재하는 범위를 가져올 것입니다.\nCopy python ORDER_MAP = {\"정확순\":\"accuracy\", \"최신순\":\"date\", \"추천순\":\"reco\"} get_params = lambda **kwargs: {k:v for k,v in kwargs.items() if v} uri = \"https://www.10000recipe.com/recipe/\" def fetch(session: requests.Session, query=str(), sortType=\"추천순\", page=1, cat1=str(), cat2=str(), cat3=str(), cat4=str(), **kwargs) -\u003e List[str]: url = uri+\"list.html\" params = get_params(q=query, order=ORDER_MAP[sortType], page=page, cat1=cat1, cat2=cat2, cat3=cat3, cat4=cat4) headers = get_headers(url, referer=url) headers[\"upgrade-insecure-requests\"] = '1' response = session.get(url, params=params, headers=headers) return parse(response.text, **kwargs) def parse(response: str, **kwargs) -\u003e List[str]: source = BeautifulSoup(response, 'html.parser') uris = source.select(\"a.common_sp_link\") ids = [uri.attrs[\"href\"].split('/')[-1] for uri in uris if \"href\" in uri.attrs] return ids 데이터 수집 결과로는 문자열 타입의 레시피 ID 목록을 획득할 수 있습니다.\n레시피 정보 추출 # 레시피 ID로 접근할 수 있는 레시피 상세 정보 페이지에서\n레시피 정보에 대한 데이터를 추출합니다. 소스코드 내에서 레시피 정보가 JSON 형식으로 존재하기 때문에\n일일히 HTML 태그를 파싱할 필요 없이 데이터를 한번에 JSON 오브젝트로 가져올 수 있습니다.\n데이터를 가공하는 map_recipe() 함수 내에서\ncast_int()는 데이터를 정수형으로 변환할 때 에러가 발생하면 기본값 0을 반환하는 함수이고,\nhier_get()은 중첩 딕셔너리의에 단계별 키 목록에 대한 값을 안전하게 가져오기 위한 함수입니다.\nCopy python uri = \"https://www.10000recipe.com/recipe/\" def fetch(session: requests.Session, recipeId: str, **kwargs) -\u003e Dict: url = uri+recipeId # https://www.10000recipe.com/recipe/6997297 headers = get_headers(url, referer=uri+\"list.html\") headers[\"upgrade-insecure-requests\"] = '1' response = session.get(url, headers=headers) return parse(response.text, recipeId, **kwargs) def parse(response: str, recipeId: str, **kwargs) -\u003e Dict: source = BeautifulSoup(response, 'html.parser') raw_json = source.select_one(\"script[type=\\\"application/ld+json\\\"]\").text try: data = json.loads(raw_json) except: data = literal_eval(raw_json) return map_recipe(data, recipeId, source, **kwargs) def map_recipe(data: Dict, recipeId: str, source=None, **kwargs) -\u003e Dict: recipe_info = {\"recipeId\": recipeId} recipe_info[\"name\"] = data.get(\"name\") recipe_info[\"author\"] = hier_get(data, [\"author\",\"name\"]) recipe_info[\"ratingValue\"] = cast_int(hier_get(data, [\"aggregateRating\",\"ratingValue\"])) recipe_info[\"reviewCount\"] = cast_int(hier_get(data, [\"aggregateRating\",\"reviewCount\"])) recipe_info[\"totalTime\"] = data.get(\"totalTime\") recipe_info[\"recipeYield\"] = data.get(\"recipeYield\") try: recipe_info[\"recipeIngredient\"] = ','.join(data[\"recipeIngredient\"]) except: recipe_info[\"recipeIngredient\"] = extract_ingredient(source, **kwargs) recipe_info[\"recipeInstructions\"] = '\\n'.join( [step.get(\"text\",str()) for step in data.get(\"recipeInstructions\",list()) if isinstance(step, dict)]) recipe_info[\"createDate\"] = data.get(\"datePublished\") return recipe_info def extract_ingredient(source: Tag, **kwargs) -\u003e str: cont_ingre = source.select_one(\"div.cont_ingre\") if cont_ingre: return [ingre.split() for ingre in cont_ingre.select_one(\"dd\").text.split(',')] else: return str() 데이터 수집 결과 아래와 같이 정리된 딕셔너리를 얻을 수 있습니다.\nCopy python { \"recipeId\": \"6997297\", \"name\": \"두부짜조\", \"author\": \"호이호이\", \"ratingValue\": 5, \"reviewCount\": 1, \"totalTime\": \"PT20M\", \"recipeYield\": \"1 servings\", \"recipeIngredient\": \"두부 30g,라이스페이퍼 2장,돼지고기 5g,...\", \"recipeInstructions\": \"부위는 상관없지만 저는 저렴하고...\", \"createDate\": \"2023-02-19T13:37:04+09:00\" } 실질적으로 활용할 데이터는 레시피명 name과 재료명인 recipeIngredient이며,\n평점, 리뷰 수, 조리순서 등도 추가적인 분석을 통해 활용성을 기대해볼 수 있습니다.\n요리 후기 추출 # 동일한 레시피 상세 정보 페이지에서 요리 후기에 대한 데이터를 추출할 수 있습니다.\n단, 요리 후기는 JSON 형식으로 정리되어 있지 않기 때문에\nHTML 소스를 파싱하여 대상 문자열을 추출해야 합니다.\n데이터를 가공하는 map_review() 함수 내에서\nre_get()은 정규표현식 패턴에 매칭되는 문자열을 추출하는 함수이고,\nselect_text()는 BeautifulSoup 태그에서\nCSS Selector로 안전하게 문자열을 추출하는 함수입니다.\nCopy python GENDER = {\"info_name_m\":\"M\", \"info_name_f\":\"F\"} uri = \"https://www.10000recipe.com/recipe/\" rid_ptn = \"replyReviewDiv_(\\d+)\" uid_ptn = \"/profile/review.html\\?uid=([\\d\\w]+)\" date_ptn = \"(\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2}:\\d{2})\" def fetch(session: requests.Session, recipeId: str, **kwargs) -\u003e List[Dict]: url = uri+recipeId headers = get_headers(url, referer=uri+\"list.html\") headers[\"upgrade-insecure-requests\"] = '1' response = session.get(url, headers=headers) return parse(response.text, recipeId, **kwargs) def parse(response: str, recipeId: str, **kwargs) -\u003e List[Dict]: source = BeautifulSoup(response, 'html.parser') reply_divs = source.select(\"div.view_reply\") review_div = [div for div in reply_divs if div.select_one(\"div.reply_tit\").text.strip().startswith(\"요리 후기\")] if review_div: review_list = review_div[0].select(\"div.reply_list\") return [map_review(review, recipeId, **kwargs) for review in review_list] else: return list() def map_review(data: Tag, recipeId: str, **kwargs) -\u003e Dict: review_info = dict() review_info[\"reviewId\"] = re_get(rid_ptn, data.select(\"div\")[-1].attrs.get(\"id\")) review_info[\"recipeId\"] = recipeId review_info[\"userId\"] = re_get(uid_ptn, data.select_one(\"a\").attrs.get(\"href\")) review_info[\"contents\"] = select_text(data, \"p.reply_list_cont\") detail = data.select_one(\"h4.media-heading\") if detail: review_info[\"userName\"] = select_text(detail, \"b\") gender = detail.select_one(\"b\").attrs.get(\"class\") review_info[\"userGender\"] = GENDER.get(gender[0]) if gender else None review_info[\"createDate\"] = re_get(date_ptn, detail.text) return review_info 데이터 수집 결과 아래와 같이 정리된 딕셔너리를 얻을 수 있습니다.\n여기서 요리 후기와 별도로 사용자 명칭과 성별을 추출할 수 있습니다.\nCopy python { \"reviewId\": \"395018\", \"recipeId\": \"6843136\", \"userId\": \"58031746\", \"contents\": \"정말 간단한데 중불로하니 좀 태워먹었... 맛은 있네욬ㅋㅋㅋㅋㅋ다음엔 중불이랑 약불 사이로 함 더해바야겠어욬ㅋㅋㅋㄱㅋㅋ감삼둥..♡♡\", \"userName\": \"나찡as\", \"userGender\": \"F\", \"createDate\": \"2020-11-09 17:14:02\" } 댓글 추출 # 레시피 상세 정보 페이지에서 댓글은 미리보기만이 제공되며\n전체 댓글을 확인하기 위해서는 별도의 페이지에 접속해야 합니다.\n해당 페이지의 출력 결과에서도 요리 후기와 같은 방식으로\nHTML 소스를 파싱하여 대상 문자열을 추출해야 합니다.\nCopy python GENDER = {\"info_name_m\":\"M\", \"info_name_f\":\"F\"} uri = \"https://www.10000recipe.com/recipe/\" cid_ptn = \"replyCommentDiv_(\\d+)\" uid_ptn = \"/profile/recipe_comment.html\\?uid=([\\d\\w]+)\" date_ptn = \"(\\d{4}-\\d{2}-\\d{2} \\d{2}:\\d{2})\" def fetch(session: requests.Session, recipeId: str, page=1, **kwargs) -\u003e List[Dict]: url = uri+\"ajax.html\" params = dict(q_mode=\"getListComment\", seq=recipeId, page=page) headers = get_headers(url, referer=uri+recipeId) headers[\"upgrade-insecure-requests\"] = '1' response = session.get(url, params=params, headers=headers) return parse(response.text, recipeId, **kwargs) def parse(response: str, recipeId: str, **kwargs) -\u003e List[Dict]: source = BeautifulSoup(response, 'html.parser') comment_list = source.select(\"div.reply_list\") return [map_comment(comment, recipeId, **kwargs) for comment in comment_list] def map_comment(data: Tag, recipeId: str, **kwargs) -\u003e Dict: comment_info = dict() comment_info[\"commentId\"] = re_get(cid_ptn, data.select(\"div\")[-1].attrs.get(\"id\")) comment_info[\"recipeId\"] = recipeId comment_info[\"userId\"] = re_get(uid_ptn, data.select_one(\"a\").attrs.get(\"href\")) comment_info[\"contents\"] = select_text(data, \"div.media-body\").split('|')[-1] detail = data.select_one(\"h4.media-heading\") if detail: comment_info[\"userName\"] = select_text(detail, \"b\") gender = detail.select_one(\"b\").attrs.get(\"class\") comment_info[\"userGender\"] = GENDER.get(gender[0]) if gender else None comment_info[\"createDate\"] = re_get(date_ptn, detail.text) return comment_info review = fetch(session, \"6843136\") review[0] 데이터 수집 결과 아래와 같이 정리된 딕셔너리를 얻을 수 있습니다.\n데이터 구조는 요리 후기와 동일합니다.\nCopy python { \"commentId\": \"39693405\", \"recipeId\": \"6843136\", \"userId\": \"89382542\", \"contents\": \"신고그러네여..재료양이..ㅜ\", \"userName\": \"휘아여\", \"userGender\": \"F\", \"createDate\": \"2022-03-18 00:02\" } ","wordCount":"1076","inLanguage":"en","datePublished":"2023-03-26T18:52:14+09:00","dateModified":"2023-03-26T18:52:14+09:00","author":{"@type":"Person","name":"minyeamer"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://minyeamer.github.io/blog/10000-recipe/"},"publisher":{"@type":"Person","name":"Minystory","logo":{"@type":"ImageObject","url":"https://minyeamer.github.io/images/favicons/favicon.ico"}}}</script><title>[Python] 만개의 레시피 데이터 수집 | Minystory</title><link rel=icon href=/favicon.png><link rel=manifest href=/manifest.json><link rel=canonical href=https://minyeamer.github.io/blog/10000-recipe/><link rel=stylesheet href=/book.min.da9f864e1bccfac13510edef0c8dbe217c58d1ba58855d698051f162d9101fc5.css integrity="sha256-2p+GThvM+sE1EO3vDI2+IXxY0bpYhV1pgFHxYtkQH8U=" crossorigin=anonymous><script defer src=/fuse.min.js></script><script defer src=/search-input.min.655b3dbc7fa5dba7448e54cadfe1f2f0e2130ce28ac55de3dd121fb6836de1c2.js integrity="sha256-ZVs9vH+l26dEjlTK3+Hy8OITDOKKxV3j3RIftoNt4cI=" crossorigin=anonymous></script><link rel=preload href=/search-data.min.6bf4dc44bbf8ef5af22571f25ab82c5cbc23a3d80b9ec8115b9f75d8123213a4.json as=fetch crossorigin><script>window.SEARCH_DATA_URL="/search-data.min.6bf4dc44bbf8ef5af22571f25ab82c5cbc23a3d80b9ec8115b9f75d8123213a4.json"</script><script defer src=/search.min.f30f9834d4764fd9751da64098c954d01085f648ba9ca421a3c97582f8c47253.js integrity="sha256-8w+YNNR2T9l1HaZAmMlU0BCF9ki6nKQho8l1gvjEclM=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-BJ8Z9RMBPJ"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BJ8Z9RMBPJ")</script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css crossorigin=anonymous><script defer src=/scroll-progress.min.841ade7e507a5f6d59c4e7bf2fe2b2ca034070677ff7957eec55610a024dd776.js integrity="sha256-hBreflB6X21ZxOe/L+KyygNAcGd/95V+7FVhCgJN13Y=" crossorigin=anonymous></script><script defer src=/dark-mode.min.e41c6440ffd9967d6f6a419ff3ce09b862009fe1646ab265f5cb2817d2a508e3.js integrity="sha256-5BxkQP/Zln1vakGf884JuGIAn+FkarJl9csoF9KlCOM=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.9.0/highlightjs-line-numbers.min.js></script><script defer src=/copy-code.min.aaeef965f0b4992e55f976edaecb34a89d414e1791caa18c3f4f4376c6d8b5a8.js integrity="sha256-qu75ZfC0mS5V+Xbtrss0qJ1BTheRyqGMP09DdsbYtag=" crossorigin=anonymous></script><script defer src=/toc-highlightjs.093016f0ef312174ad862fdcf5792e88ab5442bd39beecc38d15643f71ab5c31.min integrity="sha256-CTAW8O8xIXSthi/c9XkuiKtUQr05vuzDjRVkP3GrXDE=" crossorigin=anonymous></script></head><body dir=ltr class="book-kind-page book-type-posts book-layout-post"><div class=scroll-progress><div class=scroll-progress-bar></div></div><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><div class=sidebar-profile><div class=profile-img-wrap><a href=https://minyeamer.github.io/><img src=/images/profile/menu.jpg alt=Profile class=profile-img></a></div><div class=sidebar-social><a href=https://github.com/minyeamer target=_blank title=GitHub><i class="fa-brands fa-github"></i>
</a><a href=/categories/ title=Categories><i class="fa-solid fa-folder"></i>
</a><a href=/tags/ title=Tags><i class="fa-solid fa-tags"></i>
</a><button id=dark-mode-toggle class=dark-mode-toggle aria-label="Toggle dark mode">
<i class="fa-solid fa-circle-half-stroke"></i></button></div></div><h2 class=book-brand><a class="flex align-center" href=/><span>Minystory</span></a></h2><div class="book-search hidden"><div class=search-input-container><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/ onkeydown='event.key==="Enter"&&goToSearchPage()'>
<button type=button id=book-search-button class=book-search-btn onclick=goToSearchPage()>
<i class="fa-solid fa-magnifying-glass"></i></button></div><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden");function goToSearchPage(){const t=document.getElementById("book-search-input"),e=t.value.trim();e&&(window.location.href="/search/?q="+encodeURIComponent(e))}</script><div class=book-categories><input type=checkbox class="hidden toggle" id=categories-control checked>
<label for=categories-control class="categories-toggle categories-link"><a href=/categories/><i class="fa-solid fa-folder"></i>
<span>전체</span>
<span class=category-count>(34)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul class=categories-menu id=categories-menu><li><input type=checkbox class="hidden toggle" id=cat-algorithm>
<label for=cat-algorithm class="categories-toggle categories-link"><a href=/categories/algorithm/><i class="fa-solid fa-folder"></i>
Algorithm
<span class=category-count>(1)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/algorithm/sql/><i class="fa-solid fa-file"></i>
SQL
<span class=category-count>(1)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-cloud>
<label for=cat-cloud class="categories-toggle categories-link"><a href=/categories/cloud/><i class="fa-solid fa-folder"></i>
Cloud
<span class=category-count>(2)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/cloud/kubernetes/><i class="fa-solid fa-file"></i>
Kubernetes
<span class=category-count>(2)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-data-analysis>
<label for=cat-data-analysis class="categories-toggle categories-link"><a href=/categories/data-analysis/><i class="fa-solid fa-folder"></i>
Data Analysis
<span class=category-count>(2)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/data-analysis/dacon/><i class="fa-solid fa-file"></i>
Dacon
<span class=category-count>(2)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-data-engineering>
<label for=cat-data-engineering class="categories-toggle categories-link"><a href=/categories/data-engineering/><i class="fa-solid fa-folder"></i>
Data Engineering
<span class=category-count>(19)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/data-engineering/apache-airflow/><i class="fa-solid fa-file"></i>
Apache Airflow
<span class=category-count>(7)</span></a></li><li class=categories-link><a href=/categories/data-engineering/apache-spark/><i class="fa-solid fa-file"></i>
Apache Spark
<span class=category-count>(8)</span></a></li><li class=categories-link><a href=/categories/data-engineering/crawling/><i class="fa-solid fa-file"></i>
Crawling
<span class=category-count>(4)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-frontend>
<label for=cat-frontend class="categories-toggle categories-link"><a href=/categories/frontend/><i class="fa-solid fa-folder"></i>
Frontend
<span class=category-count>(7)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/frontend/blog/><i class="fa-solid fa-file"></i>
Blog
<span class=category-count>(7)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-linux>
<label for=cat-linux class="categories-toggle categories-link"><a href=/categories/linux/><i class="fa-solid fa-folder"></i>
Linux
<span class=category-count>(1)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/linux/ubuntu/><i class="fa-solid fa-file"></i>
Ubuntu
<span class=category-count>(1)</span></a></li></ul></li><li><input type=checkbox class="hidden toggle" id=cat-project>
<label for=cat-project class="categories-toggle categories-link"><a href=/categories/project/><i class="fa-solid fa-folder"></i>
Project
<span class=category-count>(2)</span>
</a><i class="fa-solid fa-chevron-down categories-arrow"></i></label><ul><li class=categories-link><a href=/categories/project/open-source/><i class="fa-solid fa-file"></i>
Open Source
<span class=category-count>(1)</span></a></li><li class=categories-link><a href=/categories/project/tools/><i class="fa-solid fa-file"></i>
Tools
<span class=category-count>(1)</span></a></li></ul></li></ul></div><div class=recent-posts><div class=recent-posts-header><i class="fa-solid fa-clock"></i>
<span>최신글</span></div><ul class=recent-posts-list><li class=recent-post-item><a href=/blog/hugo-blog-3/ title="Hugo 블로그 만들기 (3) - Taxonomies로 태그/카테고리 페이지 커스터마이징"><div class=recent-post-title>Hugo 블로그 만들기 (3) - Taxonomies로 태그/카테고리 페이지 커스터마이징</div><div class=recent-post-date><time datetime=2025-11-22>2025.11.22</time></div></a></li><li class=recent-post-item><a href=/blog/hugo-blog-2/ title="Hugo 블로그 만들기 (2) - 메인 레이아웃 커스터마이징 (메뉴, 목차, 헤더)"><div class=recent-post-title>Hugo 블로그 만들기 (2) - 메인 레이아웃 커스터마이징 (메뉴, 목차, 헤더)</div><div class=recent-post-date><time datetime=2025-11-04>2025.11.04</time></div></a></li><li class=recent-post-item><a href=/blog/hugo-blog-1/ title="Hugo 블로그 만들기 (1) - 프로젝트 구성과 GitHub Pages 배포 (Submodule 활용)"><div class=recent-post-title>Hugo 블로그 만들기 (1) - 프로젝트 구성과 GitHub Pages 배포 (Submodule 활용)</div><div class=recent-post-date><time datetime=2025-11-01>2025.11.01</time></div></a></li><li class=recent-post-item><a href=/blog/openup-handson/ title="[OSSCA] 2025 오픈소스 컨트리뷰션 아카데미 - PyTorch 문서 한글화 참여 후기"><div class=recent-post-title>[OSSCA] 2025 오픈소스 컨트리뷰션 아카데미 - PyTorch 문서 한글화 참여 후기</div><div class=recent-post-date><time datetime=2025-10-28>2025.10.28</time></div></a></li><li class=recent-post-item><a href=/blog/uv-project/ title="[Python] uv로 프로젝트 구성하고 PyPI 배포하기 - Rust 기반 고속 패키지 관리"><div class=recent-post-title>[Python] uv로 프로젝트 구성하고 PyPI 배포하기 - Rust 기반 고속 패키지 관리</div><div class=recent-post-date><time datetime=2025-07-23>2025.07.23</time></div></a></li></ul></div></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><i class="fa-solid fa-bars book-icon" id=menu-icon></i></label><h3><a href=https://minyeamer.github.io/ class=site-title>Minystory</a></h3><label for=toc-control><i class="fa-solid fa-list book-icon" id=toc-icon></i></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#스키마-구성>스키마 구성</a></li><li><a href=#만개의-레시피-데이터-수집>만개의 레시피 데이터 수집</a><ul><li><a href=#카테고리-추출>카테고리 추출</a></li><li><a href=#레시피-목록-추출>레시피 목록 추출</a></li><li><a href=#레시피-정보-추출>레시피 정보 추출</a></li><li><a href=#요리-후기-추출>요리 후기 추출</a></li><li><a href=#댓글-추출>댓글 추출</a></li></ul></li></ul></nav></aside></header><article class="markdown book-article"><header class=post-header><div class=post-header-category><a href=/categories/data-engineering/crawling/ class=post-header-category-link>Data Engineering/Crawling</a></div><h1 class=post-header-title>[Python] 만개의 레시피 데이터 수집</h1><div class=post-header-date><time datetime=2023-03-26T18:52:14+09:00>2023. 3. 26. 18:52</time></div></header><p>최근 레시피 생성을 목적으로 한 사이드 프로젝트에 참여하게 되었는데<br>모델 학습을 위한 만개의 레시피 데이터 크롤링을 진행해보았습니다.</p><h2 id=스키마-구성>스키마 구성
<a class=anchor href=#%ec%8a%a4%ed%82%a4%eb%a7%88-%ea%b5%ac%ec%84%b1>#</a></h2><p>기존엔 레시피 명칭과 음식 재료 정보만을 수집할 계획이었지만,<br>만개의 레시피의 각 페이지를 살펴보면서 추가적으로 가져갈만한 데이터가 있음을 확인하여<br>우선적으로 테이블 관계 및 스키마를 구성해보았습니다.</p><p><img src="https://github.com/minyeamer/til/blob/main/.media/data/crawling/10000-recipe/schema.png?raw=true" alt=schema></p><p>초기에 만개의 레시피와 공공데이터를 데이터 소스로 삼았기 때문에,<br>만개의 레시피에 대한 DB <code>_10000</code>, 공공데이터에 대한 DB <code>food</code>로 구성했습니다.</p><p><code>_10000</code> DB 내 테이블은 만개의 레시피 내 각각의 페이지에서 가져온 데이터로 구성되며,<br>크게 카테고리, 레시피, 사용자 단위로 구분할 수 있습니다.</p><h2 id=만개의-레시피-데이터-수집>만개의 레시피 데이터 수집
<a class=anchor href=#%eb%a7%8c%ea%b0%9c%ec%9d%98-%eb%a0%88%ec%8b%9c%ed%94%bc-%eb%8d%b0%ec%9d%b4%ed%84%b0-%ec%88%98%ec%a7%91>#</a></h2><p>크롤링에서 데이터 요청 및 가공을 위해 정의된 유틸리티 함수들이 있는데,<br>별도로 코드를 보여주지는 않고 해당 함수가 호출될 때 간단히 어떤 동작을 하는지만 전달드립니다.</p><h3 id=카테고리-추출>카테고리 추출
<a class=anchor href=#%ec%b9%b4%ed%85%8c%ea%b3%a0%eb%a6%ac-%ec%b6%94%ec%b6%9c>#</a></h3><p>만개의 레시피 카테고리는 레시피 검색 페이지에서 간단하게 추출할 수 있으므로,<br>개발자 도구 또는 requests에 대한 응답에서 카테고리에 해당하는 부분을 가져옵니다.<br>여기서 <code>get_headers()</code> 함수는 <code>User-Agent</code> 등 기본적인 브라우저 정보가 담긴 헤더를 반환합니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s2>&#34;https://www.10000recipe.com/recipe/list.html&#34;</span>
</span></span><span class=line><span class=cl><span class=n>headers</span> <span class=o>=</span> <span class=n>get_headers</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>referer</span><span class=o>=</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>headers</span><span class=p>[</span><span class=s2>&#34;upgrade-insecure-requests&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;1&#39;</span>
</span></span><span class=line><span class=cl><span class=n>response</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>source</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=s2>&#34;html.parser&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cate_list</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>select_one</span><span class=p>(</span><span class=s2>&#34;div.cate_list&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pattern</span> <span class=o>=</span> <span class=s2>&#34;javascript:goSearchRecipe([\d\w()&#39;,]+)&#34;</span>
</span></span><span class=line><span class=cl><span class=n>raw_cat</span> <span class=o>=</span> <span class=p>[(</span><span class=n>re_get</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>cat</span><span class=o>.</span><span class=n>attrs</span><span class=p>[</span><span class=s2>&#34;href&#34;</span><span class=p>]),</span><span class=n>cat</span><span class=o>.</span><span class=n>text</span><span class=p>)</span> <span class=k>for</span> <span class=n>cat</span> <span class=ow>in</span> <span class=n>cate_list</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;a&#34;</span><span class=p>)</span> <span class=k>if</span> <span class=s2>&#34;href&#34;</span> <span class=ow>in</span> <span class=n>cat</span><span class=o>.</span><span class=n>attrs</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>cat_map</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>catType</span><span class=p>,</span> <span class=n>catId</span><span class=p>,</span> <span class=n>catName</span><span class=p>:</span> <span class=p>{</span><span class=s2>&#34;categoryId&#34;</span><span class=p>:</span><span class=n>catId</span><span class=p>,</span> <span class=s2>&#34;categoryType&#34;</span><span class=p>:</span><span class=n>catType</span><span class=p>,</span> <span class=s2>&#34;categoryName&#34;</span><span class=p>:</span><span class=n>catName</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>categories</span> <span class=o>=</span> <span class=p>[</span><span class=n>cat_map</span><span class=p>(</span><span class=o>*</span><span class=n>literal_eval</span><span class=p>(</span><span class=n>data</span><span class=p>),</span> <span class=n>name</span><span class=p>)</span> <span class=k>for</span> <span class=n>data</span><span class=p>,</span> <span class=n>name</span> <span class=ow>in</span> <span class=n>raw_cat</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>categories</span> <span class=o>=</span> <span class=n>pd</span><span class=o>.</span><span class=n>DataFrame</span><span class=p>(</span><span class=n>categories</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>categories</span> <span class=o>=</span> <span class=n>categories</span><span class=p>[</span><span class=n>categories</span><span class=p>[</span><span class=s2>&#34;categoryId&#34;</span><span class=p>]</span><span class=o>!=</span><span class=s1>&#39;&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>categories</span><span class=o>.</span><span class=n>head</span><span class=p>()</span></span></span></code></pre></div></div><p>데이터 수집 결과 아래와 같은 구조의 데이터를 획득할 수 있습니다.</p><table><thead><tr><th style=text-align:center>categoryId</th><th style=text-align:center>categoryType</th><th style=text-align:center>categoryName</th></tr></thead><tbody><tr><td style=text-align:center>63</td><td style=text-align:center>cat4</td><td style=text-align:center>밑반찬</td></tr><tr><td style=text-align:center>56</td><td style=text-align:center>cat4</td><td style=text-align:center>메인반찬</td></tr><tr><td style=text-align:center>54</td><td style=text-align:center>cat4</td><td style=text-align:center>국/탕</td></tr><tr><td style=text-align:center>55</td><td style=text-align:center>cat4</td><td style=text-align:center>찌개</td></tr><tr><td style=text-align:center>60</td><td style=text-align:center>cat4</td><td style=text-align:center>디저트</td></tr></tbody></table><h3 id=레시피-목록-추출>레시피 목록 추출
<a class=anchor href=#%eb%a0%88%ec%8b%9c%ed%94%bc-%eb%aa%a9%eb%a1%9d-%ec%b6%94%ec%b6%9c>#</a></h3><p>레시피 검색 페이지는 검색어, 정렬 기준, 페이지, 카테고리를 쿼리로 받습니다.<br>레시피 목록을 추출하는데 검색어나 카테고리는 필요하지 않고 동일한 정렬 기준에서 수집하기 때문에<br>데이터 수집 시에는 페이지에 반복문을 적용하여 데이터가 존재하는 범위를 가져올 것입니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>ORDER_MAP</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;정확순&#34;</span><span class=p>:</span><span class=s2>&#34;accuracy&#34;</span><span class=p>,</span> <span class=s2>&#34;최신순&#34;</span><span class=p>:</span><span class=s2>&#34;date&#34;</span><span class=p>,</span> <span class=s2>&#34;추천순&#34;</span><span class=p>:</span><span class=s2>&#34;reco&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>get_params</span> <span class=o>=</span> <span class=k>lambda</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>:</span> <span class=p>{</span><span class=n>k</span><span class=p>:</span><span class=n>v</span> <span class=k>for</span> <span class=n>k</span><span class=p>,</span><span class=n>v</span> <span class=ow>in</span> <span class=n>kwargs</span><span class=o>.</span><span class=n>items</span><span class=p>()</span> <span class=k>if</span> <span class=n>v</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>uri</span> <span class=o>=</span> <span class=s2>&#34;https://www.10000recipe.com/recipe/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fetch</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span> <span class=n>query</span><span class=o>=</span><span class=nb>str</span><span class=p>(),</span> <span class=n>sortType</span><span class=o>=</span><span class=s2>&#34;추천순&#34;</span><span class=p>,</span> <span class=n>page</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=n>cat1</span><span class=o>=</span><span class=nb>str</span><span class=p>(),</span> <span class=n>cat2</span><span class=o>=</span><span class=nb>str</span><span class=p>(),</span> <span class=n>cat3</span><span class=o>=</span><span class=nb>str</span><span class=p>(),</span> <span class=n>cat4</span><span class=o>=</span><span class=nb>str</span><span class=p>(),</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=n>uri</span><span class=o>+</span><span class=s2>&#34;list.html&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=n>get_params</span><span class=p>(</span><span class=n>q</span><span class=o>=</span><span class=n>query</span><span class=p>,</span> <span class=n>order</span><span class=o>=</span><span class=n>ORDER_MAP</span><span class=p>[</span><span class=n>sortType</span><span class=p>],</span> <span class=n>page</span><span class=o>=</span><span class=n>page</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                        <span class=n>cat1</span><span class=o>=</span><span class=n>cat1</span><span class=p>,</span> <span class=n>cat2</span><span class=o>=</span><span class=n>cat2</span><span class=p>,</span> <span class=n>cat3</span><span class=o>=</span><span class=n>cat3</span><span class=p>,</span> <span class=n>cat4</span><span class=o>=</span><span class=n>cat4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>headers</span> <span class=o>=</span> <span class=n>get_headers</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>referer</span><span class=o>=</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>headers</span><span class=p>[</span><span class=s2>&#34;upgrade-insecure-requests&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;1&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>parse</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=n>response</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=n>source</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=s1>&#39;html.parser&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>uris</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;a.common_sp_link&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ids</span> <span class=o>=</span> <span class=p>[</span><span class=n>uri</span><span class=o>.</span><span class=n>attrs</span><span class=p>[</span><span class=s2>&#34;href&#34;</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span> <span class=k>for</span> <span class=n>uri</span> <span class=ow>in</span> <span class=n>uris</span> <span class=k>if</span> <span class=s2>&#34;href&#34;</span> <span class=ow>in</span> <span class=n>uri</span><span class=o>.</span><span class=n>attrs</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ids</span></span></span></code></pre></div></div><p>데이터 수집 결과로는 문자열 타입의 레시피 ID 목록을 획득할 수 있습니다.</p><h3 id=레시피-정보-추출>레시피 정보 추출
<a class=anchor href=#%eb%a0%88%ec%8b%9c%ed%94%bc-%ec%a0%95%eb%b3%b4-%ec%b6%94%ec%b6%9c>#</a></h3><p>레시피 ID로 접근할 수 있는 레시피 상세 정보 페이지에서<br>레시피 정보에 대한 데이터를 추출합니다.
소스코드 내에서 레시피 정보가 JSON 형식으로 존재하기 때문에<br>일일히 HTML 태그를 파싱할 필요 없이 데이터를 한번에 JSON 오브젝트로 가져올 수 있습니다.</p><p>데이터를 가공하는 <code>map_recipe()</code> 함수 내에서<br><code>cast_int()</code>는 데이터를 정수형으로 변환할 때 에러가 발생하면 기본값 0을 반환하는 함수이고,<br><code>hier_get()</code>은 중첩 딕셔너리의에 단계별 키 목록에 대한 값을 안전하게 가져오기 위한 함수입니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>uri</span> <span class=o>=</span> <span class=s2>&#34;https://www.10000recipe.com/recipe/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fetch</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=n>uri</span><span class=o>+</span><span class=n>recipeId</span> <span class=c1># https://www.10000recipe.com/recipe/6997297</span>
</span></span><span class=line><span class=cl>    <span class=n>headers</span> <span class=o>=</span> <span class=n>get_headers</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>referer</span><span class=o>=</span><span class=n>uri</span><span class=o>+</span><span class=s2>&#34;list.html&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>headers</span><span class=p>[</span><span class=s2>&#34;upgrade-insecure-requests&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;1&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>parse</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=n>response</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>source</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=s1>&#39;html.parser&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>raw_json</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>select_one</span><span class=p>(</span><span class=s2>&#34;script[type=</span><span class=se>\&#34;</span><span class=s2>application/ld+json</span><span class=se>\&#34;</span><span class=s2>]&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>text</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>raw_json</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span> <span class=n>data</span> <span class=o>=</span> <span class=n>literal_eval</span><span class=p>(</span><span class=n>raw_json</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>map_recipe</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>,</span> <span class=n>source</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>map_recipe</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>source</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>recipe_info</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;recipeId&#34;</span><span class=p>:</span> <span class=n>recipeId</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>recipe_info</span><span class=p>[</span><span class=s2>&#34;name&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;name&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>recipe_info</span><span class=p>[</span><span class=s2>&#34;author&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>hier_get</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;author&#34;</span><span class=p>,</span><span class=s2>&#34;name&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>recipe_info</span><span class=p>[</span><span class=s2>&#34;ratingValue&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>cast_int</span><span class=p>(</span><span class=n>hier_get</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;aggregateRating&#34;</span><span class=p>,</span><span class=s2>&#34;ratingValue&#34;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=n>recipe_info</span><span class=p>[</span><span class=s2>&#34;reviewCount&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>cast_int</span><span class=p>(</span><span class=n>hier_get</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=p>[</span><span class=s2>&#34;aggregateRating&#34;</span><span class=p>,</span><span class=s2>&#34;reviewCount&#34;</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=n>recipe_info</span><span class=p>[</span><span class=s2>&#34;totalTime&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;totalTime&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>recipe_info</span><span class=p>[</span><span class=s2>&#34;recipeYield&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;recipeYield&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span> <span class=n>recipe_info</span><span class=p>[</span><span class=s2>&#34;recipeIngredient&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;,&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>data</span><span class=p>[</span><span class=s2>&#34;recipeIngredient&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span> <span class=n>recipe_info</span><span class=p>[</span><span class=s2>&#34;recipeIngredient&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>extract_ingredient</span><span class=p>(</span><span class=n>source</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>recipe_info</span><span class=p>[</span><span class=s2>&#34;recipeInstructions&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=se>\n</span><span class=s1>&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>step</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;text&#34;</span><span class=p>,</span><span class=nb>str</span><span class=p>())</span> <span class=k>for</span> <span class=n>step</span> <span class=ow>in</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;recipeInstructions&#34;</span><span class=p>,</span><span class=nb>list</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>step</span><span class=p>,</span> <span class=nb>dict</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>    <span class=n>recipe_info</span><span class=p>[</span><span class=s2>&#34;createDate&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;datePublished&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>recipe_info</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>extract_ingredient</span><span class=p>(</span><span class=n>source</span><span class=p>:</span> <span class=n>Tag</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>cont_ingre</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>select_one</span><span class=p>(</span><span class=s2>&#34;div.cont_ingre&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>cont_ingre</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>ingre</span><span class=o>.</span><span class=n>split</span><span class=p>()</span> <span class=k>for</span> <span class=n>ingre</span> <span class=ow>in</span> <span class=n>cont_ingre</span><span class=o>.</span><span class=n>select_one</span><span class=p>(</span><span class=s2>&#34;dd&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span> <span class=k>return</span> <span class=nb>str</span><span class=p>()</span></span></span></code></pre></div></div><p>데이터 수집 결과 아래와 같이 정리된 딕셔너리를 얻을 수 있습니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;recipeId&#34;</span><span class=p>:</span> <span class=s2>&#34;6997297&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;name&#34;</span><span class=p>:</span> <span class=s2>&#34;두부짜조&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;author&#34;</span><span class=p>:</span> <span class=s2>&#34;호이호이&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ratingValue&#34;</span><span class=p>:</span> <span class=mi>5</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;reviewCount&#34;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;totalTime&#34;</span><span class=p>:</span> <span class=s2>&#34;PT20M&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;recipeYield&#34;</span><span class=p>:</span> <span class=s2>&#34;1 servings&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;recipeIngredient&#34;</span><span class=p>:</span> <span class=s2>&#34;두부 30g,라이스페이퍼 2장,돼지고기 5g,...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;recipeInstructions&#34;</span><span class=p>:</span> <span class=s2>&#34;부위는 상관없지만 저는 저렴하고...&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;createDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2023-02-19T13:37:04+09:00&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>실질적으로 활용할 데이터는 레시피명 <code>name</code>과 재료명인 <code>recipeIngredient</code>이며,<br>평점, 리뷰 수, 조리순서 등도 추가적인 분석을 통해 활용성을 기대해볼 수 있습니다.</p><h3 id=요리-후기-추출>요리 후기 추출
<a class=anchor href=#%ec%9a%94%eb%a6%ac-%ed%9b%84%ea%b8%b0-%ec%b6%94%ec%b6%9c>#</a></h3><p>동일한 레시피 상세 정보 페이지에서 요리 후기에 대한 데이터를 추출할 수 있습니다.</p><p>단, 요리 후기는 JSON 형식으로 정리되어 있지 않기 때문에<br>HTML 소스를 파싱하여 대상 문자열을 추출해야 합니다.</p><p>데이터를 가공하는 <code>map_review()</code> 함수 내에서<br><code>re_get()</code>은 정규표현식 패턴에 매칭되는 문자열을 추출하는 함수이고,<br><code>select_text()</code>는 BeautifulSoup 태그에서<br>CSS Selector로 안전하게 문자열을 추출하는 함수입니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>GENDER</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;info_name_m&#34;</span><span class=p>:</span><span class=s2>&#34;M&#34;</span><span class=p>,</span> <span class=s2>&#34;info_name_f&#34;</span><span class=p>:</span><span class=s2>&#34;F&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>uri</span> <span class=o>=</span> <span class=s2>&#34;https://www.10000recipe.com/recipe/&#34;</span>
</span></span><span class=line><span class=cl><span class=n>rid_ptn</span> <span class=o>=</span> <span class=s2>&#34;replyReviewDiv_(\d+)&#34;</span>
</span></span><span class=line><span class=cl><span class=n>uid_ptn</span> <span class=o>=</span> <span class=s2>&#34;/profile/review.html\?uid=([\d\w]+)&#34;</span>
</span></span><span class=line><span class=cl><span class=n>date_ptn</span> <span class=o>=</span> <span class=s2>&#34;(\d</span><span class=si>{4}</span><span class=s2>-\d</span><span class=si>{2}</span><span class=s2>-\d</span><span class=si>{2}</span><span class=s2> \d</span><span class=si>{2}</span><span class=s2>:\d</span><span class=si>{2}</span><span class=s2>:\d</span><span class=si>{2}</span><span class=s2>)&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fetch</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=n>uri</span><span class=o>+</span><span class=n>recipeId</span>
</span></span><span class=line><span class=cl>    <span class=n>headers</span> <span class=o>=</span> <span class=n>get_headers</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>referer</span><span class=o>=</span><span class=n>uri</span><span class=o>+</span><span class=s2>&#34;list.html&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>headers</span><span class=p>[</span><span class=s2>&#34;upgrade-insecure-requests&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;1&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>parse</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=n>response</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=n>source</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=s1>&#39;html.parser&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>reply_divs</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;div.view_reply&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>review_div</span> <span class=o>=</span> <span class=p>[</span><span class=n>div</span> <span class=k>for</span> <span class=n>div</span> <span class=ow>in</span> <span class=n>reply_divs</span> <span class=k>if</span> <span class=n>div</span><span class=o>.</span><span class=n>select_one</span><span class=p>(</span><span class=s2>&#34;div.reply_tit&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;요리 후기&#34;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>review_div</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>review_list</span> <span class=o>=</span> <span class=n>review_div</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;div.reply_list&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>map_review</span><span class=p>(</span><span class=n>review</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=k>for</span> <span class=n>review</span> <span class=ow>in</span> <span class=n>review_list</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span> <span class=k>return</span> <span class=nb>list</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>map_review</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=n>Tag</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>review_info</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>review_info</span><span class=p>[</span><span class=s2>&#34;reviewId&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>re_get</span><span class=p>(</span><span class=n>rid_ptn</span><span class=p>,</span> <span class=n>data</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;div&#34;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>attrs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>review_info</span><span class=p>[</span><span class=s2>&#34;recipeId&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>recipeId</span>
</span></span><span class=line><span class=cl>    <span class=n>review_info</span><span class=p>[</span><span class=s2>&#34;userId&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>re_get</span><span class=p>(</span><span class=n>uid_ptn</span><span class=p>,</span> <span class=n>data</span><span class=o>.</span><span class=n>select_one</span><span class=p>(</span><span class=s2>&#34;a&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>attrs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;href&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>review_info</span><span class=p>[</span><span class=s2>&#34;contents&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>select_text</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=s2>&#34;p.reply_list_cont&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>detail</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>select_one</span><span class=p>(</span><span class=s2>&#34;h4.media-heading&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>detail</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>review_info</span><span class=p>[</span><span class=s2>&#34;userName&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>select_text</span><span class=p>(</span><span class=n>detail</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>gender</span> <span class=o>=</span> <span class=n>detail</span><span class=o>.</span><span class=n>select_one</span><span class=p>(</span><span class=s2>&#34;b&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>attrs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;class&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>review_info</span><span class=p>[</span><span class=s2>&#34;userGender&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>GENDER</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>gender</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=k>if</span> <span class=n>gender</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=n>review_info</span><span class=p>[</span><span class=s2>&#34;createDate&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>re_get</span><span class=p>(</span><span class=n>date_ptn</span><span class=p>,</span> <span class=n>detail</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>review_info</span></span></span></code></pre></div></div><p>데이터 수집 결과 아래와 같이 정리된 딕셔너리를 얻을 수 있습니다.</p><p>여기서 요리 후기와 별도로 사용자 명칭과 성별을 추출할 수 있습니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;reviewId&#34;</span><span class=p>:</span> <span class=s2>&#34;395018&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;recipeId&#34;</span><span class=p>:</span> <span class=s2>&#34;6843136&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;userId&#34;</span><span class=p>:</span> <span class=s2>&#34;58031746&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;contents&#34;</span><span class=p>:</span> <span class=s2>&#34;정말 간단한데 중불로하니 좀 태워먹었... 맛은 있네욬ㅋㅋㅋㅋㅋ다음엔 중불이랑 약불 사이로 함 더해바야겠어욬ㅋㅋㅋㄱㅋㅋ감삼둥..♡♡&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;userName&#34;</span><span class=p>:</span> <span class=s2>&#34;나찡as&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;userGender&#34;</span><span class=p>:</span> <span class=s2>&#34;F&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;createDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2020-11-09 17:14:02&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><h3 id=댓글-추출>댓글 추출
<a class=anchor href=#%eb%8c%93%ea%b8%80-%ec%b6%94%ec%b6%9c>#</a></h3><p>레시피 상세 정보 페이지에서 댓글은 미리보기만이 제공되며<br>전체 댓글을 확인하기 위해서는 별도의 페이지에 접속해야 합니다.</p><p>해당 페이지의 출력 결과에서도 요리 후기와 같은 방식으로<br>HTML 소스를 파싱하여 대상 문자열을 추출해야 합니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>GENDER</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&#34;info_name_m&#34;</span><span class=p>:</span><span class=s2>&#34;M&#34;</span><span class=p>,</span> <span class=s2>&#34;info_name_f&#34;</span><span class=p>:</span><span class=s2>&#34;F&#34;</span><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=n>uri</span> <span class=o>=</span> <span class=s2>&#34;https://www.10000recipe.com/recipe/&#34;</span>
</span></span><span class=line><span class=cl><span class=n>cid_ptn</span> <span class=o>=</span> <span class=s2>&#34;replyCommentDiv_(\d+)&#34;</span>
</span></span><span class=line><span class=cl><span class=n>uid_ptn</span> <span class=o>=</span> <span class=s2>&#34;/profile/recipe_comment.html\?uid=([\d\w]+)&#34;</span>
</span></span><span class=line><span class=cl><span class=n>date_ptn</span> <span class=o>=</span> <span class=s2>&#34;(\d</span><span class=si>{4}</span><span class=s2>-\d</span><span class=si>{2}</span><span class=s2>-\d</span><span class=si>{2}</span><span class=s2> \d</span><span class=si>{2}</span><span class=s2>:\d</span><span class=si>{2}</span><span class=s2>)&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>fetch</span><span class=p>(</span><span class=n>session</span><span class=p>:</span> <span class=n>requests</span><span class=o>.</span><span class=n>Session</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>page</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=n>uri</span><span class=o>+</span><span class=s2>&#34;ajax.html&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>params</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=n>q_mode</span><span class=o>=</span><span class=s2>&#34;getListComment&#34;</span><span class=p>,</span> <span class=n>seq</span><span class=o>=</span><span class=n>recipeId</span><span class=p>,</span> <span class=n>page</span><span class=o>=</span><span class=n>page</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>headers</span> <span class=o>=</span> <span class=n>get_headers</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>referer</span><span class=o>=</span><span class=n>uri</span><span class=o>+</span><span class=n>recipeId</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>headers</span><span class=p>[</span><span class=s2>&#34;upgrade-insecure-requests&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;1&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span> <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>parse</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=n>response</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Dict</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=n>source</span> <span class=o>=</span> <span class=n>BeautifulSoup</span><span class=p>(</span><span class=n>response</span><span class=p>,</span> <span class=s1>&#39;html.parser&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>comment_list</span> <span class=o>=</span> <span class=n>source</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;div.reply_list&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>map_comment</span><span class=p>(</span><span class=n>comment</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=k>for</span> <span class=n>comment</span> <span class=ow>in</span> <span class=n>comment_list</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>map_comment</span><span class=p>(</span><span class=n>data</span><span class=p>:</span> <span class=n>Tag</span><span class=p>,</span> <span class=n>recipeId</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=o>**</span><span class=n>kwargs</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>comment_info</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>comment_info</span><span class=p>[</span><span class=s2>&#34;commentId&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>re_get</span><span class=p>(</span><span class=n>cid_ptn</span><span class=p>,</span> <span class=n>data</span><span class=o>.</span><span class=n>select</span><span class=p>(</span><span class=s2>&#34;div&#34;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>attrs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;id&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>comment_info</span><span class=p>[</span><span class=s2>&#34;recipeId&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>recipeId</span>
</span></span><span class=line><span class=cl>    <span class=n>comment_info</span><span class=p>[</span><span class=s2>&#34;userId&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>re_get</span><span class=p>(</span><span class=n>uid_ptn</span><span class=p>,</span> <span class=n>data</span><span class=o>.</span><span class=n>select_one</span><span class=p>(</span><span class=s2>&#34;a&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>attrs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;href&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>comment_info</span><span class=p>[</span><span class=s2>&#34;contents&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>select_text</span><span class=p>(</span><span class=n>data</span><span class=p>,</span> <span class=s2>&#34;div.media-body&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>detail</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>select_one</span><span class=p>(</span><span class=s2>&#34;h4.media-heading&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>detail</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>comment_info</span><span class=p>[</span><span class=s2>&#34;userName&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>select_text</span><span class=p>(</span><span class=n>detail</span><span class=p>,</span> <span class=s2>&#34;b&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>gender</span> <span class=o>=</span> <span class=n>detail</span><span class=o>.</span><span class=n>select_one</span><span class=p>(</span><span class=s2>&#34;b&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>attrs</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;class&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>comment_info</span><span class=p>[</span><span class=s2>&#34;userGender&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>GENDER</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>gender</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=k>if</span> <span class=n>gender</span> <span class=k>else</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=n>comment_info</span><span class=p>[</span><span class=s2>&#34;createDate&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>re_get</span><span class=p>(</span><span class=n>date_ptn</span><span class=p>,</span> <span class=n>detail</span><span class=o>.</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>comment_info</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>review</span> <span class=o>=</span> <span class=n>fetch</span><span class=p>(</span><span class=n>session</span><span class=p>,</span> <span class=s2>&#34;6843136&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>review</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span></span></span></code></pre></div></div><p>데이터 수집 결과 아래와 같이 정리된 딕셔너리를 얻을 수 있습니다.</p><p>데이터 구조는 요리 후기와 동일합니다.</p><div class=book-codeblock data-lang=python><div class=code-actions><button class="code-copy-btn code-action" onclick=copyCode(this)>
<i class="fa-solid fa-copy"></i>Copy
</button>
<span class="code-language code-action">python</span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;commentId&#34;</span><span class=p>:</span> <span class=s2>&#34;39693405&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;recipeId&#34;</span><span class=p>:</span> <span class=s2>&#34;6843136&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;userId&#34;</span><span class=p>:</span> <span class=s2>&#34;89382542&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;contents&#34;</span><span class=p>:</span> <span class=s2>&#34;신고그러네여..재료양이..ㅜ&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;userName&#34;</span><span class=p>:</span> <span class=s2>&#34;휘아여&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;userGender&#34;</span><span class=p>:</span> <span class=s2>&#34;F&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;createDate&#34;</span><span class=p>:</span> <span class=s2>&#34;2022-03-18 00:02&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></article><div class=book-nav><button class=book-nav-btn3 onclick='window.scrollTo({top:0,behavior:"smooth"})' title="Go to top">
<i class="fa fa-chevron-up"></i>
</button>
<button class=book-nav-btn3 onclick='window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"})' title="Go to bottom">
<i class="fa fa-chevron-down"></i>
<button class=book-nav-btn3 onclick=history.back() title="Go back">
<i class="fa-solid fa-arrow-left"></i></button></div><footer class=book-footer><div class="flex flex-wrap justify-between"><div></div><div></div></div><div class=post-tags><a href=/tags/crawling/ class=tag>#Crawling</a>
<a href=/tags/python/ class=tag>#Python</a>
<a href=/tags/%EB%A7%8C%EA%B0%9C%EC%9D%98%EB%A0%88%EC%8B%9C%ED%94%BC/ class=tag>#만개의레시피</a>
<a href=/tags/%ED%81%AC%EB%A1%A4%EB%A7%81/ class=tag>#크롤링</a></div><div class=post-navigation><a href=/blog/smartstore-login-3/ class="post-nav-link post-nav-prev"><span class=post-nav-direction><i class="fa-solid fa-backward"></i> PREV</span>
<span class=post-nav-title>[Python] requests로 네이버 스마트스토어센터 로그인 구현하기 (3)</span>
</a><a href class="post-nav-link post-nav-next post-nav-disabled"><span class=post-nav-direction>NEXT <i class="fa-solid fa-forward"></i></span>
<span class=post-nav-title>다음 게시글이 없습니다</span></a></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script><div class=book-comments><div id=disqus_thread></div><script>var disqus_config=function(){this.page.url="https://minyeamer.github.io/blog/10000-recipe/",this.page.identifier="https://minyeamer.github.io/blog/10000-recipe/"};(function(){var e=document,t=e.createElement("script");t.src="https://minyeamer.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})();function reloadDisqus(){window.DISQUS&&DISQUS.reset({reload:!0,config:function(){this.page.url="https://minyeamer.github.io/blog/10000-recipe/",this.page.identifier="https://minyeamer.github.io/blog/10000-recipe/"}})}</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></footer><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#스키마-구성>스키마 구성</a></li><li><a href=#만개의-레시피-데이터-수집>만개의 레시피 데이터 수집</a><ul><li><a href=#카테고리-추출>카테고리 추출</a></li><li><a href=#레시피-목록-추출>레시피 목록 추출</a></li><li><a href=#레시피-정보-추출>레시피 정보 추출</a></li><li><a href=#요리-후기-추출>요리 후기 추출</a></li><li><a href=#댓글-추출>댓글 추출</a></li></ul></li></ul></nav></div></aside></main></body></html>