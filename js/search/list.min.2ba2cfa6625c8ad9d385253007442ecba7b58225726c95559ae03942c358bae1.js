document.addEventListener("DOMContentLoaded",function(){if(!window.location.pathname.startsWith("/search/"))return;const s=new URLSearchParams(window.location.search),t={query:s.get("query")||"",category1:s.get("category1")||"",category2:s.get("category2")||"",tags:s.get("tags")?[...new Set(s.get("tags").split(",").map(e=>e.trim()).filter(e=>e))]:[],tagsOp:s.get("tagsOp")||"and",page:Math.max(1,parseInt(s.get("page"))||1),pageSize:Math.max(1,parseInt(s.get("pageSize"))||10)},v=P(t),l="search-filter-expanded",E={"search.action.label":"검색","search.input.placeholder":"검색어를 입력해주세요","search.results.title":"검색 결과","search.count.label":'"%q" 검색 결과 %s',"search.tags.title":"검색 태그","list.count.label":"전체 글 %s","categories.parent.subtutle":"상위 카테고리","categories.child.subtutle":"하위 카테고리","tags.terms.title":"태그","tags.op.checkbox":"모두 일치","search.filters.toggle":"고급 필터","post.prev.link":"이전","post.next.link":"다음"};function n(e){return window.siteI18n&&typeof window.siteI18n.translate=="function"?window.siteI18n.translate(e,E[e]):E[e]}function e(e,t={}){const n=document.createElement(e);return t.text&&(n.textContent=t.text),t.html&&(n.innerHTML=t.html),t.className&&(n.className=t.className),t.id&&(n.id=t.id),t.attrs&&Object.entries(t.attrs).forEach(([e,t])=>{n.setAttribute(e,t)}),t.dataset&&Object.entries(t.dataset).forEach(([e,t])=>{n.dataset[e]=t}),t.styles&&Object.entries(t.styles).forEach(([e,t])=>{n.style[e]=t}),n}const F=document.querySelector("#search-data"),h=document.querySelector("#search-results"),O=document.querySelector("#search-no-results"),d=document.querySelector("#list-header");switch(v){case"search":Promise.all([window.siteSearch.initIndex(),window.siteSearch.initCategories(),window.siteSearch.initTags()]).then(()=>{const e=N(t,!0);i(e,t)});break;case"category1":window.siteSearch.initCategories().then(()=>{const e=C(t,!0);i(e,t)});break;case"category2":window.siteSearch.initCategories().then(()=>{const e=_(t,!0);i(e,t)});break;case"tags":window.siteSearch.initTags().then(()=>{const e=y(t,!0);i(e,t)});break;case"combined":Promise.all([window.siteSearch.initIndex(),window.siteSearch.initCategories(),window.siteSearch.initTags()]).then(()=>{const e=H(t,!0);i(e,t)});break;default:Promise.all([window.siteSearch.initIndex(),window.siteSearch.initCategories(),window.siteSearch.initTags()]).then(()=>{c(),o({i18nId:"search.results.title",icon:"fa-file-lines"},0,""),i(new Set)});break}function P(e){const s=e.query.length>0,t=e.category1.length>0,o=e.category2.length>0,n=e.tags.length>0;return s?t|n?"combined":"search":t?o?"category2":"category1":n?"tags":"none"}function w(e){return e?e.split(" ").map(e=>e?e.charAt(0).toUpperCase()+e.slice(1):"").join(" "):""}function u(e=!1){const n=new URLSearchParams,s=document.querySelector("#search-query-input");if(s&&s.value.trim()&&n.set("query",s.value.trim()),e)t.category1&&n.set("category1",t.category1),t.category2&&n.set("category2",t.category2),t.tags.length>0&&(n.set("tags",t.tags.join(",")),n.set("tagsOp",t.tagsOp));else{const s=document.querySelector("#filter-category1-chips"),t=s?.querySelector(".search-filter-chip");if(t){n.set("category1",t.dataset.name);const s=document.querySelector("#filter-category2-chips"),e=s?.querySelector(".search-filter-chip");e&&n.set("category2",e.dataset.name)}const o=document.querySelector("#filter-tags-chips"),e=o?.querySelectorAll(".search-filter-chip");if(e&&e.length>0){const s=Array.from(e).map(e=>e.dataset.name);n.set("tags",s.join(","));const t=document.querySelector("#filter-tagsOp");t&&n.set("tagsOp",t.checked?"and":"or")}}return`/search/?${n.toString()}`}function c(){d.replaceChildren();const e=document.querySelector("#taxonomy-section");e.classList.contains("hidden")&&(e.classList.add("hidden"),e.replaceChildren())}function o(t,s,o=""){const a=document.createDocumentFragment(),i=e("h1");t.icon&&(i.appendChild(e("i",{className:`fa-solid ${t.icon}`})),i.appendChild(document.createTextNode(" "))),t.i18nId?i.appendChild(e("span",{text:n(t.i18nId),dataset:{i18nId:t.i18nId,i18nText:""}})):i.appendChild(e("span",{text:t.text||""})),a.appendChild(i);const r=o?"search.count.label":"list.count.label",l=o?`{"%q": "${o}", "%s": "$.list-count"}`:'{"%s": "$.list-count"}',c=n(r),u=`<em class="list-count">${s}</em>`;a.appendChild(e("p",{html:(o?c.replace("%q",o):c).replace("%s",u),dataset:{i18nId:r,i18nText:l}})),d.appendChild(a)}function f(t,s){const o=document.createDocumentFragment(),i=document.querySelector("#taxonomy-section");i.classList.remove("hidden");const r=e("h2",{text:n(t),dataset:{i18nId:t,i18nText:""}}),a=e("div",{className:"taxonomy-chips"});s.forEach(e=>{a.appendChild(B(e))}),o.appendChild(r),o.appendChild(a),i.appendChild(o)}function B({text:t,icon:n,href:s,pageCount:o}){const i=e("div",{className:"taxonomy-chip"}),a=e("a",{className:"taxonomy-link",attrs:{href:s}}),r=`<span class="taxonomy-count">(${o})</span>`;return a.appendChild(e("span",{className:"taxonomy-name",html:`<i class="fa-solid ${n}"></i> ${t} ${r}`})),i.appendChild(a),i}function b({hasAdvancedFilter:t=!1,queryValue:s=""}={}){const i=e("div",{className:"search-query-row"}),o=e("div",{className:"query-input-wrapper"}),a=e("i",{className:"fa-solid fa-magnifying-glass search-query-icon"});o.appendChild(a);const r=n("search.input.placeholder"),c=e("input",{id:"search-query-input",className:"search-query-input",attrs:{type:"text",maxLength:64,placeholder:r,value:s},dataset:{i18nId:"search.input.placeholder",i18nAttrs:"placeholder"}});o.appendChild(c);const l=e("button",{className:"search-query-button",text:n("search.action.label"),attrs:{type:"button"},dataset:{i18nId:"search.action.label",i18nText:""}});if(o.appendChild(l),i.appendChild(o),t){const t=e("button",{className:"search-filter-toggle",attrs:{type:"button"}});t.appendChild(e("i",{className:"fa-solid fa-caret-up"})),t.appendChild(document.createTextNode(" ")),t.appendChild(e("span",{text:n("search.filters.toggle"),dataset:{i18nId:"search.filters.toggle",i18nText:""}})),i.appendChild(t)}return i}function j(e=!1){const n=document.querySelector("#search-query-input"),s=document.querySelector(".search-query-button"),t=()=>{const t=u(e);t.includes("query=")&&(window.location.href=t)};n.addEventListener("keydown",function(e){e.key==="Enter"&&(e.preventDefault(),t())}),s.addEventListener("click",t)}function p(t,s=!1){const l=t==="category2",i=l?"categories.child.subtutle":"categories.parent.subtutle",r=n(i),o=e("div",{className:"taxonomy-filter"});o.appendChild(e("label",{text:r,attrs:{for:`filter-${t}`},dataset:{i18nId:i,i18nText:""}}));const a=e("div",{className:"taxonomy-input-wrapper"}),c=e("input",{id:`filter-${t}`,className:"search-filter-input",attrs:{type:"text",placeholder:r,autocomplete:"off"},dataset:{i18nId:i,i18nAttrs:"placeholder"}});s&&(c.disabled=!0),a.appendChild(c);const d=e("div",{id:`filter-${t}-dropdown`,className:"search-filter-dropdown hidden"});a.appendChild(d),o.appendChild(a);const u=e("div",{id:`filter-${t}-chips`,className:"search-filter-chips"});return o.appendChild(u),o}function R(){const t=e("div",{className:"taxonomy-filter taxonomy-filter-wide"}),o=n("tags.terms.title");t.appendChild(e("label",{text:o,attrs:{for:"filter-tags"},dataset:{i18nId:"tags.terms.title",i18nText:""}}));const s=e("div",{className:"taxonomy-input-wrapper"}),i=e("input",{id:"filter-tags",className:"search-filter-input",attrs:{type:"text",placeholder:o,autocomplete:"off"},dataset:{i18nId:"tags.terms.title",i18nAttrs:"placeholder"}});s.appendChild(i);const a=e("div",{id:"filter-tags-dropdown",className:"search-filter-dropdown hidden"});s.appendChild(a),t.appendChild(s);const r=e("div",{id:"filter-tags-chips",className:"search-filter-chips search-filter-chips-wrap"});return t.appendChild(r),t}function S(){const o=e("div",{className:"taxonomy-filter tags-op-checkbox"}),s=e("label",{className:"tags-op-label"}),i=e("input",{id:"filter-tagsOp",attrs:{type:"checkbox"}});return i.checked=t.tagsOp==="and",s.appendChild(i),s.appendChild(e("span",{text:n("tags.op.checkbox"),dataset:{i18nId:"tags.op.checkbox",i18nText:""}})),o.appendChild(s),o}function m(){const t=document.createDocumentFragment(),n=e("div",{className:"search-filter"}),s=b({hasAdvancedFilter:!1,queryValue:""});n.appendChild(s),t.appendChild(n),d.appendChild(t),j(!0)}function x(n){const r=document.createDocumentFragment(),o=e("div",{className:"search-filter"}),c=b({hasAdvancedFilter:!0,queryValue:t.query});o.appendChild(c);const s=e("div",{className:"search-taxonomies-row"});t.category1||t.category2||t.tags&&t.tags.length>0||s.classList.add("hidden");const i=e("div",{className:"search-categories-filter"});i.appendChild(p("category1")),i.appendChild(p("category2",!0)),s.appendChild(i);const a=e("div",{className:"search-tags-filter"});a.appendChild(R()),a.appendChild(S()),s.appendChild(a),o.appendChild(s),r.appendChild(o),d.appendChild(r),j(!1),M(),z(n),L()}function M(){const e=document.querySelector(".search-filter-toggle"),t=document.querySelector(".search-taxonomies-row"),n=v==="combined",s=localStorage.getItem(l);(n||s==="true")&&(t.classList.remove("hidden"),e.classList.add("expanded"),localStorage.setItem(l,"true")),e.addEventListener("click",function(){const n=t.classList.contains("hidden");n?(t.classList.remove("hidden"),e.classList.add("expanded"),localStorage.setItem(l,"true")):(t.classList.add("hidden"),e.classList.remove("expanded"),localStorage.setItem(l,"false"))})}function z(e){const a=document.querySelector("#filter-category1"),s=document.querySelector("#filter-category1-dropdown"),c=document.querySelector("#filter-category2"),o=document.querySelector("#filter-category2-dropdown"),l=document.querySelector("#filter-tags"),i=document.querySelector("#filter-tags-dropdown");let t=-1,n=null;a.addEventListener("input",function(){const i=this.value.trim().toLowerCase(),o=A(i,e);o.length>0?(r(s,o,"category1"),s.classList.remove("hidden"),n=s,t=-1):(s.classList.add("hidden"),n=null,t=-1)}),a.addEventListener("focus",function(){o.classList.add("hidden"),i.classList.add("hidden");const a=this.value.trim().toLowerCase(),t=A(a,e);t.length>0&&(r(s,t,"category1"),s.classList.remove("hidden"),n=s)}),c.addEventListener("input",function(){const i=this.value.trim().toLowerCase(),s=g(i,e);s.length>0?(r(o,s,"category2"),o.classList.remove("hidden"),n=o,t=-1):(o.classList.add("hidden"),n=null,t=-1)}),c.addEventListener("focus",function(){if(this.disabled)return;s.classList.add("hidden"),i.classList.add("hidden");const a=this.value.trim().toLowerCase(),t=g(a,e);t.length>0&&(r(o,t,"category2"),o.classList.remove("hidden"),n=o)}),l.addEventListener("input",function(){const o=this.value.trim().toLowerCase(),s=k(o,e);s.length>0?(r(i,s,"tags"),i.classList.remove("hidden"),n=i,t=-1):(i.classList.add("hidden"),n=null,t=-1)}),l.addEventListener("focus",function(){s.classList.add("hidden"),o.classList.add("hidden");const a=this.value.trim().toLowerCase(),t=k(a,e);t.length>0&&(r(i,t,"tags"),i.classList.remove("hidden"),n=i)}),[a,c,l].forEach(e=>{e.addEventListener("keydown",function(e){if(!n||n.classList.contains("hidden"))return;const s=n.querySelectorAll(".search-filter-dropdown-item");if(s.length===0)return;switch(e.key){case"ArrowDown":e.preventDefault(),t=(t+1)%s.length,d(s,t);break;case"ArrowUp":e.preventDefault(),t=(t-1+s.length)%s.length,d(s,t);break;case"Enter":e.preventDefault(),s.length>0&&(t>=0&&t<s.length?s[t].click():s[0].click());break;case"Escape":e.preventDefault(),n.classList.add("hidden"),n=null,t=-1;break}})}),document.addEventListener("click",function(e){e.target.closest(".taxonomy-filter")||([s,o,i].forEach(e=>{e.classList.add("hidden")}),n=null,t=-1)});const h=document.querySelector("#filter-tagsOp");h.addEventListener("change",function(){const t=document.querySelector("#filter-tags-chips"),e=t?.querySelectorAll(".search-filter-chip");e&&e.length>0&&(window.location.href=u())});function d(e,t){e.forEach((e,n)=>{n===t?(e.classList.add("active"),e.scrollIntoView({block:"nearest"})):e.classList.remove("active")})}}function L(){const e=window.siteSearch.categories,n=window.siteSearch.tags;if(t.category1){const n=e[t.category1.toLowerCase()];if(n&&n.A){const e=document.querySelector("#filter-category1-chips"),s=a(n.A.name,t.category1,"category1");e.appendChild(s);const o=document.querySelector("#filter-category2");if(o.disabled=!1,t.category2){const e=n[t.category2.toLowerCase()];if(e){const n=document.querySelector("#filter-category2-chips"),s=a(e.name,t.category2,"category2");n.appendChild(s)}}}}if(t.tags&&t.tags.length>0){const e=document.querySelector("#filter-tags-chips");t.tags.forEach(t=>{const s=n[t.toLowerCase()];if(s){const n=a(s.name,t,"tags");e.appendChild(n)}})}}function A(e,t){const n=window.siteSearch.categories,s=[];for(const i in n){const o=n[i];if(o.A&&o.A.name){const n=o.A.name,r=new Set(o.A.ids),a=[...t].filter(e=>r.has(e)).length;a>0&&n.toLowerCase().includes(e)&&s.push({name:n,count:a,key:i})}}return s.sort((e,t)=>e.name.localeCompare(t.name))}function g(e,t){const i=document.querySelector("#filter-category1-chips"),s=i?.querySelector(".search-filter-chip");if(!s)return[];const a=s.dataset.key.toLowerCase(),r=window.siteSearch.categories,n=r[a];if(!n)return[];const o=[];for(const i in n){if(i==="A")continue;const s=n[i];if(s&&s.name){const n=s.name,r=new Set(s.ids),a=[...t].filter(e=>r.has(e)).length;a>0&&n.toLowerCase().includes(e)&&o.push({name:n,count:a,key:i})}}return o.sort((e,t)=>e.name.localeCompare(t.name))}function k(e,n){const s=window.siteSearch.tags,o=[],i=new Set(t.tags.map(e=>e.toLowerCase()));for(const a in s){if(i.has(a.toLowerCase()))continue;const t=s[a];if(t&&t.name){const s=t.name,r=new Set(t.ids),i=[...n].filter(e=>r.has(e)).length;i>0&&s.toLowerCase().includes(e)&&o.push({name:s,count:i,key:a})}}return o.sort((e,t)=>e.name.localeCompare(t.name))}function r(t,n,s){t.replaceChildren();const o=document.createDocumentFragment();n.forEach(t=>{const n=e("div",{className:"search-filter-dropdown-item",dataset:{key:t.key,name:t.name}});n.appendChild(e("span",{className:"dropdown-item-name",text:t.name})),n.appendChild(e("span",{className:"dropdown-item-count",text:`(${t.count})`})),n.addEventListener("click",function(){T(s,t)}),o.appendChild(n)}),t.appendChild(o)}function T(e,t){const s=document.querySelector(`#filter-${e}-dropdown`),o=document.querySelector(`#filter-${e}`),n=document.querySelector(`#filter-${e}-chips`);if(s.classList.add("hidden"),o.value="",e==="category1"){n.replaceChildren();const s=a(t.name,t.key,e);n.appendChild(s);const o=document.querySelector("#filter-category2");o.disabled=!1;const i=document.querySelector("#filter-category2-chips");i.replaceChildren()}else if(e==="category2"){n.replaceChildren();const s=a(t.name,t.key,e);n.appendChild(s)}else if(e==="tags"){const s=n.querySelectorAll(".search-filter-chip");for(const e of s)if(e.dataset.key===t.key)return;const o=a(t.name,t.key,e);n.appendChild(o)}window.location.href=u()}function a(t,n,s){const o=e("div",{className:"search-filter-chip",dataset:{key:n,name:t},styles:{cursor:"pointer"}});return o.appendChild(e("span",{className:"chip-name",text:t})),o.appendChild(e("button",{className:"chip-remove",html:"&times;"})),o.addEventListener("click",function(){D(s,o)}),o}function D(e,t){if(t.remove(),e==="category1"){const e=document.querySelector("#filter-category2");e.disabled=!0,e.value="";const t=document.querySelector("#filter-category2-chips");t.replaceChildren();const n=document.querySelector("#filter-category2-dropdown");n.classList.add("hidden")}window.location.href=u()}function N(e,t=!1){const s=window.siteSearch.index.search(e.query),n=new Set(s.map(e=>e.item.id));return t&&(c(),o({i18nId:"search.results.title",icon:"fa-file-lines"},n.size,e.query),x(n)),n}function C(e,t=!1){const n=window.siteSearch.categories[e.category1.toLowerCase()],s=n instanceof Object&&Object.keys(n).length>0,i=s?n.A.name:w(e.category1),a=s?n.A.ids:[];if(t){c(),o({text:i,icon:"fa-folder"},a.length),m();const e=Object.keys(n).toSorted().filter(e=>e!=="A"&&n[e]instanceof Object).map(e=>({text:n[e].name,icon:"fa-file",href:`/search/?category1=${i}&category2=${n[e].name}`,pageCount:n[e].ids.length}));e.length>0&&f("categories.child.subtutle",e)}return new Set(a)}function _(e,t=!1){const n=window.siteSearch.categories[e.category1.toLowerCase()],i=n instanceof Object&&Object.keys(n).length>0,a=i?n.A.name:"",s=i?n[e.category2.toLowerCase()]:null,r=i&&s instanceof Object&&Object.keys(s).length>0,d=r?s.name:w(e.category2),l=r?s.ids:[];return t&&(c(),o({text:d,icon:"fa-file"},l.length),m(),a&&(taxonomy={text:a,icon:"fa-folder-open",href:`/search/?category1=${a}`,pageCount:n.A.ids.length},f("categories.parent.subtutle",[taxonomy]))),new Set(l)}function y(e,t=!1){const i=window.siteSearch.tags,a=e.tagsOp==="or",s=new Array;let n=new Set;if(e.tags.forEach((e,t)=>{const o=i[e.toLowerCase()];if(o instanceof Object){s.push(o.name);const e=new Set(o.ids);a?e.forEach(e=>n.add(e)):t===0?n=e:n=new Set([...n].filter(t=>e.has(t)))}}),t&&(c(),s.length===1?o({text:s[0],icon:"fa-tag"},n.size):o({i18nId:"search.results.title",icon:"fa-tags"},n.size),m(),!hasSingleTag)){const e=s.toSorted().map(e=>({text:e,icon:"fa-tag",href:`/search/?tags=${e}`,pageCount:i[e.toLowerCase()].ids.length}));e.length>0&&f("search.tags.title",e)}return n}function H(e,t=!1){const s=window.siteSearch.index.search(e.query);let n=new Set(s.map(e=>e.item.id));if(n.size>0&&e.category1)if(e.category2){const t=_(e,!1);n=new Set([...n].filter(e=>t.has(e)))}else{const t=C(e,!1);n=new Set([...n].filter(e=>t.has(e)))}if(n.size>0&&e.tags.length>0){const t=y(e,!1);n=new Set([...n].filter(e=>t.has(e)))}return t&&(c(),o({i18nId:"search.results.title",icon:"fa-file-lines"},n.size,e.query),x(n)),n}function I(){h.replaceChildren(),h.classList.add("hidden"),O.classList.remove("hidden")}function i(e,t){I();const o=e.size;if(o===0)return;const i=document.createDocumentFragment(),r=Array.from(e).toSorted((e,t)=>e-t),c=F.querySelectorAll(".search-item"),n=Math.ceil(o/t.pageSize);if(t.page>n){const e=new URLSearchParams(s);e.set("page",n),window.location.href=`${window.location.pathname}?${e.toString()}#pagination-anchor`;return}const a=(t.page-1)*t.pageSize,l=Math.min(a+t.pageSize,o);for(let e=a;e<l;e++){const t=r[e];i.appendChild(c[t].cloneNode(!0))}if(O.classList.add("hidden"),h.classList.remove("hidden"),h.appendChild(i),n>1){const o=Math.floor((t.page-1)/10),e=o*10+1,s=Math.min(e+9,n),i=Array.from({length:s-e+1},(t,n)=>e+n),a=e>1?e-1:null,r=s<n?s+1:null;V({cur:t.page,prev:a,next:r,pages:i})}else{const e=document.querySelector("#pagination");e&&e.classList.add("hidden")}}function V({cur:t,pages:o,prev:i=null,next:a=null}){const c=document.querySelector("#pagination");if(!c)return;const r=document.createDocumentFragment(),l=e=>{const t=new URLSearchParams(s);return t.set("page",e),`/search/?${t.toString()}#pagination-anchor`};(function(){let s;i!==null?s=e("a",{className:"pagination-nav pagination-link",attrs:{href:l(i)}}):s=e("span",{className:"pagination-nav disabled"}),s.appendChild(e("i",{className:"fa-solid fa-backward"})),s.appendChild(document.createTextNode(" ")),s.appendChild(e("span",{text:n("post.prev.link"),dataset:{i18nId:"post.prev.link",i18nText:""}})),r.appendChild(s)})(),function(){const s=e("div",{className:"pagination-pages"});o.forEach(n=>{n===t?s.appendChild(e("span",{id:"current-page",className:"pagination-page current",text:n.toString()})):s.appendChild(e("a",{className:"pagination-page pagination-link",text:n.toString(),attrs:{href:l(n)}}))}),r.appendChild(s)}(),function(){let s;a!==null?s=e("a",{className:"pagination-nav pagination-link",attrs:{href:l(a)}}):s=e("span",{className:"pagination-nav disabled"}),s.appendChild(e("span",{text:n("post.next.link"),dataset:{i18nId:"post.next.link",i18nText:""}})),s.appendChild(document.createTextNode(" ")),s.appendChild(e("i",{className:"fa-solid fa-forward"})),r.appendChild(s)}(),c.replaceChildren(r),c.classList.remove("hidden")}})